(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();const F=[];for(let d=0;d<256;++d)F.push((d+256).toString(16).slice(1));function Be(d,e=0){return(F[d[e+0]]+F[d[e+1]]+F[d[e+2]]+F[d[e+3]]+"-"+F[d[e+4]]+F[d[e+5]]+"-"+F[d[e+6]]+F[d[e+7]]+"-"+F[d[e+8]]+F[d[e+9]]+"-"+F[d[e+10]]+F[d[e+11]]+F[d[e+12]]+F[d[e+13]]+F[d[e+14]]+F[d[e+15]]).toLowerCase()}let he;const Ge=new Uint8Array(16);function qe(){if(!he){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");he=crypto.getRandomValues.bind(crypto)}return he(Ge)}const Ve=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),_e={randomUUID:Ve};function Xe(d,e,t){d=d||{};const r=d.random??d.rng?.()??qe();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Be(r)}function He(d,e,t){return _e.randomUUID&&!d?_e.randomUUID():Xe(d)}const Ke={resolution:75,jitter:.5,wavelength:.4,rainfall:.6,seaLevel:.5,shatter:.1,edgeCurve:.8,greyScale:!1};function Ye(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}function We(d){if(Object.prototype.hasOwnProperty.call(d,"__esModule"))return d;var e=d.default;if(typeof e=="function"){var t=function r(){var n=!1;try{n=this instanceof r}catch{}return n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(d).forEach(function(r){var n=Object.getOwnPropertyDescriptor(d,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return d[r]}})}),t}var ie={exports:{}},Qe=ie.exports,ve;function Je(){return ve||(ve=1,(function(d){(function(e,t,r){function n(i){var h=this,u=o();h.next=function(){var l=2091639*h.s0+h.c*23283064365386963e-26;return h.s0=h.s1,h.s1=h.s2,h.s2=l-(h.c=l|0)},h.c=1,h.s0=u(" "),h.s1=u(" "),h.s2=u(" "),h.s0-=u(i),h.s0<0&&(h.s0+=1),h.s1-=u(i),h.s1<0&&(h.s1+=1),h.s2-=u(i),h.s2<0&&(h.s2+=1),u=null}function s(i,h){return h.c=i.c,h.s0=i.s0,h.s1=i.s1,h.s2=i.s2,h}function a(i,h){var u=new n(i),l=h&&h.state,c=u.next;return c.int32=function(){return u.next()*4294967296|0},c.double=function(){return c()+(c()*2097152|0)*11102230246251565e-32},c.quick=c,l&&(typeof l=="object"&&s(l,u),c.state=function(){return s(u,{})}),c}function o(){var i=4022871197,h=function(u){u=String(u);for(var l=0;l<u.length;l++){i+=u.charCodeAt(l);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return h}t&&t.exports?t.exports=a:this.alea=a})(Qe,d)})(ie)),ie.exports}var re={exports:{}},Ze=re.exports,be;function et(){return be||(be=1,(function(d){(function(e,t,r){function n(o){var i=this,h="";i.x=0,i.y=0,i.z=0,i.w=0,i.next=function(){var l=i.x^i.x<<11;return i.x=i.y,i.y=i.z,i.z=i.w,i.w^=i.w>>>19^l^l>>>8},o===(o|0)?i.x=o:h+=o;for(var u=0;u<h.length+64;u++)i.x^=h.charCodeAt(u)|0,i.next()}function s(o,i){return i.x=o.x,i.y=o.y,i.z=o.z,i.w=o.w,i}function a(o,i){var h=new n(o),u=i&&i.state,l=function(){return(h.next()>>>0)/4294967296};return l.double=function(){do var c=h.next()>>>11,f=(h.next()>>>0)/4294967296,g=(c+f)/(1<<21);while(g===0);return g},l.int32=h.next,l.quick=l,u&&(typeof u=="object"&&s(u,h),l.state=function(){return s(h,{})}),l}t&&t.exports?t.exports=a:this.xor128=a})(Ze,d)})(re)),re.exports}var se={exports:{}},tt=se.exports,we;function nt(){return we||(we=1,(function(d){(function(e,t,r){function n(o){var i=this,h="";i.next=function(){var l=i.x^i.x>>>2;return i.x=i.y,i.y=i.z,i.z=i.w,i.w=i.v,(i.d=i.d+362437|0)+(i.v=i.v^i.v<<4^(l^l<<1))|0},i.x=0,i.y=0,i.z=0,i.w=0,i.v=0,o===(o|0)?i.x=o:h+=o;for(var u=0;u<h.length+64;u++)i.x^=h.charCodeAt(u)|0,u==h.length&&(i.d=i.x<<10^i.x>>>4),i.next()}function s(o,i){return i.x=o.x,i.y=o.y,i.z=o.z,i.w=o.w,i.v=o.v,i.d=o.d,i}function a(o,i){var h=new n(o),u=i&&i.state,l=function(){return(h.next()>>>0)/4294967296};return l.double=function(){do var c=h.next()>>>11,f=(h.next()>>>0)/4294967296,g=(c+f)/(1<<21);while(g===0);return g},l.int32=h.next,l.quick=l,u&&(typeof u=="object"&&s(u,h),l.state=function(){return s(h,{})}),l}t&&t.exports?t.exports=a:this.xorwow=a})(tt,d)})(se)),se.exports}var oe={exports:{}},it=oe.exports,Ae;function rt(){return Ae||(Ae=1,(function(d){(function(e,t,r){function n(o){var i=this;i.next=function(){var u=i.x,l=i.i,c,f;return c=u[l],c^=c>>>7,f=c^c<<24,c=u[l+1&7],f^=c^c>>>10,c=u[l+3&7],f^=c^c>>>3,c=u[l+4&7],f^=c^c<<7,c=u[l+7&7],c=c^c<<13,f^=c^c<<9,u[l]=f,i.i=l+1&7,f};function h(u,l){var c,f=[];if(l===(l|0))f[0]=l;else for(l=""+l,c=0;c<l.length;++c)f[c&7]=f[c&7]<<15^l.charCodeAt(c)+f[c+1&7]<<13;for(;f.length<8;)f.push(0);for(c=0;c<8&&f[c]===0;++c);for(c==8?f[7]=-1:f[c],u.x=f,u.i=0,c=256;c>0;--c)u.next()}h(i,o)}function s(o,i){return i.x=o.x.slice(),i.i=o.i,i}function a(o,i){o==null&&(o=+new Date);var h=new n(o),u=i&&i.state,l=function(){return(h.next()>>>0)/4294967296};return l.double=function(){do var c=h.next()>>>11,f=(h.next()>>>0)/4294967296,g=(c+f)/(1<<21);while(g===0);return g},l.int32=h.next,l.quick=l,u&&(u.x&&s(u,h),l.state=function(){return s(h,{})}),l}t&&t.exports?t.exports=a:this.xorshift7=a})(it,d)})(oe)),oe.exports}var ae={exports:{}},st=ae.exports,Se;function ot(){return Se||(Se=1,(function(d){(function(e,t,r){function n(o){var i=this;i.next=function(){var u=i.w,l=i.X,c=i.i,f,g;return i.w=u=u+1640531527|0,g=l[c+34&127],f=l[c=c+1&127],g^=g<<13,f^=f<<17,g^=g>>>15,f^=f>>>12,g=l[c]=g^f,i.i=c,g+(u^u>>>16)|0};function h(u,l){var c,f,g,m,y,x=[],v=128;for(l===(l|0)?(f=l,l=null):(l=l+"\0",f=0,v=Math.max(v,l.length)),g=0,m=-32;m<v;++m)l&&(f^=l.charCodeAt((m+32)%l.length)),m===0&&(y=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,m>=0&&(y=y+1640531527|0,c=x[m&127]^=f+y,g=c==0?g+1:0);for(g>=128&&(x[(l&&l.length||0)&127]=-1),g=127,m=512;m>0;--m)f=x[g+34&127],c=x[g=g+1&127],f^=f<<13,c^=c<<17,f^=f>>>15,c^=c>>>12,x[g]=f^c;u.w=y,u.X=x,u.i=g}h(i,o)}function s(o,i){return i.i=o.i,i.w=o.w,i.X=o.X.slice(),i}function a(o,i){o==null&&(o=+new Date);var h=new n(o),u=i&&i.state,l=function(){return(h.next()>>>0)/4294967296};return l.double=function(){do var c=h.next()>>>11,f=(h.next()>>>0)/4294967296,g=(c+f)/(1<<21);while(g===0);return g},l.int32=h.next,l.quick=l,u&&(u.X&&s(u,h),l.state=function(){return s(h,{})}),l}t&&t.exports?t.exports=a:this.xor4096=a})(st,d)})(ae)),ae.exports}var le={exports:{}},at=le.exports,Ee;function lt(){return Ee||(Ee=1,(function(d){(function(e,t,r){function n(o){var i=this,h="";i.next=function(){var l=i.b,c=i.c,f=i.d,g=i.a;return l=l<<25^l>>>7^c,c=c-f|0,f=f<<24^f>>>8^g,g=g-l|0,i.b=l=l<<20^l>>>12^c,i.c=c=c-f|0,i.d=f<<16^c>>>16^g,i.a=g-l|0},i.a=0,i.b=0,i.c=-1640531527,i.d=1367130551,o===Math.floor(o)?(i.a=o/4294967296|0,i.b=o|0):h+=o;for(var u=0;u<h.length+20;u++)i.b^=h.charCodeAt(u)|0,i.next()}function s(o,i){return i.a=o.a,i.b=o.b,i.c=o.c,i.d=o.d,i}function a(o,i){var h=new n(o),u=i&&i.state,l=function(){return(h.next()>>>0)/4294967296};return l.double=function(){do var c=h.next()>>>11,f=(h.next()>>>0)/4294967296,g=(c+f)/(1<<21);while(g===0);return g},l.int32=h.next,l.quick=l,u&&(typeof u=="object"&&s(u,h),l.state=function(){return s(h,{})}),l}t&&t.exports?t.exports=a:this.tychei=a})(at,d)})(le)),le.exports}var ce={exports:{}};const ct={},ht=Object.freeze(Object.defineProperty({__proto__:null,default:ct},Symbol.toStringTag,{value:"Module"})),ut=We(ht);var ft=ce.exports,Ce;function dt(){return Ce||(Ce=1,(function(d){(function(e,t,r){var n=256,s=6,a=52,o="random",i=r.pow(n,s),h=r.pow(2,a),u=h*2,l=n-1,c;function f(_,A,M){var I=[];A=A==!0?{entropy:!0}:A||{};var E=x(y(A.entropy?[_,C(t)]:_??v(),3),I),p=new g(I),S=function(){for(var w=p.g(s),b=i,T=0;w<h;)w=(w+T)*n,b*=n,T=p.g(1);for(;w>=u;)w/=2,b/=2,T>>>=1;return(w+T)/b};return S.int32=function(){return p.g(4)|0},S.quick=function(){return p.g(4)/4294967296},S.double=S,x(C(p.S),t),(A.pass||M||function(w,b,T,k){return k&&(k.S&&m(k,p),w.state=function(){return m(p,{})}),T?(r[o]=w,b):w})(S,E,"global"in A?A.global:this==r,A.state)}function g(_){var A,M=_.length,I=this,E=0,p=I.i=I.j=0,S=I.S=[];for(M||(_=[M++]);E<n;)S[E]=E++;for(E=0;E<n;E++)S[E]=S[p=l&p+_[E%M]+(A=S[E])],S[p]=A;(I.g=function(w){for(var b,T=0,k=I.i,L=I.j,R=I.S;w--;)b=R[k=l&k+1],T=T*n+R[l&(R[k]=R[L=l&L+b])+(R[L]=b)];return I.i=k,I.j=L,T})(n)}function m(_,A){return A.i=_.i,A.j=_.j,A.S=_.S.slice(),A}function y(_,A){var M=[],I=typeof _,E;if(A&&I=="object")for(E in _)try{M.push(y(_[E],A-1))}catch{}return M.length?M:I=="string"?_:_+"\0"}function x(_,A){for(var M=_+"",I,E=0;E<M.length;)A[l&E]=l&(I^=A[l&E]*19)+M.charCodeAt(E++);return C(A)}function v(){try{var _;return c&&(_=c.randomBytes)?_=_(n):(_=new Uint8Array(n),(e.crypto||e.msCrypto).getRandomValues(_)),C(_)}catch{var A=e.navigator,M=A&&A.plugins;return[+new Date,e,M,e.screen,C(t)]}}function C(_){return String.fromCharCode.apply(0,_)}if(x(r.random(),t),d.exports){d.exports=f;try{c=ut}catch{}}else r["seed"+o]=f})(typeof self<"u"?self:ft,[],Math)})(ce)),ce.exports}var ue,Ie;function gt(){if(Ie)return ue;Ie=1;var d=Je(),e=et(),t=nt(),r=rt(),n=ot(),s=lt(),a=dt();return a.alea=d,a.xor128=e,a.xorwow=t,a.xorshift7=r,a.xor4096=n,a.tychei=s,ue=a,ue}var mt=gt();const xe=Ye(mt),ze=Math.sqrt(3),xt=.5*(ze-1),K=(3-ze)/6,Me=d=>Math.floor(d)|0,Te=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function Re(d=Math.random){const e=pt(d),t=new Float64Array(e).map(n=>Te[n%12*2]),r=new Float64Array(e).map(n=>Te[n%12*2+1]);return function(s,a){let o=0,i=0,h=0;const u=(s+a)*xt,l=Me(s+u),c=Me(a+u),f=(l+c)*K,g=l-f,m=c-f,y=s-g,x=a-m;let v,C;y>x?(v=1,C=0):(v=0,C=1);const _=y-v+K,A=x-C+K,M=y-1+2*K,I=x-1+2*K,E=l&255,p=c&255;let S=.5-y*y-x*x;if(S>=0){const T=E+e[p],k=t[T],L=r[T];S*=S,o=S*S*(k*y+L*x)}let w=.5-_*_-A*A;if(w>=0){const T=E+v+e[p+C],k=t[T],L=r[T];w*=w,i=w*w*(k*_+L*A)}let b=.5-M*M-I*I;if(b>=0){const T=E+1+e[p+1],k=t[T],L=r[T];b*=b,h=b*b*(k*M+L*I)}return 70*(o+i+h)}}function pt(d){const t=new Uint8Array(512);for(let r=0;r<512/2;r++)t[r]=r;for(let r=0;r<512/2-1;r++){const n=r+~~(d()*(256-r)),s=t[r];t[r]=t[n],t[n]=s}for(let r=256;r<512;r++)t[r]=t[r-256];return t}const P={OCEAN:{color:"#44447a",greyscale:"#000000",name:"ocean"},SUBTROPICAL_DESERT:{color:"#d2b98b",greyscale:"#2B2B2B",name:"subtropical desert"},GRASSLAND:{color:"#88aa55",greyscale:"#3F3F3F",name:"grassland"},TROPICAL_SEASONAL_FOREST:{color:"#559944",greyscale:"#4F4F4F",name:"tropical seasonal forest"},TROPICAL_RAIN_FOREST:{color:"#337755",greyscale:"#5F5F5F",name:"tropical rain forest"},TEMPERATE_DESERT:{color:"#c9d29b",greyscale:"#6A6A6A",name:"temperate desert"},DECIDUOUS_FOREST:{color:"#679459",greyscale:"#7A7A7A",name:"deciduous forest"},TEMPERATE_RAIN_FOREST:{color:"#448855",greyscale:"#8A8A8A",name:"rain forest"},SHRUBLAND:{color:"#889977",greyscale:"#AFAFAF",name:"shrubland"},TAIGA:{color:"#99aa77",greyscale:"#BFBFBF",name:"taiga"},BARREN_ROCK:{color:"#888888",greyscale:"#DADADA",name:"barren rock"},TUNDRA:{color:"#bbbbaa",greyscale:"#EAEAEA",name:"tundra"},GLACIER:{color:"#dddde4",greyscale:"#FFFFFF",name:"glacier"}},fe=[.6,1],de=[.4,.6],J=[.2,.4],Z=[0,.2],yt=[-1,0],ee=[{elevation:fe,moisture:[0,.2],biome:P.BARREN_ROCK},{elevation:fe,moisture:[.2,.5],biome:P.TUNDRA},{elevation:fe,moisture:[.5,1],biome:P.GLACIER},{elevation:de,moisture:[0,.33],biome:P.TEMPERATE_DESERT},{elevation:de,moisture:[.33,.66],biome:P.SHRUBLAND},{elevation:de,moisture:[.66,1],biome:P.TAIGA},{elevation:J,moisture:[0,.16],biome:P.TEMPERATE_DESERT},{elevation:J,moisture:[.16,.5],biome:P.GRASSLAND},{elevation:J,moisture:[.5,.83],biome:P.DECIDUOUS_FOREST},{elevation:J,moisture:[.83,1],biome:P.TEMPERATE_RAIN_FOREST},{elevation:Z,moisture:[0,.16],biome:P.SUBTROPICAL_DESERT},{elevation:Z,moisture:[.16,.33],biome:P.GRASSLAND},{elevation:Z,moisture:[.33,.66],biome:P.TROPICAL_SEASONAL_FOREST},{elevation:Z,moisture:[.66,1],biome:P.TROPICAL_RAIN_FOREST},{elevation:yt,moisture:[0,1],biome:P.OCEAN}];class _t{rainfall;seaLevel;constructor(e,t){if(e<0||e>1||t<0||t>1)throw Error("rainfall & seaLevel must be 0-1");e=this.expCurve(1-e,4.1),this.rainfall=Math.max(.01,e*25),this.seaLevel=2*(t-.5)}getBiome(e,t){let r=2*(e-.5)-(this.seaLevel-.1),n=t**this.rainfall;r=Math.max(Math.min(r,1-this.EPS),-1),n=Math.max(Math.min(n,1-this.EPS),-1);const s=this.findMatchingBiomeRule(r,n);if(!s)throw new Error(`unable to find biome for elevation: ${e}, moisture: ${t}`);return s.biome}findMatchingBiomeRule(e,t){const r=this.findLastIndex(ee,(n,s,a)=>this.matchesRule(n,e,t));return ee[r]}isOcean(e){const t=this.findLastIndex(ee,n=>n.biome.name===P.OCEAN.name);return ee[t].elevation[1]>=e}expCurve(e,t){const r=Math.max(0,Math.min(1,e));return(Math.exp(t*r)-1)/(Math.exp(t)-1)}matchesRule(e,t,r){return e.elevation[0]<=t&&e.elevation[1]>t&&e.moisture[0]<=r&&e.moisture[1]>r}EPS=1e-9;findLastIndex(e,t){for(let r=e.length-1;r>=0;r--)if(t(e[r],r,e))return r;return-1}}const B=11102230246251565e-32,D=134217729,vt=(3+8*B)*B;function ge(d,e,t,r,n){let s,a,o,i,h=e[0],u=r[0],l=0,c=0;u>h==u>-h?(s=h,h=e[++l]):(s=u,u=r[++c]);let f=0;if(l<d&&c<t)for(u>h==u>-h?(a=h+s,o=s-(a-h),h=e[++l]):(a=u+s,o=s-(a-u),u=r[++c]),s=a,o!==0&&(n[f++]=o);l<d&&c<t;)u>h==u>-h?(a=s+h,i=a-s,o=s-(a-i)+(h-i),h=e[++l]):(a=s+u,i=a-s,o=s-(a-i)+(u-i),u=r[++c]),s=a,o!==0&&(n[f++]=o);for(;l<d;)a=s+h,i=a-s,o=s-(a-i)+(h-i),h=e[++l],s=a,o!==0&&(n[f++]=o);for(;c<t;)a=s+u,i=a-s,o=s-(a-i)+(u-i),u=r[++c],s=a,o!==0&&(n[f++]=o);return(s!==0||f===0)&&(n[f++]=s),f}function bt(d,e){let t=e[0];for(let r=1;r<d;r++)t+=e[r];return t}function Q(d){return new Float64Array(d)}const wt=(3+16*B)*B,At=(2+12*B)*B,St=(9+64*B)*B*B,V=Q(4),ke=Q(8),Le=Q(12),Ne=Q(16),U=Q(4);function Et(d,e,t,r,n,s,a){let o,i,h,u,l,c,f,g,m,y,x,v,C,_,A,M,I,E;const p=d-n,S=t-n,w=e-s,b=r-s;_=p*b,c=D*p,f=c-(c-p),g=p-f,c=D*b,m=c-(c-b),y=b-m,A=g*y-(_-f*m-g*m-f*y),M=w*S,c=D*w,f=c-(c-w),g=w-f,c=D*S,m=c-(c-S),y=S-m,I=g*y-(M-f*m-g*m-f*y),x=A-I,l=A-x,V[0]=A-(x+l)+(l-I),v=_+x,l=v-_,C=_-(v-l)+(x-l),x=C-M,l=C-x,V[1]=C-(x+l)+(l-M),E=v+x,l=E-v,V[2]=v-(E-l)+(x-l),V[3]=E;let T=bt(4,V),k=At*a;if(T>=k||-T>=k||(l=d-p,o=d-(p+l)+(l-n),l=t-S,h=t-(S+l)+(l-n),l=e-w,i=e-(w+l)+(l-s),l=r-b,u=r-(b+l)+(l-s),o===0&&i===0&&h===0&&u===0)||(k=St*a+vt*Math.abs(T),T+=p*u+b*o-(w*h+S*i),T>=k||-T>=k))return T;_=o*b,c=D*o,f=c-(c-o),g=o-f,c=D*b,m=c-(c-b),y=b-m,A=g*y-(_-f*m-g*m-f*y),M=i*S,c=D*i,f=c-(c-i),g=i-f,c=D*S,m=c-(c-S),y=S-m,I=g*y-(M-f*m-g*m-f*y),x=A-I,l=A-x,U[0]=A-(x+l)+(l-I),v=_+x,l=v-_,C=_-(v-l)+(x-l),x=C-M,l=C-x,U[1]=C-(x+l)+(l-M),E=v+x,l=E-v,U[2]=v-(E-l)+(x-l),U[3]=E;const L=ge(4,V,4,U,ke);_=p*u,c=D*p,f=c-(c-p),g=p-f,c=D*u,m=c-(c-u),y=u-m,A=g*y-(_-f*m-g*m-f*y),M=w*h,c=D*w,f=c-(c-w),g=w-f,c=D*h,m=c-(c-h),y=h-m,I=g*y-(M-f*m-g*m-f*y),x=A-I,l=A-x,U[0]=A-(x+l)+(l-I),v=_+x,l=v-_,C=_-(v-l)+(x-l),x=C-M,l=C-x,U[1]=C-(x+l)+(l-M),E=v+x,l=E-v,U[2]=v-(E-l)+(x-l),U[3]=E;const R=ge(L,ke,4,U,Le);_=o*u,c=D*o,f=c-(c-o),g=o-f,c=D*u,m=c-(c-u),y=u-m,A=g*y-(_-f*m-g*m-f*y),M=i*h,c=D*i,f=c-(c-i),g=i-f,c=D*h,m=c-(c-h),y=h-m,I=g*y-(M-f*m-g*m-f*y),x=A-I,l=A-x,U[0]=A-(x+l)+(l-I),v=_+x,l=v-_,C=_-(v-l)+(x-l),x=C-M,l=C-x,U[1]=C-(x+l)+(l-M),E=v+x,l=E-v,U[2]=v-(E-l)+(x-l),U[3]=E;const N=ge(R,Le,4,U,Ne);return Ne[N-1]}function te(d,e,t,r,n,s){const a=(e-s)*(t-n),o=(d-n)*(r-s),i=a-o,h=Math.abs(a+o);return Math.abs(i)>=wt*h?i:-Et(d,e,t,r,n,s,h)}const Oe=Math.pow(2,-52),ne=new Uint32Array(512);class W{static from(e,t=Rt,r=kt){const n=e.length,s=new Float64Array(n*2);for(let a=0;a<n;a++){const o=e[a];s[2*a]=t(o),s[2*a+1]=r(o)}return new W(s)}constructor(e){const t=e.length>>1;if(t>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const r=Math.max(2*t-5,0);this._triangles=new Uint32Array(r*3),this._halfedges=new Int32Array(r*3),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:r,_hullTri:n,_hullHash:s}=this,a=e.length>>1;let o=1/0,i=1/0,h=-1/0,u=-1/0;for(let p=0;p<a;p++){const S=e[2*p],w=e[2*p+1];S<o&&(o=S),w<i&&(i=w),S>h&&(h=S),w>u&&(u=w),this._ids[p]=p}const l=(o+h)/2,c=(i+u)/2;let f,g,m;for(let p=0,S=1/0;p<a;p++){const w=me(l,c,e[2*p],e[2*p+1]);w<S&&(f=p,S=w)}const y=e[2*f],x=e[2*f+1];for(let p=0,S=1/0;p<a;p++){if(p===f)continue;const w=me(y,x,e[2*p],e[2*p+1]);w<S&&w>0&&(g=p,S=w)}let v=e[2*g],C=e[2*g+1],_=1/0;for(let p=0;p<a;p++){if(p===f||p===g)continue;const S=Mt(y,x,v,C,e[2*p],e[2*p+1]);S<_&&(m=p,_=S)}let A=e[2*m],M=e[2*m+1];if(_===1/0){for(let w=0;w<a;w++)this._dists[w]=e[2*w]-e[0]||e[2*w+1]-e[1];H(this._ids,this._dists,0,a-1);const p=new Uint32Array(a);let S=0;for(let w=0,b=-1/0;w<a;w++){const T=this._ids[w],k=this._dists[T];k>b&&(p[S++]=T,b=k)}this.hull=p.subarray(0,S),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(te(y,x,v,C,A,M)<0){const p=g,S=v,w=C;g=m,v=A,C=M,m=p,A=S,M=w}const I=Tt(y,x,v,C,A,M);this._cx=I.x,this._cy=I.y;for(let p=0;p<a;p++)this._dists[p]=me(e[2*p],e[2*p+1],I.x,I.y);H(this._ids,this._dists,0,a-1),this._hullStart=f;let E=3;r[f]=t[m]=g,r[g]=t[f]=m,r[m]=t[g]=f,n[f]=0,n[g]=1,n[m]=2,s.fill(-1),s[this._hashKey(y,x)]=f,s[this._hashKey(v,C)]=g,s[this._hashKey(A,M)]=m,this.trianglesLen=0,this._addTriangle(f,g,m,-1,-1,-1);for(let p=0,S,w;p<this._ids.length;p++){const b=this._ids[p],T=e[2*b],k=e[2*b+1];if(p>0&&Math.abs(T-S)<=Oe&&Math.abs(k-w)<=Oe||(S=T,w=k,b===f||b===g||b===m))continue;let L=0;for(let q=0,$e=this._hashKey(T,k);q<this._hashSize&&(L=s[($e+q)%this._hashSize],!(L!==-1&&L!==r[L]));q++);L=t[L];let R=L,N;for(;N=r[R],te(T,k,e[2*R],e[2*R+1],e[2*N],e[2*N+1])>=0;)if(R=N,R===L){R=-1;break}if(R===-1)continue;let z=this._addTriangle(R,b,r[R],-1,-1,n[R]);n[b]=this._legalize(z+2),n[R]=z,E++;let j=r[R];for(;N=r[j],te(T,k,e[2*j],e[2*j+1],e[2*N],e[2*N+1])<0;)z=this._addTriangle(j,b,N,n[b],-1,n[j]),n[b]=this._legalize(z+2),r[j]=j,E--,j=N;if(R===L)for(;N=t[R],te(T,k,e[2*N],e[2*N+1],e[2*R],e[2*R+1])<0;)z=this._addTriangle(N,b,R,-1,n[R],n[N]),this._legalize(z+2),n[N]=z,r[R]=R,E--,R=N;this._hullStart=t[b]=R,r[R]=t[j]=b,r[b]=j,s[this._hashKey(T,k)]=b,s[this._hashKey(e[2*R],e[2*R+1])]=R}this.hull=new Uint32Array(E);for(let p=0,S=this._hullStart;p<E;p++)this.hull[p]=S,S=r[S];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(Ct(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:r,coords:n}=this;let s=0,a=0;for(;;){const o=r[e],i=e-e%3;if(a=i+(e+2)%3,o===-1){if(s===0)break;e=ne[--s];continue}const h=o-o%3,u=i+(e+1)%3,l=h+(o+2)%3,c=t[a],f=t[e],g=t[u],m=t[l];if(It(n[2*c],n[2*c+1],n[2*f],n[2*f+1],n[2*g],n[2*g+1],n[2*m],n[2*m+1])){t[e]=m,t[o]=c;const x=r[l];if(x===-1){let C=this._hullStart;do{if(this._hullTri[C]===l){this._hullTri[C]=e;break}C=this._hullPrev[C]}while(C!==this._hullStart)}this._link(e,x),this._link(o,r[a]),this._link(a,l);const v=h+(o+1)%3;s<ne.length&&(ne[s++]=v)}else{if(s===0)break;e=ne[--s]}}return a}_link(e,t){this._halfedges[e]=t,t!==-1&&(this._halfedges[t]=e)}_addTriangle(e,t,r,n,s,a){const o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=r,this._link(o,n),this._link(o+1,s),this._link(o+2,a),this.trianglesLen+=3,o}}function Ct(d,e){const t=d/(Math.abs(d)+Math.abs(e));return(e>0?3-t:1+t)/4}function me(d,e,t,r){const n=d-t,s=e-r;return n*n+s*s}function It(d,e,t,r,n,s,a,o){const i=d-a,h=e-o,u=t-a,l=r-o,c=n-a,f=s-o,g=i*i+h*h,m=u*u+l*l,y=c*c+f*f;return i*(l*y-m*f)-h*(u*y-m*c)+g*(u*f-l*c)<0}function Mt(d,e,t,r,n,s){const a=t-d,o=r-e,i=n-d,h=s-e,u=a*a+o*o,l=i*i+h*h,c=.5/(a*h-o*i),f=(h*u-o*l)*c,g=(a*l-i*u)*c;return f*f+g*g}function Tt(d,e,t,r,n,s){const a=t-d,o=r-e,i=n-d,h=s-e,u=a*a+o*o,l=i*i+h*h,c=.5/(a*h-o*i),f=d+(h*u-o*l)*c,g=e+(a*l-i*u)*c;return{x:f,y:g}}function H(d,e,t,r){if(r-t<=20)for(let n=t+1;n<=r;n++){const s=d[n],a=e[s];let o=n-1;for(;o>=t&&e[d[o]]>a;)d[o+1]=d[o--];d[o+1]=s}else{const n=t+r>>1;let s=t+1,a=r;Y(d,n,s),e[d[t]]>e[d[r]]&&Y(d,t,r),e[d[s]]>e[d[r]]&&Y(d,s,r),e[d[t]]>e[d[s]]&&Y(d,t,s);const o=d[s],i=e[o];for(;;){do s++;while(e[d[s]]<i);do a--;while(e[d[a]]>i);if(a<s)break;Y(d,s,a)}d[t+1]=d[a],d[a]=o,r-s+1>=a-t?(H(d,e,s,r),H(d,e,t,a-1)):(H(d,e,t,a-1),H(d,e,s,r))}}function Y(d,e,t){const r=d[e];d[e]=d[t],d[t]=r}function Rt(d){return d[0]}function kt(d){return d[1]}class Fe{rng;constructor(e){this.rng=xe(e)}nextHalfedge(e){return e%3===2?e-2:e+1}triOfEdge(e){return Math.floor(e/3)}buildInedges(e,t){const r=new Int32Array(t).fill(-1),{triangles:n}=e;for(let s=0;s<n.length;s++)r[n[s]]=s;return r}halfedgesAroundSite(e,t,r){const{triangles:n,halfedges:s}=e;let a=t[r];if(a===-1)return null;const o=[];let i=a;do{o.push(i);const h=this.nextHalfedge(i),u=s[h];if(u===-1)return null;i=u,n[i]!==r&&(i=this.nextHalfedge(i),n[i]!==r&&(i=this.nextHalfedge(i)))}while(i!==a);return o}circumcenterOfTri(e,t,r){const{triangles:n}=r,s=e[n[3*t+0]],a=e[n[3*t+1]],o=e[n[3*t+2]],i=s.x*s.x+s.y*s.y,h=a.x*a.x+a.y*a.y,u=o.x*o.x+o.y*o.y,l=2*(s.x*(a.y-o.y)+a.x*(o.y-s.y)+o.x*(s.y-a.y));if(Math.abs(l)<1e-12)return{x:(s.x+a.x+o.x)/3,y:(s.y+a.y+o.y)/3};const c=(i*(a.y-o.y)+h*(o.y-s.y)+u*(s.y-a.y))/l,f=(i*(o.x-a.x)+h*(s.x-o.x)+u*(a.x-s.x))/l;return{x:c,y:f}}polygonCentroid(e,t){let r=0,n=0,s=0;const a=e.length;for(let i=0,h=a-1;i<a;h=i++){const u=e[i].x,l=e[i].y,c=e[h].x,f=e[h].y,g=c*l-u*f;r+=g,n+=(c+u)*g,s+=(f+l)*g}if(Math.abs(r)<1e-12)return t;const o=r/2;return{x:n/(6*o),y:s/(6*o)}}relaxOnce(e){const t=W.from(e,s=>s.x,s=>s.y),r=this.buildInedges(t,e.length),n=new Array(e.length);for(let s=0;s<e.length;s++){const a=this.halfedgesAroundSite(t,r,s);if(!a){n[s]=e[s];continue}const o=a.map(i=>this.circumcenterOfTri(e,this.triOfEdge(i),t));n[s]=this.polygonCentroid(o,e[s])}return{centers:n,delaunay:t}}relaxPoints(e,t){let r=e,n;for(let s=0;s<t;s++){const{centers:a,delaunay:o}=this.relaxOnce(r);r=a,n=o}if(!n)throw new Error("iterations wrong");return{centers:r,delaunay:n}}initPoints(e,t){const r=[];for(let n=0;n<e;n++)for(let s=0;s<e;s++){const a=n+t*(this.rng()-this.rng()),o=s+t*(this.rng()-this.rng());r.push({x:a,y:o})}return r}genPoints(e){const{resolution:t,jitter:r}=e,n=this.initPoints(t,r),{centers:s,delaunay:a}=this.relaxPoints(n,4);return{centers:s,delaunay:a}}}class Lt{noise2D;pointGenerator;constructor(e){this.noise2D=Re(xe(e)),this.pointGenerator=new Fe(e)}reSeed(e){this.noise2D=Re(xe(e)),this.pointGenerator=new Fe(e)}generateMap(e){const{resolution:t}=e,{centers:r,delaunay:n}=this.pointGenerator.genPoints(e),s={points:r,resolution:t,numRegions:r.length,numTriangles:n.halfedges.length/3,numEdges:n.halfedges.length,halfedges:n.halfedges,triangles:n.triangles},a=this.genElevations(s,e),o=this.genMoistures(s,e),i=this.calcBiomes(s,a,o,e);return{...s,elevations:a,moistures:o,biomes:i}}calcBiomes(e,t,r,n){const{numRegions:s}=e,a=new _t(n.rainfall,n.seaLevel),o=[];for(let i=0;i<s;i++)o.push(a.getBiome(t[i],r[i]));return o}genMoistures(e,t){const{wavelength:r}=t,{points:n,numRegions:s}=e;let a=[];for(let o=0;o<s;o++){const i=n[o].x/e.resolution-.5,h=n[o].y/e.resolution-1/2,u=(1+this.noise2D(i/r,h/r))/2;a[o]=Math.max(0,Math.min(1,u))}return a}genElevations(e,t){const{wavelength:r,edgeCurve:n}=t,s=1-t.shatter,a=.5,i=a+(3-a)*n,{points:h,numRegions:u,resolution:l}=e,c=new Array(u),f=m=>m<0?0:m>1?1:m,g=(m,y,x)=>m+(y-m)*x;for(let m=0;m<u;m++){const y=h[m].x/l-.5,x=h[m].y/l-.5;let v=1/3+this.noise2D(y/r,x/r)/2+this.noise2D(2*y/r,2*x/r)/3,C=2*Math.max(Math.abs(y),Math.abs(x));C=Math.pow(C,i);const _=(1+v-C)/2;v=g(v,_,f(s)),c[m]=f(v)}return c}}var $=(d=>(d.ROMANCE="romance",d.GERMANIC="germanic",d.SLAVIC="slavic",d.TURKIC="turkic",d.SEMITIC="semitic",d.BANTU_LIKE="bantu_like",d.AFRICAN_WEST="african_west",d.AFRICAN_HORN="african_horn",d.EAST_ASIAN_CN="east_asian_cn",d.EAST_ASIAN_JP="east_asian_jp",d.EAST_ASIAN_KR="east_asian_kr",d.POLYNESIAN="polynesian",d))($||{});const je=["a","e","i","o","u"],Nt=["ai","au","ei","ia","io","oa","ue","ui"],Ot=["a","e","i","o","u","ia","io","ie","ea"],Ft=["a","i","u","aa","ii","uu","ai","au"],De={romance:{onsets:["b","c","d","f","g","l","m","n","p","r","s","t","br","cr","dr","fl","gl","gr","pr","tr","vr"],vowels:[...Ot,"oa","ue","eo"],codas:["n","r","s","l","m"],codaChance:.45,medials:["del","dor","ver","mar","val","lor","ria","lia","mia"],medialMorphChance:.35,suffixes:["ia","aria","esia"]},germanic:{onsets:["b","d","f","g","h","k","l","m","n","p","r","s","t","w","th","br","cr","dr","fr","gr","kr","pr","tr","st","sk","sp"],vowels:[...je,...Nt],codas:["nd","rt","rm","rg","lf","rk","lt","st","sk","n","r","m","l","k"],codaChance:.65,medials:["wald","heim","mark","gard","dorf"],medialMorphChance:.3,suffixes:["land","heim","berg"]},slavic:{onsets:["b","v","g","d","z","k","l","m","n","p","r","s","t","br","cr","dr","gr","kr","pr","tr","vl","vr","zv","zl","sk","sp","sl","sm","sn","pl","kl","gl","brn"],vowels:[...je,"ya","yo","yu","ia","ie","io"],codas:["v","n","r","nsk","grad","gor","pol","mir","slav","sk"],codaChance:.7,medials:["grad","slav","pol","gor"],medialMorphChance:.4,suffixes:["ia","ovia","grad"]},semitic:{onsets:["al","ar","as","bal","dar","qal","mal","ram","sam","zar","bar","sar"],vowels:[...Ft],codas:["n","m","r","l","s","h"],codaChance:.5,medials:["har","sar","ram","bar"],medialMorphChance:.35,suffixes:["ia","aya","iyya"]},african_west:{onsets:["a","ba","da","ka","fa","ga","la","ma","na","oba","ola","ade","kw","gb","ch","ny","eke","oba","ife","olu"],vowels:["a","e","i","o","u","ai","oa","ie","ua"],codas:["n","m","wa","ra",""],codaChance:.35,medials:["loba","femi","kwe","tunde","chukwu","nwa","kofi","yemi"],medialMorphChance:.4,suffixes:["la","ba","ra","ni","do","ma"]},african_horn:{onsets:["ab","ad","as","ba","da","ha","ka","ma","na","sa","ra","ta","gez","tes","hab","sel","mer","zer","yon","lem"],vowels:["a","e","i","o","u","aa","ee","ei","ia","ua"],codas:["s","m","n","l","t",""],codaChance:.45,medials:["sel","geb","tek","yon","hab","mar","zer","wold"],medialMorphChance:.35,suffixes:["el","es","os","on","u"]},east_asian_cn:{onsets:["b","p","m","f","d","t","n","l","g","k","h","zh","ch","sh","r","z","c","s"],vowels:["a","o","e","i","u","ü","ai","ei","ao","ou","ia","ie","iao","iu","ua","uo","ui","üe","er"],codas:["n","ng",""],codaChance:.4,medials:["shan","jiang","he","hu","zhou","dao","lin","yang","qing","jing","guo","cheng"],medialMorphChance:.3,suffixes:["shan","dao","zhou","guo","cheng","men"]},east_asian_jp:{onsets:["k","s","t","n","h","m","y","r","w","g","z","d","b","p","ky","sh","ch","ny","hy","my","ry","gy","j","py"],vowels:["a","i","u","e","o"],codas:["","n"],codaChance:.35,medials:["mori","yama","kawa","gawa","shima","jima","saka","hara","tani"],medialMorphChance:.3,suffixes:["to","ken","do","fu","shi","mura"]},east_asian_kr:{onsets:["g","n","d","r","m","b","s","j","ch","k","t","p","h"],vowels:["a","eo","o","u","eu","i","ae","e","ya","yeo","yo","yu","wa","we","wi","ui"],codas:["k","n","t","l","m","p","ng",""],codaChance:.45,medials:["san","seong","gang","cheon","buk","nam","jin","dae","won","do"],medialMorphChance:.35,suffixes:["do","si","gun","eup","ri"]},polynesian:{onsets:["","h","k","l","m","n","p","r","t","w","wh","ng"],vowels:["a","e","i","o","u"],codas:["","’","ʻ"],codaChance:.2,medials:["moa","rangi","tonga","tai","wai","puna","tapu","mana","ariki","tiki","honu","pua","mata","ika","koro","hale","fale","nui","loa","roa"],medialMorphChance:.3,suffixes:["nui","roa","loa","rangi","moana","tonga","tai","puna"]}};class jt{rng;constructor(e){this.rng=this.makeRNG(e)}reSeed(e){this.rng=this.makeRNG(e)}generate(e={}){const t=e.lang??this.pickLanguage(),[r,n]=e.syllables??[1,2],s=this.randInt(r,n),a=(e.forceSuffix??this.pickSuffix(t)).toLowerCase();let o=this.buildStem(s,t);return o=this.tidyStemVsSuffix(o,a),this.titleCase(o+a)}pickLanguage(){const e=[$.ROMANCE,$.GERMANIC,$.SLAVIC,$.SEMITIC,$.EAST_ASIAN_CN,$.EAST_ASIAN_JP,$.EAST_ASIAN_KR,$.AFRICAN_WEST,$.AFRICAN_HORN,$.POLYNESIAN];return e[Math.floor(this.rng()*e.length)]}pickSuffix(e){const t=De[e].suffixes;return t[Math.floor(this.rng()*t.length)]}buildStem(e,t){const r=De[t];let n="";for(let s=0;s<e;s++)n+=this.pick(r.onsets)+this.pick(r.vowels),this.rng()<r.codaChance&&(n+=this.pick(r.codas));return n}tidyStemVsSuffix(e,t){return/[aeiou]$/i.test(e)&&/^[aeiou]/i.test(t)?e.slice(0,-1):e}titleCase(e){return e.charAt(0).toUpperCase()+e.slice(1)}pick(e){return e[Math.floor(this.rng()*e.length)]}randInt(e,t){return Math.floor(this.rng()*(t-e+1))+e}makeRNG(e){let t=typeof e=="number"?e|0:this.hash32(String(e));return t===0&&(t=1831565813),function(){return t^=t<<13,t^=t>>>17,t^=t<<5,(t>>>0)%1e6/1e6}}hash32(e){let t=2166136261;for(let r=0;r<e.length;r++)t^=e.charCodeAt(r),t=Math.imul(t,16777619);return t>>>0}}const Pe=1e-6;class G{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,r){e=+e,t=+t,r=+r;const n=e+r,s=t;if(r<0)throw new Error("negative radius");this._x1===null?this._+=`M${n},${s}`:(Math.abs(this._x1-n)>Pe||Math.abs(this._y1-s)>Pe)&&(this._+="L"+n+","+s),r&&(this._+=`A${r},${r},0,1,1,${e-r},${t}A${r},${r},0,1,1,${this._x1=n},${this._y1=s}`)}rect(e,t,r,n){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+r}v${+n}h${-r}Z`}value(){return this._||null}}class pe{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class Dt{constructor(e,[t,r,n,s]=[0,0,960,500]){if(!((n=+n)>=(t=+t))||!((s=+s)>=(r=+r)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(e.points.length*2),this.vectors=new Float64Array(e.points.length*2),this.xmax=n,this.xmin=t,this.ymax=s,this.ymin=r,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:r},vectors:n}=this;let s,a;const o=this.circumcenters=this._circumcenters.subarray(0,r.length/3*2);for(let m=0,y=0,x=r.length,v,C;m<x;m+=3,y+=2){const _=r[m]*2,A=r[m+1]*2,M=r[m+2]*2,I=e[_],E=e[_+1],p=e[A],S=e[A+1],w=e[M],b=e[M+1],T=p-I,k=S-E,L=w-I,R=b-E,N=(T*R-k*L)*2;if(Math.abs(N)<1e-9){if(s===void 0){s=a=0;for(const j of t)s+=e[j*2],a+=e[j*2+1];s/=t.length,a/=t.length}const z=1e9*Math.sign((s-I)*R-(a-E)*L);v=(I+w)/2-z*R,C=(E+b)/2+z*L}else{const z=1/N,j=T*T+k*k,q=L*L+R*R;v=I+(R*j-k*q)*z,C=E+(T*q-L*j)*z}o[y]=v,o[y+1]=C}let i=t[t.length-1],h,u=i*4,l,c=e[2*i],f,g=e[2*i+1];n.fill(0);for(let m=0;m<t.length;++m)i=t[m],h=u,l=c,f=g,u=i*4,c=e[2*i],g=e[2*i+1],n[h+2]=n[u]=f-g,n[h+3]=n[u+1]=c-l}render(e){const t=e==null?e=new G:void 0,{delaunay:{halfedges:r,inedges:n,hull:s},circumcenters:a,vectors:o}=this;if(s.length<=1)return null;for(let u=0,l=r.length;u<l;++u){const c=r[u];if(c<u)continue;const f=Math.floor(u/3)*2,g=Math.floor(c/3)*2,m=a[f],y=a[f+1],x=a[g],v=a[g+1];this._renderSegment(m,y,x,v,e)}let i,h=s[s.length-1];for(let u=0;u<s.length;++u){i=h,h=s[u];const l=Math.floor(n[h]/3)*2,c=a[l],f=a[l+1],g=i*4,m=this._project(c,f,o[g+2],o[g+3]);m&&this._renderSegment(c,f,m[0],m[1],e)}return t&&t.value()}renderBounds(e){const t=e==null?e=new G:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const r=t==null?t=new G:void 0,n=this._clip(e);if(n===null||!n.length)return;t.moveTo(n[0],n[1]);let s=n.length;for(;n[0]===n[s-2]&&n[1]===n[s-1]&&s>1;)s-=2;for(let a=2;a<s;a+=2)(n[a]!==n[a-2]||n[a+1]!==n[a-1])&&t.lineTo(n[a],n[a+1]);return t.closePath(),r&&r.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,r=e.length/2;t<r;++t){const n=this.cellPolygon(t);n&&(n.index=t,yield n)}}cellPolygon(e){const t=new pe;return this.renderCell(e,t),t.value()}_renderSegment(e,t,r,n,s){let a;const o=this._regioncode(e,t),i=this._regioncode(r,n);o===0&&i===0?(s.moveTo(e,t),s.lineTo(r,n)):(a=this._clipSegment(e,t,r,n,o,i))&&(s.moveTo(a[0],a[1]),s.lineTo(a[2],a[3]))}contains(e,t,r){return t=+t,t!==t||(r=+r,r!==r)?!1:this.delaunay._step(e,t,r)===e}*neighbors(e){const t=this._clip(e);if(t)for(const r of this.delaunay.neighbors(e)){const n=this._clip(r);if(n){e:for(let s=0,a=t.length;s<a;s+=2)for(let o=0,i=n.length;o<i;o+=2)if(t[s]===n[o]&&t[s+1]===n[o+1]&&t[(s+2)%a]===n[(o+i-2)%i]&&t[(s+3)%a]===n[(o+i-1)%i]){yield r;break e}}}}_cell(e){const{circumcenters:t,delaunay:{inedges:r,halfedges:n,triangles:s}}=this,a=r[e];if(a===-1)return null;const o=[];let i=a;do{const h=Math.floor(i/3);if(o.push(t[h*2],t[h*2+1]),i=i%3===2?i-2:i+1,s[i]!==e)break;i=n[i]}while(i!==a&&i!==-1);return o}_clip(e){if(e===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(t===null)return null;const{vectors:r}=this,n=e*4;return this._simplify(r[n]||r[n+1]?this._clipInfinite(e,t,r[n],r[n+1],r[n+2],r[n+3]):this._clipFinite(e,t))}_clipFinite(e,t){const r=t.length;let n=null,s,a,o=t[r-2],i=t[r-1],h,u=this._regioncode(o,i),l,c=0;for(let f=0;f<r;f+=2)if(s=o,a=i,o=t[f],i=t[f+1],h=u,u=this._regioncode(o,i),h===0&&u===0)l=c,c=0,n?n.push(o,i):n=[o,i];else{let g,m,y,x,v;if(h===0){if((g=this._clipSegment(s,a,o,i,h,u))===null)continue;[m,y,x,v]=g}else{if((g=this._clipSegment(o,i,s,a,u,h))===null)continue;[x,v,m,y]=g,l=c,c=this._edgecode(m,y),l&&c&&this._edge(e,l,c,n,n.length),n?n.push(m,y):n=[m,y]}l=c,c=this._edgecode(x,v),l&&c&&this._edge(e,l,c,n,n.length),n?n.push(x,v):n=[x,v]}if(n)l=c,c=this._edgecode(n[0],n[1]),l&&c&&this._edge(e,l,c,n,n.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return n}_clipSegment(e,t,r,n,s,a){const o=s<a;for(o&&([e,t,r,n,s,a]=[r,n,e,t,a,s]);;){if(s===0&&a===0)return o?[r,n,e,t]:[e,t,r,n];if(s&a)return null;let i,h,u=s||a;u&8?(i=e+(r-e)*(this.ymax-t)/(n-t),h=this.ymax):u&4?(i=e+(r-e)*(this.ymin-t)/(n-t),h=this.ymin):u&2?(h=t+(n-t)*(this.xmax-e)/(r-e),i=this.xmax):(h=t+(n-t)*(this.xmin-e)/(r-e),i=this.xmin),s?(e=i,t=h,s=this._regioncode(e,t)):(r=i,n=h,a=this._regioncode(r,n))}}_clipInfinite(e,t,r,n,s,a){let o=Array.from(t),i;if((i=this._project(o[0],o[1],r,n))&&o.unshift(i[0],i[1]),(i=this._project(o[o.length-2],o[o.length-1],s,a))&&o.push(i[0],i[1]),o=this._clipFinite(e,o))for(let h=0,u=o.length,l,c=this._edgecode(o[u-2],o[u-1]);h<u;h+=2)l=c,c=this._edgecode(o[h],o[h+1]),l&&c&&(h=this._edge(e,l,c,o,h),u=o.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return o}_edge(e,t,r,n,s){for(;t!==r;){let a,o;switch(t){case 5:t=4;continue;case 4:t=6,a=this.xmax,o=this.ymin;break;case 6:t=2;continue;case 2:t=10,a=this.xmax,o=this.ymax;break;case 10:t=8;continue;case 8:t=9,a=this.xmin,o=this.ymax;break;case 9:t=1;continue;case 1:t=5,a=this.xmin,o=this.ymin;break}(n[s]!==a||n[s+1]!==o)&&this.contains(e,a,o)&&(n.splice(s,0,a,o),s+=2)}return s}_project(e,t,r,n){let s=1/0,a,o,i;if(n<0){if(t<=this.ymin)return null;(a=(this.ymin-t)/n)<s&&(i=this.ymin,o=e+(s=a)*r)}else if(n>0){if(t>=this.ymax)return null;(a=(this.ymax-t)/n)<s&&(i=this.ymax,o=e+(s=a)*r)}if(r>0){if(e>=this.xmax)return null;(a=(this.xmax-e)/r)<s&&(o=this.xmax,i=t+(s=a)*n)}else if(r<0){if(e<=this.xmin)return null;(a=(this.xmin-e)/r)<s&&(o=this.xmin,i=t+(s=a)*n)}return[o,i]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}_simplify(e){if(e&&e.length>4){for(let t=0;t<e.length;t+=2){const r=(t+2)%e.length,n=(t+4)%e.length;(e[t]===e[r]&&e[r]===e[n]||e[t+1]===e[r+1]&&e[r+1]===e[n+1])&&(e.splice(r,2),t-=2)}e.length||(e=null)}return e}}const Pt=2*Math.PI,X=Math.pow;function Ut(d){return d[0]}function zt(d){return d[1]}function $t(d){const{triangles:e,coords:t}=d;for(let r=0;r<e.length;r+=3){const n=2*e[r],s=2*e[r+1],a=2*e[r+2];if((t[a]-t[n])*(t[s+1]-t[n+1])-(t[s]-t[n])*(t[a+1]-t[n+1])>1e-10)return!1}return!0}function Bt(d,e,t){return[d+Math.sin(d+e)*t,e+Math.cos(d-e)*t]}class ye{static from(e,t=Ut,r=zt,n){return new ye("length"in e?Gt(e,t,r,n):Float64Array.from(qt(e,t,r,n)))}constructor(e){this._delaunator=new W(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&$t(e)){this.collinear=Int32Array.from({length:t.length/2},(c,f)=>f).sort((c,f)=>t[2*c]-t[2*f]||t[2*c+1]-t[2*f+1]);const i=this.collinear[0],h=this.collinear[this.collinear.length-1],u=[t[2*i],t[2*i+1],t[2*h],t[2*h+1]],l=1e-8*Math.hypot(u[3]-u[1],u[2]-u[0]);for(let c=0,f=t.length/2;c<f;++c){const g=Bt(t[2*c],t[2*c+1],l);t[2*c]=g[0],t[2*c+1]=g[1]}this._delaunator=new W(t)}else delete this.collinear;const r=this.halfedges=this._delaunator.halfedges,n=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let i=0,h=r.length;i<h;++i){const u=s[i%3===2?i-2:i+1];(r[i]===-1||a[u]===-1)&&(a[u]=i)}for(let i=0,h=n.length;i<h;++i)o[n[i]]=i;n.length<=2&&n.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=n[0],a[n[0]]=1,n.length===2&&(a[n[1]]=0,this.triangles[1]=n[1],this.triangles[2]=n[1]))}voronoi(e){return new Dt(this,e)}*neighbors(e){const{inedges:t,hull:r,_hullIndex:n,halfedges:s,triangles:a,collinear:o}=this;if(o){const l=o.indexOf(e);l>0&&(yield o[l-1]),l<o.length-1&&(yield o[l+1]);return}const i=t[e];if(i===-1)return;let h=i,u=-1;do{if(yield u=a[h],h=h%3===2?h-2:h+1,a[h]!==e)return;if(h=s[h],h===-1){const l=r[(n[e]+1)%r.length];l!==u&&(yield l);return}}while(h!==i)}find(e,t,r=0){if(e=+e,e!==e||(t=+t,t!==t))return-1;const n=r;let s;for(;(s=this._step(r,e,t))>=0&&s!==r&&s!==n;)r=s;return s}_step(e,t,r){const{inedges:n,hull:s,_hullIndex:a,halfedges:o,triangles:i,points:h}=this;if(n[e]===-1||!h.length)return(e+1)%(h.length>>1);let u=e,l=X(t-h[e*2],2)+X(r-h[e*2+1],2);const c=n[e];let f=c;do{let g=i[f];const m=X(t-h[g*2],2)+X(r-h[g*2+1],2);if(m<l&&(l=m,u=g),f=f%3===2?f-2:f+1,i[f]!==e)break;if(f=o[f],f===-1){if(f=s[(a[e]+1)%s.length],f!==g&&X(t-h[f*2],2)+X(r-h[f*2+1],2)<l)return f;break}}while(f!==c);return u}render(e){const t=e==null?e=new G:void 0,{points:r,halfedges:n,triangles:s}=this;for(let a=0,o=n.length;a<o;++a){const i=n[a];if(i<a)continue;const h=s[a]*2,u=s[i]*2;e.moveTo(r[h],r[h+1]),e.lineTo(r[u],r[u+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t){t===void 0&&(!e||typeof e.moveTo!="function")&&(t=e,e=null),t=t==null?2:+t;const r=e==null?e=new G:void 0,{points:n}=this;for(let s=0,a=n.length;s<a;s+=2){const o=n[s],i=n[s+1];e.moveTo(o+t,i),e.arc(o,i,t,0,Pt)}return r&&r.value()}renderHull(e){const t=e==null?e=new G:void 0,{hull:r,points:n}=this,s=r[0]*2,a=r.length;e.moveTo(n[s],n[s+1]);for(let o=1;o<a;++o){const i=2*r[o];e.lineTo(n[i],n[i+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new pe;return this.renderHull(e),e.value()}renderTriangle(e,t){const r=t==null?t=new G:void 0,{points:n,triangles:s}=this,a=s[e*=3]*2,o=s[e+1]*2,i=s[e+2]*2;return t.moveTo(n[a],n[a+1]),t.lineTo(n[o],n[o+1]),t.lineTo(n[i],n[i+1]),t.closePath(),r&&r.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,r=e.length/3;t<r;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new pe;return this.renderTriangle(e,t),t.value()}}function Gt(d,e,t,r){const n=d.length,s=new Float64Array(n*2);for(let a=0;a<n;++a){const o=d[a];s[a*2]=e.call(r,o,a,d),s[a*2+1]=t.call(r,o,a,d)}return s}function*qt(d,e,t,r){let n=0;for(const s of d)yield e.call(r,s,n,d),yield t.call(r,s,n,d),++n}class Vt{drawCellColors(e,t,r){const n=e.getContext("2d");if(!n)return;const{resolution:s,points:a,biomes:o}=t;n.clearRect(0,0,e.width,e.height),n.save(),n.scale(e.width/s,e.height/s);const h=ye.from(a,u=>u.x,u=>u.y).voronoi([0,0,s,s]);for(let u=0;u<a.length;u++){const l=h.cellPolygon(u);if(!l||l.length<3)continue;n.beginPath(),n.moveTo(l[0][0],l[0][1]);for(let f=1;f<l.length;f++)n.lineTo(l[f][0],l[f][1]);n.closePath();const c=r?o[u].greyscale:o[u].color;n.fillStyle=c,n.fill(),n.strokeStyle=c,n.lineWidth=.05,n.lineJoin="round",n.miterLimit=2,n.stroke()}n.restore()}}const O=d=>{const e=document.getElementById(d);if(!e)throw alert("UI init failed. Check element IDs."),new Error("UI init failed. Check element IDs.");return e},Ue=()=>He().substring(0,18).replaceAll("-","");document.addEventListener("DOMContentLoaded",()=>{let d=Ue();const e={...Ke},t=new Lt(d),r=new jt(d),n=new Vt,s=()=>{const b=t.generateMap(e);n.drawCellColors(u,b,e.greyScale)},a=()=>{const b=r.generate({}),T=O("map-title");T.textContent=b},o=()=>{const b=O("seed-input");b.value=d},i=()=>{a(),s(),o()},h=b=>{d=b,t.reSeed(d),r.reSeed(d),i()},u=O("map"),l=O("regen"),c=O("wavelength"),f=O("wavelengthValue"),g=O("rainfall"),m=O("rainfallValue"),y=O("seaLevel"),x=O("seaLevelValue"),v=O("shatter"),C=O("shatterValue"),_=O("edgeCurve"),A=O("edgeCurveValue"),M=O("resolution"),I=O("resolutionValue"),E=O("grayscale"),p=O("seed-input"),S=O("load-seed-btn");c.value=String(e.wavelength),f.textContent=e.wavelength.toFixed(2),g.value=String(e.rainfall),m.textContent=e.rainfall.toFixed(2),y.value=String(e.seaLevel),x.textContent=e.seaLevel.toFixed(2),v.value=String(e.shatter),C.textContent=e.shatter.toFixed(2),_.value=String(e.edgeCurve),A.textContent=e.edgeCurve.toFixed(2),M.value=String(e.resolution),I.textContent=e.resolution.toFixed(2),E.checked=e.greyScale,c.addEventListener("input",()=>{e.wavelength=Number(c.value),f.textContent=e.wavelength.toFixed(2),s()}),g.addEventListener("input",()=>{e.rainfall=Number(g.value),m.textContent=e.rainfall.toFixed(2),s()}),y.addEventListener("input",()=>{e.seaLevel=Number(y.value),x.textContent=e.seaLevel.toFixed(2),s()}),v.addEventListener("input",()=>{e.shatter=Number(v.value),C.textContent=e.shatter.toFixed(2),s()}),_.addEventListener("input",()=>{e.edgeCurve=Number(_.value),A.textContent=e.edgeCurve.toFixed(2),s()}),M.addEventListener("input",()=>{e.resolution=Number(M.value),I.textContent=e.resolution.toFixed(2),s()}),E.addEventListener("input",()=>{e.greyScale=E.checked,s()}),l.addEventListener("click",()=>{d=Ue(),t.reSeed(d),r.reSeed(d),i()}),i(),O("download").addEventListener("click",()=>{const b=document.createElement("a");b.download=`map-${Date.now()}.png`,b.href=u.toDataURL("image/png"),b.click()}),S.addEventListener("click",()=>{const b=p.value.trim();h(b)})});document.addEventListener("DOMContentLoaded",()=>{const d=document.getElementById("mobile-warning");if(!d)return;(/Mobi|Android|iPhone|iPad/i.test(navigator.userAgent)||window.innerWidth<768)&&(console.log("MOBILE"),d.classList.add("show"))});
