(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(a){if(a.ep)return;a.ep=!0;const s=t(a);fetch(a.href,s)}})();const z=[];for(let l=0;l<256;++l)z.push((l+256).toString(16).slice(1));function st(l,e=0){return(z[l[e+0]]+z[l[e+1]]+z[l[e+2]]+z[l[e+3]]+"-"+z[l[e+4]]+z[l[e+5]]+"-"+z[l[e+6]]+z[l[e+7]]+"-"+z[l[e+8]]+z[l[e+9]]+"-"+z[l[e+10]]+z[l[e+11]]+z[l[e+12]]+z[l[e+13]]+z[l[e+14]]+z[l[e+15]]).toLowerCase()}let _e;const it=new Uint8Array(16);function ot(){if(!_e){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");_e=crypto.getRandomValues.bind(crypto)}return _e(it)}const lt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Me={randomUUID:lt};function rt(l,e,t){l=l||{};const n=l.random??l.rng?.()??ot();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,st(n)}function ct(l,e,t){return Me.randomUUID&&!l?Me.randomUUID():rt(l)}const Je=["SIMLISH","TAMIL","QUECHUA","NAHUATL","SANSKRIT","BABYLONIAN","ETRUSCAN","MESOPOTAMIAN","KOPTIC","ROMANCE","GERMANIC","TURKISH","BANTU_LIKE","AFRICAN_WEST","AFRICAN_HORN","CN","JP","POLYNESIAN","MONGOLIC","GREEK","RUSSIAN","LATIN","CELESTIC","INFERNIC","ARCANE","DEEP_SPEECH","GOBLINIC","TECHNARCH","SIRENIC","OOGA_BOOGA","DWARVISH","HALFLING","NOCTURNIC","DERPTONGUE","TOADISH","BANANAIC","LYRICIAN","ANGLISH","NEW_ANGLISH","AMERICAN_PLACE","ONOMATOPOEIC","CRETAN","GAULISH","NORSE","THAI","SWAHILI","ARABIC","HEBREW"],ht=["a","e","i","o","u"],ut=["ai","au","ei","ia","io","oa","ue","ui"],mt=["a","e","i","o","u","ia","io","ie","ea"],dt=["a","i","u","aa","ii","uu","ai","au"],oe={SIMLISH:{onsets:["","b","d","g","k","p","t","m","n","f","s","v","z","w","l","r","bl","pl","fr","sn","gl","dr","tr","kl","br","fl","dag","sul","wub","noob","fraba","zo","plum","gaba","yibs","laba"],vowels:["a","e","i","o","u","oo","ee","uh","ah","ai","oi","ya","wa"],codas:["b","g","p","m","n","t","s","sh","z","bo","doo","na","ba","loo","rah","gaba"],codaChance:.6,medials:["yaba","doo","plum","laba","yibs","dag","fraba","nooboo","soola","woohoo","snarf","wubba","zo","booba","gooba","weebs","flarn","snug","vibsy"],medialMorphChance:.5,suffixes:["boo","loo","bah","gah","yibs","so","la","bana","weeb","flarn","plum","vaba"],maxConsRun:2,maxVowelRun:3,minVowelRatio:.35,treatYAsVowel:!0,minSyllables:2,maxSyllables:6,clusterLinker:"a",vowelLinker:"oo"},TAMIL:{onsets:["","k","t","p","m","n","ñ","ng","y","r","l","v","th","sh","ch","j","zh","rr","nn","ll","tam","kan","kar","mar","sar","sel","ram","lak","mur","bal","pal","pon","mani"],vowels:["a","e","i","o","u","aa","ee","ii","oo","uu","ai","au"],codas:["","m","n","ng","l","r","rr","zh"],codaChance:.25,medials:["nadu","pura","puram","patti","kudi","ur","oor","kottai","malai","mala","kulam","thiru","selva","mani","kannan","murugan","arun","kumar","vel","amma"],medialMorphChance:.45,suffixes:["nadu","puram","pura","patti","ur","oor","kudi","kulam","malai","kottai","thiru","nagar","veli"],maxConsRun:2,maxVowelRun:3,minVowelRatio:.45,treatYAsVowel:!1,minSyllables:2,maxSyllables:5,clusterLinker:"u",vowelLinker:"y"},QUECHUA:{onsets:["a","i","u","k","q","t","p","s","m","n","l","r","y","w","ch","kh","qh","ll","ny","hu","huam","hua","han","hak","yak","yac","sac","sak"],vowels:["a","i","u","ia","ua","ai","iu","au"],codas:["","n","k","q","s"],codaChance:.3,medials:["pampa","marka","suyu","tambo","pata","urcu","urko","qucha","cocha","yaku","sacha","chakra","wasi","kancha","suyu","runa","ayllu"],medialMorphChance:.45,suffixes:["suyu","pampa","marka","pata","tambo","wasi","qucha","cocha","yaku","sacha","kancha","runa"],maxConsRun:2,maxVowelRun:2,minVowelRatio:.4,treatYAsVowel:!1,minSyllables:2,maxSyllables:5,clusterLinker:"i",vowelLinker:"y"},NAHUATL:{onsets:["a","e","i","o","ka","ke","ki","ko","kwa","kwe","kwi","kwo","ma","me","mi","mo","na","ne","ni","no","pa","pe","pi","po","ta","te","ti","to","tl","tla","tle","tli","tlo","ya","ye","yi","yo","hua","hue","hui","huo","cu","cue","cui","co","qui","que","za","ze","zi","zo"],vowels:["a","e","i","o","u","ia","ua","ui","ei","oa"],codas:["n","t","l","tl","lli","pan","can","yan","hua","zin","te","co"],codaChance:.65,medials:["tlan","hua","co","can","pan","te","xi","zo","na","ya","otl","atl","mix","tzon","pilli","mecatl","quetz","chol","tonal"],medialMorphChance:.5,suffixes:["tlan","tlal","co","can","pan","yan","tepetl","huacan","miztli","quetzal","tonal","nahuac","zuma","tlani","teotl"],maxConsRun:2,maxVowelRun:2,minVowelRatio:.35,treatYAsVowel:!0,minSyllables:2,maxSyllables:4,clusterLinker:"a",vowelLinker:"h"},SANSKRIT:{onsets:["a","i","u","e","o","ka","kha","ga","gha","cha","ch","ja","jha","ta","tha","da","dha","pa","pha","ba","bha","ma","na","ra","la","sa","sha","sri","va","ya","ha","tra","dra","pra","bra","kra","gra","pla","gla","kla","ksha","jna"],vowels:["a","i","u","e","o","aa","ii","uu","ai","au","ri","ru"],codas:["","m","n","s","h","r","ya","ra","na"],codaChance:.4,medials:["indra","deva","raja","pura","nagara","giri","sar","vara","varta","kuta","kaya","maya","yoga","sena","kashi","tirtha","ksetra","alaya","bhumi","ratna"],medialMorphChance:.5,suffixes:["pura","nagara","sthana","desa","loka","varsha","ksetra","alaya","ashrama","mandir","grama"],maxConsRun:3,maxVowelRun:2,minVowelRatio:.33,treatYAsVowel:!1,minSyllables:2,maxSyllables:5,clusterLinker:"a",vowelLinker:"y"},BABYLONIAN:{onsets:["ab","ak","am","an","ar","as","at","ba","bal","bar","bel","bil","da","dar","du","en","es","er","ga","gal","gur","ha","hal","ka","kar","ku","la","lam","ma","mar","mu","na","nam","nar","ni","nu","pa","rab","ram","sar","sha","sham","sin","sum","tar","tam","ur","ush","zal","zim"],vowels:["a","e","i","u","ia","ai","ua","aa","ei"],codas:["n","m","r","l","sh","t","k","s","b","g","z","th","um","il"],codaChance:.7,medials:["ash","esh","ish","ush","nin","bel","mar","lam","tam","ur","an","en","sin","ram","sam","bal","nam","gal","dur","zur","esh","mur","lum","sum"],medialMorphChance:.55,suffixes:["ra","ur","esh","an","en","il","im","um","nin","lam","tam","bel","duk","zum","mar"],maxConsRun:3,maxVowelRun:2,minVowelRatio:.28,treatYAsVowel:!1,minSyllables:2,maxSyllables:5,clusterLinker:"u",vowelLinker:"r"},ETRUSCAN:{onsets:["a","e","i","o","u","th","ph","ch","cl","fl","tr","vl","ml","pl","vel","lar","tur","uni","ais","seth","arn","mar"],vowels:["a","e","i","o","u","ae","ai","ei","ia","io","ui"],codas:["s","n","r","th","ch","m","l","t","sna","ni","ce"],codaChance:.55,medials:["lar","thur","vel","uni","tur","seth","arn","mar","avl","clan","than","ath","aci","nes"],medialMorphChance:.5,suffixes:["th","ce","na","le","ra","chi","sna","ni","thil","ate"],maxConsRun:2,maxVowelRun:2,minVowelRatio:.35,treatYAsVowel:!0,minSyllables:2,maxSyllables:5,clusterLinker:"a",vowelLinker:"l"},MESOPOTAMIAN:{onsets:["an","en","in","un","ur","ni","ku","lu","mu","nu","su","ba","da","ga","ka","ra","na","pa","ti","zi","ash","esh","ish","ush","nin","ding","lil","bel","mar","nab","gil","is","tam","sam"],vowels:["a","e","i","u","ia","ai","ua","ei","aa","uu"],codas:["n","m","r","l","sh","t","k","s","b","g","z","th","ur"],codaChance:.65,medials:["lil","bel","ash","esh","nin","ur","ki","zu","ra","an","utu","sin","tam","nam","gil","lam","esh","dum","ish","mur","sum","zur","mal","kal"],medialMorphChance:.55,suffixes:["ra","ur","esh","ish","an","en","il","im","um","nin","lam","tam","bel","duk","zum","mar"],maxConsRun:3,maxVowelRun:2,minVowelRatio:.28,treatYAsVowel:!1,minSyllables:2,maxSyllables:5,clusterLinker:"u",vowelLinker:"r"},KOPTIC:{onsets:["an","am","ba","ka","ra","sa","ma","na","pa","te","ne","mer","ket","sen","neb","hotep","set","ankh","khem","tep","ram","mut","thot","ptah"],vowels:["a","e","i","o","u","aa","ia","ai","au","ei","ua","oa"],codas:["t","k","m","n","r","s","h","p","kh","sh","pt","ph","th","sek"],codaChance:.6,medials:["ra","maat","seth","amon","neter","ankh","hotep","nef","sek","tep","amonr","phar","mut","sob","khaf","nefer","ram","akh","tem","sen"],medialMorphChance:.55,suffixes:["hotep","ankh","ra","tep","mut","set","amen","nef","sek","ka","ur","het","shut"],maxConsRun:2,maxVowelRun:2,minVowelRatio:.33,treatYAsVowel:!1,minSyllables:2,maxSyllables:6,clusterLinker:"e",vowelLinker:"n"},ROMANCE:{onsets:["b","c","d","f","g","l","m","n","p","r","s","t","br","cr","dr","fl","gl","gr","pl","pr","tr","vr","ch","cl","fr","bl","ros","san"],vowels:[...mt,"ue","eo","ia","io","ai","au"],codas:["n","r","s","l","m","t","z"],codaChance:.5,medials:["del","dor","ver","mar","val","lor","ria","lia","mia","fort","bell","ciel","rosa","vino","fior","cast","mont","sant","riv","cor"],medialMorphChance:.45,suffixes:["ia","aria","esia","orio","ano","ino","etta","enza","ella","esco","ura","ito","a","o","es"],maxConsRun:2,maxVowelRun:3,minVowelRatio:.35,treatYAsVowel:!0,minSyllables:2,maxSyllables:5,clusterLinker:"e",vowelLinker:"l"},GERMANIC:{onsets:["b","d","f","g","h","k","l","m","n","p","r","s","t","w","th","br","cr","dr","fr","gr","kr","pr","tr","st","sk","sp","sn","sm","sw","sch"],vowels:[...ht,...ut,"au","ei","ie","oo"],codas:["nd","rt","rm","rg","lf","rk","lt","st","sk","n","r","m","l","k","t"],codaChance:.7,medials:["wald","heim","mark","gard","dorf","stein","burg","holt","feld","lund","brun","thal","hart","grim"],medialMorphChance:.35,suffixes:["land","heim","berg","burg","holt","feld","stein","fjord","mere","vale"],maxConsRun:3,maxVowelRun:2,minVowelRatio:.25,treatYAsVowel:!0,minSyllables:2,maxSyllables:5,clusterLinker:"e",vowelLinker:"n"},TURKISH:{onsets:["a","e","i","o","u","b","c","ch","d","f","g","h","j","k","l","m","n","p","r","s","sh","t","v","y","z","bl","br","kl","kr","pl","pr","tr","dr","gl","gr"],vowels:["a","e","i","o","u","ai","ei","oi","au","ia","io","ua"],codas:["k","n","r","l","m","s","t","an","ar","er","in","ir","un","ur","lar","ler","tan","tor","tur","kan"],codaChance:.65,medials:["kara","gol","dag","tash","bahar","deniz","su","yer","chay","ova","cham","gok","tash","saray","kapi","hisar","koy","shehir","ay","chinar","yel","kuz","yildiz","dere","ishik","toprak"],medialMorphChance:.6,suffixes:["koy","shehir","ova","golu","hisar","kent","yaka","li","lu","lik","luk","pinar","dere","tash","chay","su","han","kapi","yer","yurt"],maxConsRun:2,maxVowelRun:2,minVowelRatio:.4,treatYAsVowel:!1,minSyllables:2,maxSyllables:4,clusterLinker:"a",vowelLinker:"y"},SEMITIC:{onsets:["al","ar","as","bal","dar","qal","mal","ram","sam","zar","bar","sar","ham","has","kar","lam","nah","tas","rah","fa","za"],vowels:[...dt,"aa","ai","ei","ia"],codas:["n","m","r","l","s","h","t","d"],codaChance:.55,medials:["har","sar","ram","bar","rah","nah","far","kal","tal","mir","zah","mar"],medialMorphChance:.55,suffixes:["ia","aya","iyya","ah","an","un","iel","em","een"],maxConsRun:2,maxVowelRun:3,minVowelRatio:.32,treatYAsVowel:!1,minSyllables:2,maxSyllables:5,clusterLinker:"a",vowelLinker:"y"},BANTU_LIKE:{onsets:["ba","ka","ma","na","sa","la","ga","pa","ra","cha","tsa","kwa","gwa","mwa","nla","mba","nda","nga","ha"],vowels:["a","e","i","o","u","a","a","i","o","u"],codas:[""],codaChance:.05,medials:["na","ma","ka","ra","ba","la"],medialMorphChance:.25,suffixes:["ia","ana","uma","ela","olo"],maxConsRun:1,maxVowelRun:4,minVowelRatio:.5,treatYAsVowel:!0,minSyllables:2,maxSyllables:6,clusterLinker:"",vowelLinker:"n"},AFRICAN_WEST:{onsets:["a","ba","da","ka","fa","ga","la","ma","na","oba","ola","ade","kw","gb","ch","ny","eke","ife","olu","ayo","tunde","chi","obi"],vowels:["a","e","i","o","u","ai","oa","ie","ua","aa","ei"],codas:["n","m","wa","ra","ya","ba","","do"],codaChance:.4,medials:["loba","femi","kwe","tunde","chukwu","nwa","kofi","yemi","sade","dapo","bisi","tola","ayo","seun"],medialMorphChance:.5,suffixes:["la","ba","ra","ni","do","ma","si","ye","wa","le"],maxConsRun:2,maxVowelRun:4,minVowelRatio:.45,treatYAsVowel:!0,minSyllables:2,maxSyllables:6,clusterLinker:"a",vowelLinker:"n"},AFRICAN_HORN:{onsets:["ab","ad","as","ba","da","ha","ka","ma","na","sa","ra","ta","gez","tes","hab","sel","mer","zer","yon","lem","kid","sen","tek","geb","yor"],vowels:["a","e","i","o","u","aa","ee","ei","ia","ua","io"],codas:["s","m","n","l","t","k","r","","h"],codaChance:.5,medials:["sel","geb","tek","yon","hab","mar","zer","wold","yas","lem","kid","ber","sen","hak"],medialMorphChance:.55,suffixes:["el","es","os","on","u","en","em","et","ah"],maxConsRun:2,maxVowelRun:3,minVowelRatio:.4,treatYAsVowel:!0,minSyllables:2,maxSyllables:6,clusterLinker:"e",vowelLinker:"n"},CN:{onsets:["b","p","m","f","d","t","n","l","g","k","h","zh","ch","sh","r","z","c","s","j","q","x","y","w","gu","ku","hu","lu","mu","xi","liang","long"],vowels:["a","o","e","i","u","ü","ai","ei","ao","ou","ia","ie","iao","iu","ua","uo","ui","üe","er","an","ang","en","eng","ong"],codas:["n","ng","","r"],codaChance:.45,medials:["shan","jiang","he","hu","zhou","dao","lin","yang","qing","jing","guo","cheng","hai","feng","liang","hua","long","yun","xing","mei","xi","tai","hong","lan","tian","bao"],medialMorphChance:.4,suffixes:["shan","dao","zhou","guo","cheng","men","hai","yuan","jing","tan","he","lin","feng","yun","xiang"],maxConsRun:2,maxVowelRun:3,minVowelRatio:.3,treatYAsVowel:!1,minSyllables:2,maxSyllables:5,clusterLinker:"e",vowelLinker:"n"},JP:{onsets:["k","s","t","n","h","m","y","r","w","g","z","d","b","p","ky","sh","ch","ny","hy","my","ry","gy","j","py","tak","min","har","kaz","yam","mor","sug","tos","ken","rin","aki","yosh","nao"],vowels:["a","i","u","e","o","ai","ou","ei"],codas:["","n"],codaChance:.4,medials:["mori","yama","kawa","gawa","shima","jima","saka","hara","tani","naka","oka","zawa","miya","sugi","tora","fune","nori","kaze","seki","matsu","hana","take","ishi","sora","minato","arai","kuni","aki","nobu","hiko"],medialMorphChance:.4,suffixes:["to","ken","do","fu","shi","mura","saki","hama","gane","no","ya","zaki","moto","dai","zawa","sawa","gawa","jima","sei"],maxConsRun:2,maxVowelRun:3,minVowelRatio:.35,treatYAsVowel:!1,minSyllables:2,maxSyllables:5,clusterLinker:"u",vowelLinker:"n"},POLYNESIAN:{onsets:["","h","k","l","m","n","p","r","t","w","f","v","wh","ng"],vowels:["a","e","i","o","u"],codas:["","’","ʻ"],codaChance:.18,medials:["moa","moana","rangi","tonga","tai","wai","puna","tapu","mana","ariki","tiki","honu","pua","mata","ika","nui","loa","roa","hale","fale","mauna","nalu","kai","kea","waiu","pala","koro"],medialMorphChance:.38,suffixes:["nui","roa","loa","rangi","moana","tonga","tai","puna","motu","kai","tahi","ora","kiri"],maxConsRun:1,maxVowelRun:4,minVowelRatio:.5,treatYAsVowel:!1,minSyllables:2,maxSyllables:6,clusterLinker:"",vowelLinker:"n"},MONGOLIC:{onsets:["ba","bo","bu","ta","to","tu","ga","go","gu","da","do","du","kha","kh","qa","qar","gur","dar","bor","nar","sar","bat","alt","bogd","sukh","ul","tur","tor","ur","ar","or"],vowels:["a","e","i","o","u","aa","ee","ii","oo","uu","ai","oi","ua"],codas:["n","r","g","t","s","k",""],codaChance:.55,medials:["bator","baatar","dorj","suren","erdene","tungal","bayar","bold","gan","khaan","ger","gol","dalai","del","uur","saihan","altai"],medialMorphChance:.5,suffixes:["bator","baatar","gur","tengri","dalai","khaan","khun","gol","ger"],maxConsRun:2,maxVowelRun:2,minVowelRatio:.34,treatYAsVowel:!1,minSyllables:2,maxSyllables:6,clusterLinker:"e",vowelLinker:"n"},GREEK:{onsets:["a","e","i","o","u","k","p","t","n","m","l","r","s","d","b","g","x","ch","ph","th","ps","kr","br","tr"],vowels:["a","e","i","o","u","ai","ei","oi","ou","au","ia","io"],codas:["s","n","r","m","l","os","on","as","is"],codaChance:.55,medials:["polis","agora","acro","therm","geo","philo","neo","arch","dora","kastro","nik","dios"],medialMorphChance:.45,suffixes:["os","on","ia","is","as","ikon","ides"],maxConsRun:2,maxVowelRun:2,minVowelRatio:.33,treatYAsVowel:!1,minSyllables:2,maxSyllables:5,clusterLinker:"o",vowelLinker:"n"},RUSSIAN:{onsets:["b","v","g","d","z","k","l","m","n","p","r","s","t","br","bl","kr","kl","pr","pl","gr","gl","dr","dl","st","sk","str","sl","sm","sn","zh","ch","sh","ts","tz","tr"],vowels:["a","e","i","o","u","ya","yo","yu","ia","ie","io","oi"],codas:["v","n","r","sk","st","ch","sh","k","vich","nik","nov","mir","gor","grad","lin","ev","ov","in","en"],codaChance:.75,medials:["slav","grad","mir","bor","dov","vol","krav","mirs","krov","bel","ost","tar","grom","step","vel","ser","zar"],medialMorphChance:.55,suffixes:["ov","in","sky","ska","ovich","ev","enko","grad","mir","ovka","ovna","aya"],maxConsRun:3,maxVowelRun:2,minVowelRatio:.25,treatYAsVowel:!1,minSyllables:2,maxSyllables:5,clusterLinker:"e",vowelLinker:"y"},LATIN:{onsets:["a","e","i","o","u","b","c","d","f","g","l","m","n","p","r","s","t","v","cl","fl","gl","pr","tr","cr","pl","fr","gr","dr","qu","sc","sp","st","ct","ph"],vowels:["a","e","i","o","u","ae","oe","au","ia","io","ua","uo","eu"],codas:["s","n","r","m","t","l","us","um","a","is","os"],codaChance:.58,medials:["dom","val","magn","clar","fort","sanct","imper","aure","vit","cel","luc","reg","mart","pax","bell","civ","jur","templ","script","capit","aug","pont","caes","roman"],medialMorphChance:.52,suffixes:["us","um","a","or","is","ianus","ensis","atus","itas","orium","arium","alis","ivus","itas"],maxConsRun:2,maxVowelRun:3,minVowelRatio:.35,treatYAsVowel:!0,minSyllables:2,maxSyllables:5,clusterLinker:"e",vowelLinker:"l"},CELESTIC:{onsets:["a","ae","e","el","al","il","ol","ul","cel","ser","ver","lir","aur","eir","mir","thal","val"],vowels:["a","e","i","o","u","ae","ea","ai","ia","ie","io","ou","ui"],codas:["l","n","r","s","th","el","iel","ar","is","as"],codaChance:.55,medials:["ael","iel","ion","ora","iel","ir","ara","uri","arion"],medialMorphChance:.6,suffixes:["iel","ael","ion","ora","is","arion","iel","eth"],maxConsRun:2,maxVowelRun:2,minVowelRatio:.4,treatYAsVowel:!0,minSyllables:2,maxSyllables:5,clusterLinker:"e",vowelLinker:"r"},INFERNIC:{onsets:["gr","kr","dr","br","thr","vr","zr","kl","sk","sn","gn","vrog","ulg","zor","rak","gash","morg"],vowels:["a","o","u","e","ia","oa","ua","ai","oi"],codas:["th","k","g","r","z","x","sh","kh","gh","n","m"],codaChance:.75,medials:["gor","zul","rak","thr","khar","vur","drak","mor","gron","vul"],medialMorphChance:.45,suffixes:["oth","ar","rak","gul","zor","eth","uzad","ash","ath"],maxConsRun:4,maxVowelRun:4,minVowelRatio:.2,treatYAsVowel:!1,minSyllables:2,maxSyllables:5,clusterLinker:"a",vowelLinker:"r"},ARCANE:{onsets:["a","e","i","o","u","x","z","v","q","k","s","r","th","sh","ch","ph","gh","xa","xi","ze","zy","qu","ka","ly","sy","va","or","ny"],vowels:["a","e","i","o","u","ae","ia","ie","io","ei","ou","ui"],codas:["n","r","s","th","x","z","sh","m","l","t"],codaChance:.6,medials:["ar","en","is","os","ith","al","or","ir","um","ex","ul"],medialMorphChance:.5,suffixes:["ar","en","is","os","ith","or","ul","um","ae","ion"],maxConsRun:3,maxVowelRun:3,minVowelRatio:.3,treatYAsVowel:!0,minSyllables:2,maxSyllables:5,clusterLinker:"e",vowelLinker:"r"},DEEP_SPEECH:{onsets:["gh","gr","kr","zr","zh","xh","kl","ql","k’","x’","t’","sh","sk","thl","vr","vx","dl","rk"],vowels:["a","u","o","e","ia","ua","ao","ou",""],codas:["th","x","g","k","z","sh","’th","’x","’g","n"],codaChance:.8,medials:["ul","gur","zha","kth","rax","xul","gath","urh","shul","vrax","qor","thrul","zoth"],medialMorphChance:.45,suffixes:["’thul","’gath","’nax","’ul","’rax","oth","zoth","gath","khul"],maxConsRun:4,maxVowelRun:4,minVowelRatio:.2,treatYAsVowel:!1,minSyllables:2,maxSyllables:5,clusterLinker:"’",vowelLinker:"h"},GOBLINIC:{onsets:["g","gr","kr","kl","sn","sk","sm","sp","st","tr","dr","bl","br","pl","gl","zz","gn","ch","sc"],vowels:["a","e","i","o","u","aa","oo","ei","oi"],codas:["k","g","n","m","b","t","z","zz","sh","p","x",""],codaChance:.7,medials:["grub","snag","krat","blit","skrag","drub","gnar","plok","zib","krin","grot","snib"],medialMorphChance:.45,suffixes:["ak","ig","ok","nob","zit","gob","bag","pik","nip","ogg"],maxConsRun:3,maxVowelRun:3,minVowelRatio:.28,treatYAsVowel:!1,minSyllables:2,maxSyllables:5,clusterLinker:"i",vowelLinker:"g"},TECHNARCH:{onsets:["auto","mecha","syn","alg","dat","net","cyb","neuro","quant","proto","nano","vector","core","node","grid","flux","servo"],vowels:["a","e","i","o","u","ai","io","ea","ou","ui"],codas:["on","ix","ex","um","is","os","","core"],codaChance:.6,medials:["tron","link","proc","calc","mach","net","bot","loop","core","data"],medialMorphChance:.5,suffixes:["on","ix","ex","ium","aris","logicus","tek","sys"],maxConsRun:3,maxVowelRun:3,minVowelRatio:.3,treatYAsVowel:!0,minSyllables:2,maxSyllables:6,clusterLinker:"e",vowelLinker:"l"},SIRENIC:{onsets:["a","e","i","o","u","l","n","m","s","v","r","h","w","sh","th","ph","ch","wh","ly","ny","sel","sir","mar","nai","ora","thal","vel","mel","lun","aqu","ond"],vowels:["a","e","i","o","u","ae","ai","ea","ee","ia","ie","io","oa","oe","ou","ua","ue","ui"],codas:["n","r","l","s","th","sh","h","m","el","en","ir","is","a","ia","ine"],codaChance:.45,medials:["ara","ela","ine","ora","ula","iri","oni","ari","una","esi","mar","sel","vai","wen","lua","nys"],medialMorphChance:.4,suffixes:["ine","is","ir","iel","ora","ara","una","elle","en","ys","eth","wen"],maxConsRun:2,maxVowelRun:4,minVowelRatio:.4,treatYAsVowel:!0,minSyllables:2,maxSyllables:6,clusterLinker:"l",vowelLinker:"n"},OOGA_BOOGA:{onsets:["","b","g","k","m","n","t","p","w","h","bg","gb","gr","kr"],vowels:["o","a","u","oo","oa","ou","ua","uga","oga"],codas:["","g","k","ng","ga","ka","gk"],codaChance:.72,medials:["ooga","booga","boga","maka","taka","gora","gugu","koko","boko"],medialMorphChance:.35,suffixes:["uga","booga","g","ka","ko","ga","bog","ok"],maxConsRun:2,maxVowelRun:4,minVowelRatio:.4,treatYAsVowel:!1,minSyllables:2,maxSyllables:5,clusterLinker:"g",vowelLinker:"k"},DWARVISH:{onsets:["b","d","g","k","m","n","r","t","v","z","br","dr","gr","kr","tr","thr","kh"],vowels:["a","e","i","o","u","ai","oi","au"],codas:["r","n","m","k","g","d","nd","rd","ld","rn","rm","rg","rk"],codaChance:.75,medials:["dur","grim","bar","kar","grom","thal","dun","fund","brak","stenn","stein"],medialMorphChance:.45,suffixes:["in","ar","orn","grin","dun","hald","heim","hold"],maxConsRun:3,maxVowelRun:3,minVowelRatio:.28,treatYAsVowel:!1,minSyllables:2,maxSyllables:5,clusterLinker:"e",vowelLinker:"r"},HALFLING:{onsets:["b","d","f","g","h","j","k","l","m","n","p","r","s","t","w","br","cl","fl","pl","wh"],vowels:["a","e","i","o","u","ie","ea","ai","oa","oi","oo"],codas:["n","r","l","m","s","t","ck","nd","rt","ft","ley","ton"],codaChance:.55,medials:["apple","bur","brook","dale","mill","merry","will","hedge","bottle","puddle"],medialMorphChance:.3,suffixes:["ton","ford","wick","brook","hill","bury","shaw","combe","ley"],maxConsRun:2,maxVowelRun:3,minVowelRatio:.35,treatYAsVowel:!0,minSyllables:2,maxSyllables:5,clusterLinker:"e",vowelLinker:"l"},NOCTURNIC:{onsets:["v","s","z","r","l","m","n","d","t","c","ch","sh","vr","cr","dr","str"],vowels:["a","e","i","o","u","ae","ei","ia","io","ou","ui"],codas:["r","s","th","x","z","n","l","re","is","us","oth","yx"],codaChance:.65,medials:["nos","sang","vel","mor","car","lac","umbr","noir","vlad","rav","dusk"],medialMorphChance:.45,suffixes:["ius","elle","oire","an","ar","or","yx","ath","osa"],maxConsRun:3,maxVowelRun:3,minVowelRatio:.3,treatYAsVowel:!0,minSyllables:2,maxSyllables:6,clusterLinker:"e",vowelLinker:"r"},DERPTONGUE:{onsets:["b","g","k","p","d","t","f","m","n","r","s","bl","gr","kr","sn","pl","fl","z","v"],vowels:["a","e","i","o","u","oo","ee","uh","ah","ow"],codas:["","g","k","p","t","n","m","b","sh","zz","rp","nk"],codaChance:.6,medials:["derp","blor","snar","plop","gorp","flub","drool","bonk","boop"],medialMorphChance:.55,suffixes:["er","us","o","ee","oo","ah","uh","boop","onk"],maxConsRun:2,maxVowelRun:4,minVowelRatio:.33,treatYAsVowel:!0,minSyllables:2,maxSyllables:6,clusterLinker:"e",vowelLinker:"p"},TOADISH:{onsets:["gr","kr","br","cro","fro","gl","pl","r","bl","cr","tr","dr"],vowels:["o","u","oo","oa","ou","uh","a","ua"],codas:["g","k","rk","rg","mp","b","bb","gk","nk","rr","p"],codaChance:.75,medials:["croa","rib","grub","glo","slop","murk","drib","blob"],medialMorphChance:.45,suffixes:["og","ug","ump","ok","ogg","onk","croak"],maxConsRun:3,maxVowelRun:3,minVowelRatio:.28,treatYAsVowel:!1,minSyllables:2,maxSyllables:5,clusterLinker:"r",vowelLinker:"g"},BANANAIC:{onsets:["","b","d","g","k","m","n","p","t","w","h","ba","na","ma","pa","ga","da"],vowels:["a","e","i","o","u","aa","ee","oo","ai","au"],codas:["","na","ma","pa","ba","ga","ka","la","ha"],codaChance:.6,medials:["na","nana","mama","papa","gaga","lala","haha","wawa","baba","dada"],medialMorphChance:.6,suffixes:["na","nana","banana","mana","pana","bana","lala","haha"],maxConsRun:1,maxVowelRun:4,minVowelRatio:.5,treatYAsVowel:!0,minSyllables:2,maxSyllables:6,clusterLinker:"",vowelLinker:"n"},LYRICIAN:{onsets:["a","e","i","o","u","l","n","m","r","s","v","f","h","y","al","el","il","ol","ul","ar","en","ir","or","ur","ly","ny","th","ph"],vowels:["a","e","i","o","u","ai","ei","ia","io","oa","ue","ui"],codas:["l","n","r","s","th","m","el","en","ir","is","ar","al"],codaChance:.45,medials:["ara","eli","ian","ora","ina","ira","ala","esi","len","mir","var","ser","vel","lin"],medialMorphChance:.35,suffixes:["iel","is","en","el","ora","ine","ar","eth","iel","ane"],maxConsRun:2,maxVowelRun:4,minVowelRatio:.4,treatYAsVowel:!0,minSyllables:2,maxSyllables:6,clusterLinker:"e",vowelLinker:"l"},ANGLISH:{onsets:["b","br","bl","c","cl","cr","d","dr","f","fl","fr","g","gr","gl","h","j","k","kr","l","m","n","p","pl","pr","r","s","sl","sm","sn","sp","st","sw","t","tr","v","w","wh"],vowels:["a","e","i","o","u","ai","ea","ie","oa","oo","ou","uh","ar","er"],codas:["b","d","f","g","k","l","m","n","p","r","s","t","ck","nd","nt","st","sp","sh","th","rd","rk","rm","rl","lp","ft"],codaChance:.6,medials:["ing","ish","est","ard","orn","all","and","ell","ock","ump","old","ent","ram","win","ber","ble","trum","croft","shire","worth"],medialMorphChance:.4,suffixes:["ton","ham","worth","wick","well","ford","croft","den","fell","bury","brook","mere","stead"],maxConsRun:3,maxVowelRun:3,minVowelRatio:.3,treatYAsVowel:!0,minSyllables:2,maxSyllables:6,clusterLinker:"e",vowelLinker:"r"},NEW_ANGLISH:{onsets:["a","b","br","c","cl","cr","d","f","fl","fr","g","gl","gr","h","j","k","kr","l","m","n","p","pl","pr","r","s","sl","sm","sp","st","t","tr","v","w","well","brook","grove","nex","ever","fair","north","east","west","green","bright","clear","sil","blue","gold"],vowels:["a","e","i","o","u","ai","ea","ie","oa","ou","ar","er","or"],codas:["n","r","s","t","m","l","d","k","x","nd","nt","rd","rn","st","ft","den","ton","ford","ly"],codaChance:.5,medials:["well","brook","vale","fold","ridge","moor","bank","port","field","mill","crest","grove","point","gate","worth","ford","haven","side","wick","holt","mark"],medialMorphChance:.4,suffixes:["well","fold","worth","ridge","vale","hill","gate","point","mill","brook","haven","croft","grove","port","ly","ton","den","sy","corp","soft","tek"],maxConsRun:3,maxVowelRun:3,minVowelRatio:.3,treatYAsVowel:!0,minSyllables:2,maxSyllables:6,clusterLinker:"e",vowelLinker:"r"},PHRASIC:{onsets:["kingdom","princedom","duchy","country","nation","state","municipality","geographic region","empire","republic","caliphate","sultanate","khanate"],vowels:[" of the "," near the "," beyond the "," under the "," within the "," amidst the "," atop the "," along the "," beside the "," past the "," toward the "],medials:["ancient ","misty ","forgotten ","sleepy ","haunted ","moonlit ","crumbling ","stormy ","shimmering ","quiet ","hidden ","lush ","lonely ","glimmering ","frozen ","sunken ","shattered ","lush ","barren "],medialMorphChance:.55,codas:["crying moon ","endless soup ","large canyon ","sleepy village ","forgotten beans ","ninth duck ","friendly ghost ","friendly place ","froggy pond ","dank cave ","cheese regrets ","goblin camp ","cat sanctuary ","graves of your ancestors ","questionable wifi ","unseen noodles ","echoing pickle ","eternal goose ","mouse hole ","village of cannibals ","world's largest sandcastle "],codaChance:1,suffixes:[" retreat"," crossing"," hollow"," falls"," creek"," point"," pass"," trail"," rest"," bend"," grove"],maxConsRun:6,maxVowelRun:8,minVowelRatio:.1,treatYAsVowel:!0,minSyllables:1,maxSyllables:1,clusterLinker:"",vowelLinker:""},AMERICAN_PLACE:{onsets:["a","e","i","o","u","y","b","c","d","f","g","h","k","l","m","n","p","r","s","t","v","w","bl","br","cr","dr","fl","fr","gr","kl","kr","pl","pr","tr","sk","sl","sm","sn","sp","st","sw","sh","ch","wh"],vowels:["a","e","i","o","u","ai","ei","oa","ou","ee","oo","ea","ui","au"],codas:["n","m","l","r","s","t","nd","nt","st","rd","rt","rk","rn","rm","sh","ch"],codaChance:.6,medials:["cedar","pine","fir","spruce","moss","fern","stone","river","sound","bay","cove","harbor","mount","peak","rain","fog","coast","trail","falls","glen","grove","ridge","forest","isle","port"],medialMorphChance:.55,suffixes:["ton","ville","port","haven","bay","harbor","falls","grove","ridge","view","dale","river","sound","coast","point","beach","isle","field","mount","springs","trail","landing"],maxConsRun:3,maxVowelRun:2,minVowelRatio:.35,treatYAsVowel:!0,minSyllables:2,maxSyllables:4,clusterLinker:"a",vowelLinker:"r"},ONOMATOPOEIC:{onsets:["b","p","t","d","k","g","ch","sh","s","z","f","v","wh","m","n","r","l","cl","cr","dr","fl","fr","gl","gr","pl","pr","sl","sn","sp","st","sw","th","bl","br","tr","wr"],vowels:["a","e","i","o","u","oo","ee","ah","uh","ow","oi","ay","aw","er","ya"],codas:[""],codaChance:.8,medials:["bang","buzz","crash","clang","ding","bop","wham","splash","crunch","snap","thud","whirr","fizz","whoosh","click","clack","clonk","drip","drop","plop","pop","smack","zing","zoom"],medialMorphChance:.6,suffixes:["o","a","ah","ee","oo","um","zap","bang","pop","boing","wham","crash","chop","buzz","thunk","swoosh","zap","kaboom","whizz"],maxConsRun:3,maxVowelRun:3,minVowelRatio:.45,treatYAsVowel:!0,minSyllables:2,maxSyllables:3,clusterLinker:"",vowelLinker:""},CRETAN:{onsets:["a","e","i","o","u","k","p","t","n","m","l","r","s","d","b","g","x","ch","ph","th","kr","kl","kn","pr","tr","dr","br","st","sk","sm","sp","vr","fr","gr","ps"],vowels:["a","e","i","o","u","ai","ei","oi","ou","au","ia","io","ea","eo"],codas:["s","n","r","m","l","os","on","as","is","es","thos","ros","tos","nos"],codaChance:.65,medials:["mino","knos","thera","kyra","akro","amni","arkad","phaes","kydon","melid","ion","lass","herm","gaia","kalos","neka","doro","kris","anem","pyrg","lyth","zyra"],medialMorphChance:.55,suffixes:["os","los","on","ia","is","as","es","inos","idas","ion","ara","thos","ros","dos","nos","yra"],maxConsRun:2,maxVowelRun:2,minVowelRatio:.4,treatYAsVowel:!1,minSyllables:2,maxSyllables:5,clusterLinker:"a",vowelLinker:"n"},GAULISH:{onsets:["a","e","i","o","u","y","b","c","d","g","l","m","n","p","r","s","t","v","br","cr","dr","gr","pr","tr","bl","cl","gl","pl","gn","sn","st","sk","gw","dw","sw"],vowels:["a","e","i","o","u","ai","ei","oi","ou","au","ia","io","uo","eu"],codas:["n","r","s","l","m","x","nos","rix","mar","dor","dur","tan","ron","lon","tor","con","dos"],codaChance:.7,medials:["carn","brig","duno","mag","nem","ver","seg","treb","arv","corb","belg","vind","cam","and","lux","dubr","tan","tor","brog","pen","rhed","rix","allon","catu","mor","nemet"],medialMorphChance:.6,suffixes:["dunum","magus","briga","ritum","conna","rix","on","ix","acos","atis","marus","torum","tanum","durum","briva","sarton","lonna","ancon","morion"],maxConsRun:3,maxVowelRun:2,minVowelRatio:.35,treatYAsVowel:!0,minSyllables:2,maxSyllables:5,clusterLinker:"a",vowelLinker:"n"},NORSE:{onsets:["a","e","i","o","u","y","b","d","f","g","h","k","l","m","n","r","s","t","v","bl","br","dr","gr","kr","pr","tr","sk","sn","st","sv","sm","hl","hr","hn","fj","gj","kj","thr","th","kn"],vowels:["a","e","i","o","u","y","ae","ei","au","oy"],codas:["r","n","l","s","m","t","k","rn","nd","ld","rd","rk","sk","st","tt","f","g","ng","nn","ss"],codaChance:.7,medials:["fjall","heim","fjord","vik","dal","gard","stad","borg","sund","ness","fjordr","holt","lund","finn","skog","bryn","ulf","stein","eld","vatn","havn","sand","fjord","bak","kross","drang"],medialMorphChance:.6,suffixes:["heim","fjord","vik","dal","gard","stad","borg","ness","holt","lund","fjordr","fjordir","fell","vatn","havn","fjordur","fjordin","fjordrheim","fjordvik","heimr"],maxConsRun:3,maxVowelRun:2,minVowelRatio:.3,treatYAsVowel:!0,minSyllables:1,maxSyllables:3,clusterLinker:"a",vowelLinker:"r"},THAI:{onsets:["a","e","i","o","u","b","ch","d","f","h","k","kh","l","m","n","ng","p","ph","r","s","t","th","w","y","kl","kr","phl","phr","pr","tr","thl","ch","khw","kw","ng"],vowels:["a","e","i","o","u","aa","ee","ii","oo","uu","ai","ao","ia","ua","uea","oe","ui"],codas:["n","ng","m","k","t","p","an","am","ang","at","ap","ak"],codaChance:.55,medials:["ban","chiang","thong","sai","klong","lam","na","nong","phra","chai","thai","sam","rat","tha","yan","rang","pa","muang","wiang","dong","lom","lak","phon","pha","wan"],medialMorphChance:.55,suffixes:["buri","ratcha","thani","phum","nai","nakhon","lam","chai","sak","yai","noi","wan","daeng","lek","phat","nong","pathum","thong","phra","sam","sawan","muang"],maxConsRun:2,maxVowelRun:3,minVowelRatio:.45,treatYAsVowel:!0,minSyllables:2,maxSyllables:3,clusterLinker:"a",vowelLinker:"n"},SWAHILI:{onsets:["a","e","i","o","u","b","ch","d","f","g","h","j","k","l","m","n","p","r","s","t","v","w","y","z","bw","kw","mw","sw","ny","ng","nd","mb","mj","nj"],vowels:["a","e","i","o","u","aa","ee","oo","ua","ia","ai","au","ei"],codas:["a","e","i","o","u","la","na","ma","ra","ba","ka","sa","ta","za","ga"],codaChance:.4,medials:["kili","zani","mara","safa","pemba","ziba","tanga","moyo","bahari","nyota","mwanga","simba","rafi","mani","kulu","mali","bora","uzuri","jua","kaya","pwani","tembo","uhuru","rafiki","anga","ziwa","muya","fala"],medialMorphChance:.55,suffixes:["bora","safi","tanga","zani","puri","moyo","bahari","mara","pwani","nuru","zuri","rafiki","mali","tembo","nyota","wazi","ngoma","kaya"],maxConsRun:2,maxVowelRun:3,minVowelRatio:.5,treatYAsVowel:!0,minSyllables:2,maxSyllables:4,clusterLinker:"a",vowelLinker:"n"},ARABIC:{onsets:["a","e","i","o","u","b","d","f","g","h","j","k","l","m","n","q","r","s","t","w","y","z","sh","kh","gh","th","dh","sa","za","fa","ha","ta","na","ra"],vowels:["a","i","u","ai","au","ia","ua","ei","ou"],codas:["n","m","r","s","l","d","h","t","b","f","an","ah","ar","at","as","un","am","im","id","ir","ul","ur"],codaChance:.7,medials:["rah","sala","nura","malik","amir","jabal","wadi","qamar","sharq","gharb","layl","nur","najm","safa","zahir","barq","aziz","jamal","iman","hakim","fajr","sabir","rasul","tariq","zaman","khidr","samir","raha","siraj","karim"],medialMorphChance:.6,suffixes:["ah","an","ar","at","un","iya","iyyah","een","oon","abad","stan","iyya","iyah","lah","rah","din","mal","bar","ram","mun"],maxConsRun:2,maxVowelRun:2,minVowelRatio:.35,treatYAsVowel:!0,minSyllables:2,maxSyllables:5,clusterLinker:"a",vowelLinker:"l"},HEBREW:{onsets:["a","e","i","o","u","b","d","g","h","k","l","m","n","p","r","s","t","sh","ch","tz","z","y","v","br","dr","kr","pr","sr","tr","bn","ml","shl","chl","tz","yh"],vowels:["a","e","i","o","u","ai","ei","oi","au","ia","ua","aa","ee","oo"],codas:["n","m","l","r","s","t","h","el","am","on","en","ah","im","oth","an","ar","et"],codaChance:.8,medials:["beth","el","shal","yah","zur","ram","har","dav","shalom","bar","oren","amir","nahal","tzur","lev","raam","eden","dor","aviv","yeru","hadar","tamar","noam","gil","shom","sion","eshel"],medialMorphChance:.5,suffixes:["el","ah","on","eth","im","oth","an","ar","or","am","yah","iel","zion","ram","dor","lev","tam","esh","oth","ur"],maxConsRun:2,maxVowelRun:2,minVowelRatio:.35,treatYAsVowel:!0,minSyllables:2,maxSyllables:4,clusterLinker:"a",vowelLinker:"h"}};function X(l){let e=gt(l);return e===0&&(e=1831565813),function(){return e^=e<<13,e^=e>>>17,e^=e<<5,(e>>>0)%1e6/1e6}}function Z(l,e,t){return l+t()*(e-l)}function Q(l,e){return l[Math.floor(e()*l.length)]}function xe(l,e){const t=l.reduce((s,i)=>s+i.prob,0);if(Math.abs(t-1)>1e-5)throw new Error(`weightedRandomChoice: total probability must be exactly 1. got ${t}`);const n=e()*t;let a=0;for(const{val:s,prob:i}of l)if(a+=i,n<=a)return s;return l[l.length-1].val}function gt(l){let e=2166136261;for(let t=0;t<l.length;t++)e^=l.charCodeAt(t),e=Math.imul(e,16777619);return e>>>0}const ft=["resolution","rainfall","jitter","zoom","seaLevel","clumpiness","elevationContrast","moistureContrast","terrainFrequency","weatherFrequency"],pt=["resolution","jitter","zoom","rainfall","seaLevel","clumpiness","elevationContrast","moistureContrast","theme","terrainFrequency","weatherFrequency"],bt=l=>{if(!l.seed)return alert("save file must contain a seed"),!1;if(!l.mapSettings)return alert("save file must contain map settings object"),!1;if(typeof l.mapSettings!="object"||l.mapSettings===null)return alert("map settings object must be an object"),!1;for(const e of pt)if(!(e in l.mapSettings))return alert(`save file must contain ${e} in map settings object`),!1;return!0},pe={resolution:.5,jitter:.5,zoom:0,terrainFrequency:.65,weatherFrequency:.65,rainfall:.65,seaLevel:.51,clumpiness:.8,elevationContrast:.7,moistureContrast:.5,theme:"default"},Y={LINE_COUNT_PROBS:[{val:1,prob:.6},{val:2,prob:.3},{val:3,prob:.1}],LENGTH_RANGE_BY_COUNT:{1:[1,5],2:[.5,2],3:[.5,1]},BEND_RANGE_BY_COUNT:{1:[.1,.32],2:[.12,.3],3:[.08,.3]},ENDPOINT_JITTER_FRACTION_RANGE:[.15,.3],RADIUS_JITTER_RANGE:[.1,1.3],BELL_BASE_RANGE:[.4,.7],BELL_GAIN_RANGE:[.4,.63],FBM2_W1_RANGE:[.25,.45],FBM2_W2_RANGE:[.14,.2],CENTER_DRIFT_RANGE:[.3,.7],BASE_RADIUS_RANGE:[.4,.8],WARP_STRENGTH_RANGE:[.3,.7],WARP_FREQUENCY_RANGE:[3.5,4.5],RIPPLE_INTENSITY_RANGE:[.4,.5],SOFTNESS_RANGE:[.3,.7],AA_RADIUS_RANGE:[.1,.3]},ee={CURVE_COARSE_STEPS:30,REFINE_STEPS:[.08,.025],COAST_FIELD_SCALE:.52,AA_CARDINAL_OFFSETS:[[1,0],[-1,0],[0,1],[0,-1]]},W={NEUTRAL_CENTER_POINT:.5,PARABOLA_EPS:1e-6};function U(l,e){return Z(l[0],l[1],e)}class yt{_settings;_selectedLanguages=[...Je];_mapName;_syncingFreq=!1;constructor(){const t=new URL(window.location.href).searchParams,n=(i,o)=>parseFloat(t.get(String(i))??String(o)),a=ft.reduce((i,o)=>(i[o]=n(o,pe[o]),i),{});this._settings={...a,theme:t.get("theme")??pe.theme};const s=t.get("name")||t.get("seed");this._mapName=s||""}get settings(){return this._settings}get selectedLanguages(){return this._selectedLanguages}get mapName(){return this._mapName}get syncingFreq(){return this._syncingFreq}set settings(e){this._settings=e}set selectedLanguages(e){this._selectedLanguages=e}set mapName(e){this._mapName=e}set syncingFreq(e){this._syncingFreq=e}updateSetting(e,t){this._settings[e]=t}}const Le=".mapn",ye=(l,...e)=>{l&&(console.log("....................."),console.log(l)),e.forEach(({key:t,value:n})=>{if(typeof n=="object"){console.log(`   ${t}:`);for(const[a,s]of Object.entries(n))console.log(`      ${a}: ${s}`)}else console.log(typeof n=="number"?`   ${t}: ${n.toFixed(4)}`:`   ${t}: ${n}`)})},Qe=60,J=255,wt=5,kt=(1<<wt)-1,K=2,_t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,Et=6,Rt=3,q=16,vt=.2126,At=.7152,Ct=.0722,St=.03928,xt=12.92,It=2.4,Mt=.055,Lt=1.055;function Nt(l){let e=l.replace(/^#/,"");e.length===Rt&&(e=e.replace(/./g,h=>h+h));const t=parseInt(e.slice(0,K),q)/J,n=parseInt(e.slice(K,2*K),q)/J,a=parseInt(e.slice(2*K,3*K),q)/J,s=Math.max(t,n,a),i=Math.min(t,n,a),o=(s+i)/2,r=s-i;let c=0,m=0;if(r){switch(m=r/(1-Math.abs(2*o-1)),s){case t:c=(n-a)/r+(n<a?Et:0);break;case n:c=(a-t)/r+2;break;case a:c=(t-n)/r+4;break}c*=Qe}return{h:c,s:m,l:o}}function Tt(l,e,t){const n=(1-Math.abs(2*t-1))*e,a=l/Qe,s=n*(1-Math.abs(a%2-1));let[i,o,r]=[0,0,0];a>=0&&a<1?[i,o]=[n,s]:a<2?[i,o]=[s,n]:a<3?[o,r]=[n,s]:a<4?[o,r]=[s,n]:a<5?[i,r]=[s,n]:[i,r]=[n,s];const c=t-n/2;return et((i+c)*J,(o+c)*J,(r+c)*J)}function et(l,e,t){return("#"+Math.round(l).toString(q).padStart(K,"0")+Math.round(e).toString(q).padStart(K,"0")+Math.round(t).toString(q).padStart(K,"0")).toUpperCase()}function Ie(l){const e=_t.exec(l);return e?{r:parseInt(e[1],q),g:parseInt(e[2],q),b:parseInt(e[3],q)}:null}function Vt(l,e){const t=Ie(l);return t?`rgba(${t.r}, ${t.g}, ${t.b}, ${e})`:l}function Dt(l,e,t){const[n,a,s]=[l,e,t].map(i=>{const o=i/J;return o<=St?o/xt:Math.pow((o+Mt)/Lt,It)});return vt*n+At*a+Ct*s}function Ot(l){const e=Ie(l);if(!e)return l;const t=J/kt,n=Math.round(e.r/t)*t,a=Math.round(e.g/t)*t,s=Math.round(e.b/t)*t;return et(n,a,s)}const tt={default:{bg:"#131322",text:"#c9ada7",highlight:"#c9ada7",highlightText:"#181828"},arid:{bg:"#131322",text:"#bbae8c",highlight:"#96854d",highlightText:"#181828"},lush:{bg:"#131322",text:"#b8c9c1",highlight:"#4d8f45",highlightText:"#181828"},rainbow:{bg:"#44447a",text:"#f8961e",highlight:"#f94144",highlightText:"#e8f5e9"},oasis:{bg:"#A89168",text:"#04009A",highlight:"#E3D2A6",highlightText:"#04009A"},grayscale:{bg:"#5a5a5a",text:"#e0e0e0",highlight:"#2e2d2d",highlightText:"#e0e0e0"},volcano:{bg:"#1A1A1A",text:"#907168",highlight:"#78493C",highlightText:"#CDCEC4"}};function Ne(l){const e=Ie(l);if(!e)return"";const t=Dt(e.r,e.g,e.b);return t<.5?`brightness(0) saturate(100%) invert(0) brightness(${t*200}%)`:`brightness(0) saturate(100%) invert(1) brightness(${50+t*100}%)`}function Ee(l){const e=tt[l],t=document.documentElement;t.style.setProperty("--bg",e.bg),t.style.setProperty("--text",e.text),t.style.setProperty("--highlight",e.highlight),t.style.setProperty("--highlightText",e.highlightText);const n=Ne(e.text),a=Ne(e.highlightText);t.style.setProperty("--text-filter",n),t.style.setProperty("--highlightText-filter",a)}function Yt(){const l=[];for(const[e,t]of Object.entries(tt))l.push(`
      /* ${e} theme colors */
      #themeRadioList label:has(input[value="${e}"]):hover {
        background-color: ${Vt(t.highlight,.75)};
        color: ${t.highlightText};
      }
      #themeRadioList label:has(input[value="${e}"]:checked),
      #themeRadioList label:has(input[value="${e}"]:active) {
        background-color: ${t.highlight};
        color: ${t.highlightText};
      }
    `);return l.join(`
`)}const j=(l,e=0,t=1)=>l<e?e:l>t?t:l,G=(l,e,t,n=0,a=1)=>l+(e-l)*(t-n)/(a-n),Ht=(l,e)=>{let t;return(...n)=>{t!==void 0&&clearTimeout(t),t=window.setTimeout(()=>{l(...n),t=void 0},e)}},$=11102230246251565e-32,F=134217729,zt=(3+8*$)*$;function Re(l,e,t,n,a){let s,i,o,r,c=e[0],m=n[0],h=0,u=0;m>c==m>-c?(s=c,c=e[++h]):(s=m,m=n[++u]);let d=0;if(h<l&&u<t)for(m>c==m>-c?(i=c+s,o=s-(i-c),c=e[++h]):(i=m+s,o=s-(i-m),m=n[++u]),s=i,o!==0&&(a[d++]=o);h<l&&u<t;)m>c==m>-c?(i=s+c,r=i-s,o=s-(i-r)+(c-r),c=e[++h]):(i=s+m,r=i-s,o=s-(i-r)+(m-r),m=n[++u]),s=i,o!==0&&(a[d++]=o);for(;h<l;)i=s+c,r=i-s,o=s-(i-r)+(c-r),c=e[++h],s=i,o!==0&&(a[d++]=o);for(;u<t;)i=s+m,r=i-s,o=s-(i-r)+(m-r),m=n[++u],s=i,o!==0&&(a[d++]=o);return(s!==0||d===0)&&(a[d++]=s),d}function Gt(l,e){let t=e[0];for(let n=1;n<l;n++)t+=e[n];return t}function ue(l){return new Float64Array(l)}const Pt=(3+16*$)*$,Ft=(2+12*$)*$,Ut=(9+64*$)*$*$,ne=ue(4),Te=ue(8),Ve=ue(12),De=ue(16),B=ue(4);function Bt(l,e,t,n,a,s,i){let o,r,c,m,h,u,d,g,f,b,p,y,_,C,R,A,L,I;const w=l-a,v=t-a,E=e-s,S=n-s;C=w*S,u=F*w,d=u-(u-w),g=w-d,u=F*S,f=u-(u-S),b=S-f,R=g*b-(C-d*f-g*f-d*b),A=E*v,u=F*E,d=u-(u-E),g=E-d,u=F*v,f=u-(u-v),b=v-f,L=g*b-(A-d*f-g*f-d*b),p=R-L,h=R-p,ne[0]=R-(p+h)+(h-L),y=C+p,h=y-C,_=C-(y-h)+(p-h),p=_-A,h=_-p,ne[1]=_-(p+h)+(h-A),I=y+p,h=I-y,ne[2]=y-(I-h)+(p-h),ne[3]=I;let N=Gt(4,ne),T=Ft*i;if(N>=T||-N>=T||(h=l-w,o=l-(w+h)+(h-a),h=t-v,c=t-(v+h)+(h-a),h=e-E,r=e-(E+h)+(h-s),h=n-S,m=n-(S+h)+(h-s),o===0&&r===0&&c===0&&m===0)||(T=Ut*i+zt*Math.abs(N),N+=w*m+S*o-(E*c+v*r),N>=T||-N>=T))return N;C=o*S,u=F*o,d=u-(u-o),g=o-d,u=F*S,f=u-(u-S),b=S-f,R=g*b-(C-d*f-g*f-d*b),A=r*v,u=F*r,d=u-(u-r),g=r-d,u=F*v,f=u-(u-v),b=v-f,L=g*b-(A-d*f-g*f-d*b),p=R-L,h=R-p,B[0]=R-(p+h)+(h-L),y=C+p,h=y-C,_=C-(y-h)+(p-h),p=_-A,h=_-p,B[1]=_-(p+h)+(h-A),I=y+p,h=I-y,B[2]=y-(I-h)+(p-h),B[3]=I;const D=Re(4,ne,4,B,Te);C=w*m,u=F*w,d=u-(u-w),g=w-d,u=F*m,f=u-(u-m),b=m-f,R=g*b-(C-d*f-g*f-d*b),A=E*c,u=F*E,d=u-(u-E),g=E-d,u=F*c,f=u-(u-c),b=c-f,L=g*b-(A-d*f-g*f-d*b),p=R-L,h=R-p,B[0]=R-(p+h)+(h-L),y=C+p,h=y-C,_=C-(y-h)+(p-h),p=_-A,h=_-p,B[1]=_-(p+h)+(h-A),I=y+p,h=I-y,B[2]=y-(I-h)+(p-h),B[3]=I;const x=Re(D,Te,4,B,Ve);C=o*m,u=F*o,d=u-(u-o),g=o-d,u=F*m,f=u-(u-m),b=m-f,R=g*b-(C-d*f-g*f-d*b),A=r*c,u=F*r,d=u-(u-r),g=r-d,u=F*c,f=u-(u-c),b=c-f,L=g*b-(A-d*f-g*f-d*b),p=R-L,h=R-p,B[0]=R-(p+h)+(h-L),y=C+p,h=y-C,_=C-(y-h)+(p-h),p=_-A,h=_-p,B[1]=_-(p+h)+(h-A),I=y+p,h=I-y,B[2]=y-(I-h)+(p-h),B[3]=I;const V=Re(x,Ve,4,B,De);return De[V-1]}function de(l,e,t,n,a,s){const i=(e-s)*(t-a),o=(l-a)*(n-s),r=i-o,c=Math.abs(i+o);return Math.abs(r)>=Pt*c?r:-Bt(l,e,t,n,a,s,c)}const Oe=Math.pow(2,-52),ge=new Uint32Array(512);class be{static from(e,t=$t,n=Zt){const a=e.length,s=new Float64Array(a*2);for(let i=0;i<a;i++){const o=e[i];s[2*i]=t(o),s[2*i+1]=n(o)}return new be(s)}constructor(e){const t=e.length>>1;if(t>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(n*3),this._halfedges=new Int32Array(n*3),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:a,_hullHash:s}=this,i=e.length>>1;let o=1/0,r=1/0,c=-1/0,m=-1/0;for(let w=0;w<i;w++){const v=e[2*w],E=e[2*w+1];v<o&&(o=v),E<r&&(r=E),v>c&&(c=v),E>m&&(m=E),this._ids[w]=w}const h=(o+c)/2,u=(r+m)/2;let d,g,f;for(let w=0,v=1/0;w<i;w++){const E=ve(h,u,e[2*w],e[2*w+1]);E<v&&(d=w,v=E)}const b=e[2*d],p=e[2*d+1];for(let w=0,v=1/0;w<i;w++){if(w===d)continue;const E=ve(b,p,e[2*w],e[2*w+1]);E<v&&E>0&&(g=w,v=E)}let y=e[2*g],_=e[2*g+1],C=1/0;for(let w=0;w<i;w++){if(w===d||w===g)continue;const v=Xt(b,p,y,_,e[2*w],e[2*w+1]);v<C&&(f=w,C=v)}let R=e[2*f],A=e[2*f+1];if(C===1/0){for(let E=0;E<i;E++)this._dists[E]=e[2*E]-e[0]||e[2*E+1]-e[1];ie(this._ids,this._dists,0,i-1);const w=new Uint32Array(i);let v=0;for(let E=0,S=-1/0;E<i;E++){const N=this._ids[E],T=this._dists[N];T>S&&(w[v++]=N,S=T)}this.hull=w.subarray(0,v),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(de(b,p,y,_,R,A)<0){const w=g,v=y,E=_;g=f,y=R,_=A,f=w,R=v,A=E}const L=qt(b,p,y,_,R,A);this._cx=L.x,this._cy=L.y;for(let w=0;w<i;w++)this._dists[w]=ve(e[2*w],e[2*w+1],L.x,L.y);ie(this._ids,this._dists,0,i-1),this._hullStart=d;let I=3;n[d]=t[f]=g,n[g]=t[d]=f,n[f]=t[g]=d,a[d]=0,a[g]=1,a[f]=2,s.fill(-1),s[this._hashKey(b,p)]=d,s[this._hashKey(y,_)]=g,s[this._hashKey(R,A)]=f,this.trianglesLen=0,this._addTriangle(d,g,f,-1,-1,-1);for(let w=0,v,E;w<this._ids.length;w++){const S=this._ids[w],N=e[2*S],T=e[2*S+1];if(w>0&&Math.abs(N-v)<=Oe&&Math.abs(T-E)<=Oe||(v=N,E=T,S===d||S===g||S===f))continue;let D=0;for(let k=0,M=this._hashKey(N,T);k<this._hashSize&&(D=s[(M+k)%this._hashSize],!(D!==-1&&D!==n[D]));k++);D=t[D];let x=D,V;for(;V=n[x],de(N,T,e[2*x],e[2*x+1],e[2*V],e[2*V+1])>=0;)if(x=V,x===D){x=-1;break}if(x===-1)continue;let P=this._addTriangle(x,S,n[x],-1,-1,a[x]);a[S]=this._legalize(P+2),a[x]=P,I++;let H=n[x];for(;V=n[H],de(N,T,e[2*H],e[2*H+1],e[2*V],e[2*V+1])<0;)P=this._addTriangle(H,S,V,a[S],-1,a[H]),a[S]=this._legalize(P+2),n[H]=H,I--,H=V;if(x===D)for(;V=t[x],de(N,T,e[2*V],e[2*V+1],e[2*x],e[2*x+1])<0;)P=this._addTriangle(V,S,x,-1,a[x],a[V]),this._legalize(P+2),a[V]=P,n[x]=x,I--,x=V;this._hullStart=t[S]=x,n[x]=t[H]=S,n[S]=H,s[this._hashKey(N,T)]=S,s[this._hashKey(e[2*x],e[2*x+1])]=x}this.hull=new Uint32Array(I);for(let w=0,v=this._hullStart;w<I;w++)this.hull[w]=v,v=n[v];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(Wt(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:a}=this;let s=0,i=0;for(;;){const o=n[e],r=e-e%3;if(i=r+(e+2)%3,o===-1){if(s===0)break;e=ge[--s];continue}const c=o-o%3,m=r+(e+1)%3,h=c+(o+2)%3,u=t[i],d=t[e],g=t[m],f=t[h];if(jt(a[2*u],a[2*u+1],a[2*d],a[2*d+1],a[2*g],a[2*g+1],a[2*f],a[2*f+1])){t[e]=f,t[o]=u;const p=n[h];if(p===-1){let _=this._hullStart;do{if(this._hullTri[_]===h){this._hullTri[_]=e;break}_=this._hullPrev[_]}while(_!==this._hullStart)}this._link(e,p),this._link(o,n[i]),this._link(i,h);const y=c+(o+1)%3;s<ge.length&&(ge[s++]=y)}else{if(s===0)break;e=ge[--s]}}return i}_link(e,t){this._halfedges[e]=t,t!==-1&&(this._halfedges[t]=e)}_addTriangle(e,t,n,a,s,i){const o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=n,this._link(o,a),this._link(o+1,s),this._link(o+2,i),this.trianglesLen+=3,o}}function Wt(l,e){const t=l/(Math.abs(l)+Math.abs(e));return(e>0?3-t:1+t)/4}function ve(l,e,t,n){const a=l-t,s=e-n;return a*a+s*s}function jt(l,e,t,n,a,s,i,o){const r=l-i,c=e-o,m=t-i,h=n-o,u=a-i,d=s-o,g=r*r+c*c,f=m*m+h*h,b=u*u+d*d;return r*(h*b-f*d)-c*(m*b-f*u)+g*(m*d-h*u)<0}function Xt(l,e,t,n,a,s){const i=t-l,o=n-e,r=a-l,c=s-e,m=i*i+o*o,h=r*r+c*c,u=.5/(i*c-o*r),d=(c*m-o*h)*u,g=(i*h-r*m)*u;return d*d+g*g}function qt(l,e,t,n,a,s){const i=t-l,o=n-e,r=a-l,c=s-e,m=i*i+o*o,h=r*r+c*c,u=.5/(i*c-o*r),d=l+(c*m-o*h)*u,g=e+(i*h-r*m)*u;return{x:d,y:g}}function ie(l,e,t,n){if(n-t<=20)for(let a=t+1;a<=n;a++){const s=l[a],i=e[s];let o=a-1;for(;o>=t&&e[l[o]]>i;)l[o+1]=l[o--];l[o+1]=s}else{const a=t+n>>1;let s=t+1,i=n;le(l,a,s),e[l[t]]>e[l[n]]&&le(l,t,n),e[l[s]]>e[l[n]]&&le(l,s,n),e[l[t]]>e[l[s]]&&le(l,t,s);const o=l[s],r=e[o];for(;;){do s++;while(e[l[s]]<r);do i--;while(e[l[i]]>r);if(i<s)break;le(l,s,i)}l[t+1]=l[i],l[i]=o,n-s+1>=i-t?(ie(l,e,s,n),ie(l,e,t,i-1)):(ie(l,e,t,i-1),ie(l,e,s,n))}}function le(l,e,t){const n=l[e];l[e]=l[t],l[t]=n}function $t(l){return l[0]}function Zt(l){return l[1]}const Ye=1e-6;class te{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,n){e=+e,t=+t,n=+n;const a=e+n,s=t;if(n<0)throw new Error("negative radius");this._x1===null?this._+=`M${a},${s}`:(Math.abs(this._x1-a)>Ye||Math.abs(this._y1-s)>Ye)&&(this._+="L"+a+","+s),n&&(this._+=`A${n},${n},0,1,1,${e-n},${t}A${n},${n},0,1,1,${this._x1=a},${this._y1=s}`)}rect(e,t,n,a){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+n}v${+a}h${-n}Z`}value(){return this._||null}}class Se{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class Kt{constructor(e,[t,n,a,s]=[0,0,960,500]){if(!((a=+a)>=(t=+t))||!((s=+s)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(e.points.length*2),this.vectors=new Float64Array(e.points.length*2),this.xmax=a,this.xmin=t,this.ymax=s,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:n},vectors:a}=this;let s,i;const o=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let f=0,b=0,p=n.length,y,_;f<p;f+=3,b+=2){const C=n[f]*2,R=n[f+1]*2,A=n[f+2]*2,L=e[C],I=e[C+1],w=e[R],v=e[R+1],E=e[A],S=e[A+1],N=w-L,T=v-I,D=E-L,x=S-I,V=(N*x-T*D)*2;if(Math.abs(V)<1e-9){if(s===void 0){s=i=0;for(const H of t)s+=e[H*2],i+=e[H*2+1];s/=t.length,i/=t.length}const P=1e9*Math.sign((s-L)*x-(i-I)*D);y=(L+E)/2-P*x,_=(I+S)/2+P*D}else{const P=1/V,H=N*N+T*T,k=D*D+x*x;y=L+(x*H-T*k)*P,_=I+(N*k-D*H)*P}o[b]=y,o[b+1]=_}let r=t[t.length-1],c,m=r*4,h,u=e[2*r],d,g=e[2*r+1];a.fill(0);for(let f=0;f<t.length;++f)r=t[f],c=m,h=u,d=g,m=r*4,u=e[2*r],g=e[2*r+1],a[c+2]=a[m]=d-g,a[c+3]=a[m+1]=u-h}render(e){const t=e==null?e=new te:void 0,{delaunay:{halfedges:n,inedges:a,hull:s},circumcenters:i,vectors:o}=this;if(s.length<=1)return null;for(let m=0,h=n.length;m<h;++m){const u=n[m];if(u<m)continue;const d=Math.floor(m/3)*2,g=Math.floor(u/3)*2,f=i[d],b=i[d+1],p=i[g],y=i[g+1];this._renderSegment(f,b,p,y,e)}let r,c=s[s.length-1];for(let m=0;m<s.length;++m){r=c,c=s[m];const h=Math.floor(a[c]/3)*2,u=i[h],d=i[h+1],g=r*4,f=this._project(u,d,o[g+2],o[g+3]);f&&this._renderSegment(u,d,f[0],f[1],e)}return t&&t.value()}renderBounds(e){const t=e==null?e=new te:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const n=t==null?t=new te:void 0,a=this._clip(e);if(a===null||!a.length)return;t.moveTo(a[0],a[1]);let s=a.length;for(;a[0]===a[s-2]&&a[1]===a[s-1]&&s>1;)s-=2;for(let i=2;i<s;i+=2)(a[i]!==a[i-2]||a[i+1]!==a[i-1])&&t.lineTo(a[i],a[i+1]);return t.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,n=e.length/2;t<n;++t){const a=this.cellPolygon(t);a&&(a.index=t,yield a)}}cellPolygon(e){const t=new Se;return this.renderCell(e,t),t.value()}_renderSegment(e,t,n,a,s){let i;const o=this._regioncode(e,t),r=this._regioncode(n,a);o===0&&r===0?(s.moveTo(e,t),s.lineTo(n,a)):(i=this._clipSegment(e,t,n,a,o,r))&&(s.moveTo(i[0],i[1]),s.lineTo(i[2],i[3]))}contains(e,t,n){return t=+t,t!==t||(n=+n,n!==n)?!1:this.delaunay._step(e,t,n)===e}*neighbors(e){const t=this._clip(e);if(t)for(const n of this.delaunay.neighbors(e)){const a=this._clip(n);if(a){e:for(let s=0,i=t.length;s<i;s+=2)for(let o=0,r=a.length;o<r;o+=2)if(t[s]===a[o]&&t[s+1]===a[o+1]&&t[(s+2)%i]===a[(o+r-2)%r]&&t[(s+3)%i]===a[(o+r-1)%r]){yield n;break e}}}}_cell(e){const{circumcenters:t,delaunay:{inedges:n,halfedges:a,triangles:s}}=this,i=n[e];if(i===-1)return null;const o=[];let r=i;do{const c=Math.floor(r/3);if(o.push(t[c*2],t[c*2+1]),r=r%3===2?r-2:r+1,s[r]!==e)break;r=a[r]}while(r!==i&&r!==-1);return o}_clip(e){if(e===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(t===null)return null;const{vectors:n}=this,a=e*4;return this._simplify(n[a]||n[a+1]?this._clipInfinite(e,t,n[a],n[a+1],n[a+2],n[a+3]):this._clipFinite(e,t))}_clipFinite(e,t){const n=t.length;let a=null,s,i,o=t[n-2],r=t[n-1],c,m=this._regioncode(o,r),h,u=0;for(let d=0;d<n;d+=2)if(s=o,i=r,o=t[d],r=t[d+1],c=m,m=this._regioncode(o,r),c===0&&m===0)h=u,u=0,a?a.push(o,r):a=[o,r];else{let g,f,b,p,y;if(c===0){if((g=this._clipSegment(s,i,o,r,c,m))===null)continue;[f,b,p,y]=g}else{if((g=this._clipSegment(o,r,s,i,m,c))===null)continue;[p,y,f,b]=g,h=u,u=this._edgecode(f,b),h&&u&&this._edge(e,h,u,a,a.length),a?a.push(f,b):a=[f,b]}h=u,u=this._edgecode(p,y),h&&u&&this._edge(e,h,u,a,a.length),a?a.push(p,y):a=[p,y]}if(a)h=u,u=this._edgecode(a[0],a[1]),h&&u&&this._edge(e,h,u,a,a.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return a}_clipSegment(e,t,n,a,s,i){const o=s<i;for(o&&([e,t,n,a,s,i]=[n,a,e,t,i,s]);;){if(s===0&&i===0)return o?[n,a,e,t]:[e,t,n,a];if(s&i)return null;let r,c,m=s||i;m&8?(r=e+(n-e)*(this.ymax-t)/(a-t),c=this.ymax):m&4?(r=e+(n-e)*(this.ymin-t)/(a-t),c=this.ymin):m&2?(c=t+(a-t)*(this.xmax-e)/(n-e),r=this.xmax):(c=t+(a-t)*(this.xmin-e)/(n-e),r=this.xmin),s?(e=r,t=c,s=this._regioncode(e,t)):(n=r,a=c,i=this._regioncode(n,a))}}_clipInfinite(e,t,n,a,s,i){let o=Array.from(t),r;if((r=this._project(o[0],o[1],n,a))&&o.unshift(r[0],r[1]),(r=this._project(o[o.length-2],o[o.length-1],s,i))&&o.push(r[0],r[1]),o=this._clipFinite(e,o))for(let c=0,m=o.length,h,u=this._edgecode(o[m-2],o[m-1]);c<m;c+=2)h=u,u=this._edgecode(o[c],o[c+1]),h&&u&&(c=this._edge(e,h,u,o,c),m=o.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return o}_edge(e,t,n,a,s){for(;t!==n;){let i,o;switch(t){case 5:t=4;continue;case 4:t=6,i=this.xmax,o=this.ymin;break;case 6:t=2;continue;case 2:t=10,i=this.xmax,o=this.ymax;break;case 10:t=8;continue;case 8:t=9,i=this.xmin,o=this.ymax;break;case 9:t=1;continue;case 1:t=5,i=this.xmin,o=this.ymin;break}(a[s]!==i||a[s+1]!==o)&&this.contains(e,i,o)&&(a.splice(s,0,i,o),s+=2)}return s}_project(e,t,n,a){let s=1/0,i,o,r;if(a<0){if(t<=this.ymin)return null;(i=(this.ymin-t)/a)<s&&(r=this.ymin,o=e+(s=i)*n)}else if(a>0){if(t>=this.ymax)return null;(i=(this.ymax-t)/a)<s&&(r=this.ymax,o=e+(s=i)*n)}if(n>0){if(e>=this.xmax)return null;(i=(this.xmax-e)/n)<s&&(o=this.xmax,r=t+(s=i)*a)}else if(n<0){if(e<=this.xmin)return null;(i=(this.xmin-e)/n)<s&&(o=this.xmin,r=t+(s=i)*a)}return[o,r]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}_simplify(e){if(e&&e.length>4){for(let t=0;t<e.length;t+=2){const n=(t+2)%e.length,a=(t+4)%e.length;(e[t]===e[n]&&e[n]===e[a]||e[t+1]===e[n+1]&&e[n+1]===e[a+1])&&(e.splice(n,2),t-=2)}e.length||(e=null)}return e}}const Jt=2*Math.PI,ae=Math.pow;function Qt(l){return l[0]}function en(l){return l[1]}function tn(l){const{triangles:e,coords:t}=l;for(let n=0;n<e.length;n+=3){const a=2*e[n],s=2*e[n+1],i=2*e[n+2];if((t[i]-t[a])*(t[s+1]-t[a+1])-(t[s]-t[a])*(t[i+1]-t[a+1])>1e-10)return!1}return!0}function nn(l,e,t){return[l+Math.sin(l+e)*t,e+Math.cos(l-e)*t]}class we{static from(e,t=Qt,n=en,a){return new we("length"in e?an(e,t,n,a):Float64Array.from(sn(e,t,n,a)))}constructor(e){this._delaunator=new be(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&tn(e)){this.collinear=Int32Array.from({length:t.length/2},(u,d)=>d).sort((u,d)=>t[2*u]-t[2*d]||t[2*u+1]-t[2*d+1]);const r=this.collinear[0],c=this.collinear[this.collinear.length-1],m=[t[2*r],t[2*r+1],t[2*c],t[2*c+1]],h=1e-8*Math.hypot(m[3]-m[1],m[2]-m[0]);for(let u=0,d=t.length/2;u<d;++u){const g=nn(t[2*u],t[2*u+1],h);t[2*u]=g[0],t[2*u+1]=g[1]}this._delaunator=new be(t)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,a=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,i=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let r=0,c=n.length;r<c;++r){const m=s[r%3===2?r-2:r+1];(n[r]===-1||i[m]===-1)&&(i[m]=r)}for(let r=0,c=a.length;r<c;++r)o[a[r]]=r;a.length<=2&&a.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=a[0],i[a[0]]=1,a.length===2&&(i[a[1]]=0,this.triangles[1]=a[1],this.triangles[2]=a[1]))}voronoi(e){return new Kt(this,e)}*neighbors(e){const{inedges:t,hull:n,_hullIndex:a,halfedges:s,triangles:i,collinear:o}=this;if(o){const h=o.indexOf(e);h>0&&(yield o[h-1]),h<o.length-1&&(yield o[h+1]);return}const r=t[e];if(r===-1)return;let c=r,m=-1;do{if(yield m=i[c],c=c%3===2?c-2:c+1,i[c]!==e)return;if(c=s[c],c===-1){const h=n[(a[e]+1)%n.length];h!==m&&(yield h);return}}while(c!==r)}find(e,t,n=0){if(e=+e,e!==e||(t=+t,t!==t))return-1;const a=n;let s;for(;(s=this._step(n,e,t))>=0&&s!==n&&s!==a;)n=s;return s}_step(e,t,n){const{inedges:a,hull:s,_hullIndex:i,halfedges:o,triangles:r,points:c}=this;if(a[e]===-1||!c.length)return(e+1)%(c.length>>1);let m=e,h=ae(t-c[e*2],2)+ae(n-c[e*2+1],2);const u=a[e];let d=u;do{let g=r[d];const f=ae(t-c[g*2],2)+ae(n-c[g*2+1],2);if(f<h&&(h=f,m=g),d=d%3===2?d-2:d+1,r[d]!==e)break;if(d=o[d],d===-1){if(d=s[(i[e]+1)%s.length],d!==g&&ae(t-c[d*2],2)+ae(n-c[d*2+1],2)<h)return d;break}}while(d!==u);return m}render(e){const t=e==null?e=new te:void 0,{points:n,halfedges:a,triangles:s}=this;for(let i=0,o=a.length;i<o;++i){const r=a[i];if(r<i)continue;const c=s[i]*2,m=s[r]*2;e.moveTo(n[c],n[c+1]),e.lineTo(n[m],n[m+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t){t===void 0&&(!e||typeof e.moveTo!="function")&&(t=e,e=null),t=t==null?2:+t;const n=e==null?e=new te:void 0,{points:a}=this;for(let s=0,i=a.length;s<i;s+=2){const o=a[s],r=a[s+1];e.moveTo(o+t,r),e.arc(o,r,t,0,Jt)}return n&&n.value()}renderHull(e){const t=e==null?e=new te:void 0,{hull:n,points:a}=this,s=n[0]*2,i=n.length;e.moveTo(a[s],a[s+1]);for(let o=1;o<i;++o){const r=2*n[o];e.lineTo(a[r],a[r+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new Se;return this.renderHull(e),e.value()}renderTriangle(e,t){const n=t==null?t=new te:void 0,{points:a,triangles:s}=this,i=s[e*=3]*2,o=s[e+1]*2,r=s[e+2]*2;return t.moveTo(a[i],a[i+1]),t.lineTo(a[o],a[o+1]),t.lineTo(a[r],a[r+1]),t.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,n=e.length/3;t<n;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new Se;return this.renderTriangle(e,t),t.value()}}function an(l,e,t,n){const a=l.length,s=new Float64Array(a*2);for(let i=0;i<a;++i){const o=l[i];s[i*2]=e.call(n,o,i,l),s[i*2+1]=t.call(n,o,i,l)}return s}function*sn(l,e,t,n){let a=0;for(const s of l)yield e.call(n,s,a,l),yield t.call(n,s,a,l),++a}const nt=Math.sqrt(3),on=.5*(nt-1),re=(3-nt)/6,He=l=>Math.floor(l)|0,ze=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function Ge(l=Math.random){const e=ln(l),t=new Float64Array(e).map(a=>ze[a%12*2]),n=new Float64Array(e).map(a=>ze[a%12*2+1]);return function(s,i){let o=0,r=0,c=0;const m=(s+i)*on,h=He(s+m),u=He(i+m),d=(h+u)*re,g=h-d,f=u-d,b=s-g,p=i-f;let y,_;b>p?(y=1,_=0):(y=0,_=1);const C=b-y+re,R=p-_+re,A=b-1+2*re,L=p-1+2*re,I=h&255,w=u&255;let v=.5-b*b-p*p;if(v>=0){const N=I+e[w],T=t[N],D=n[N];v*=v,o=v*v*(T*b+D*p)}let E=.5-C*C-R*R;if(E>=0){const N=I+y+e[w+_],T=t[N],D=n[N];E*=E,r=E*E*(T*C+D*R)}let S=.5-A*A-L*L;if(S>=0){const N=I+1+e[w+1],T=t[N],D=n[N];S*=S,c=S*S*(T*A+D*L)}return 70*(o+r+c)}}function ln(l){const t=new Uint8Array(512);for(let n=0;n<512/2;n++)t[n]=n;for(let n=0;n<512/2-1;n++){const a=n+~~(l()*(256-n)),s=t[n];t[n]=t[a],t[a]=s}for(let n=256;n<512;n++)t[n]=t[n-256];return t}const rn=(l,e,t)=>{const n=j((t-l)/(e-l));return n*n*(3-2*n)};class Pe{lines=[];noise2D;settings={endpointJitterFraction:0,bellBase:0,bellGain:0,fbmW1:0,fbmW2:0,minCenterDrift:0,ripple:0,centerDrift:0,baseRadius:0,warpStrength:0,kWarp:0,softness:0,aaRadius:0};constructor(e,t){this.noise2D=t,this.initializeDials(e);const n=xe(Y.LINE_COUNT_PROBS,e),[a,s]=Y.LENGTH_RANGE_BY_COUNT[n],[i,o]=Y.BEND_RANGE_BY_COUNT[n];for(let r=0;r<n;r++){const c=e()*Math.PI*2,m=Z(a,s,e)*this.settings.centerDrift,h=m*W.NEUTRAL_CENTER_POINT,u=Math.cos(c),d=Math.sin(c),g=this.settings.endpointJitterFraction*m,f=(e()-W.NEUTRAL_CENTER_POINT)*g,b=(e()-W.NEUTRAL_CENTER_POINT)*g,p=(e()-W.NEUTRAL_CENTER_POINT)*g,y=(e()-W.NEUTRAL_CENTER_POINT)*g,_=-u*h+f,C=-d*h+b,R=+u*h+p,A=+d*h+y,L=-d,I=u,w=Z(i,o,e)*m,v=e()<W.NEUTRAL_CENTER_POINT?-1:1,E=L*w*v,S=I*w*v,N=(_+R)*W.NEUTRAL_CENTER_POINT,T=(C+A)*W.NEUTRAL_CENTER_POINT,D=N+E,x=T+S,V=G(Y.RADIUS_JITTER_RANGE[0],Y.RADIUS_JITTER_RANGE[1],e());this.lines.push({p0x:_,p0y:C,p1x:D,p1y:x,p2x:R,p2y:A,radiusScale:V,bend:w,length:m})}ye("ELEVATION SETTINGS",{key:"endpointJitterFraction",value:this.settings.endpointJitterFraction},{key:"bellBase",value:this.settings.bellBase},{key:"bellGain",value:this.settings.bellGain},{key:"fbmW1",value:this.settings.fbmW1},{key:"fbmW2",value:this.settings.fbmW2},{key:"minCenterDrift",value:this.settings.minCenterDrift},{key:"ripple",value:this.settings.ripple},{key:"lineCount",value:this.lines.length},{key:"baseRadius",value:this.settings.baseRadius},{key:"warpStrength",value:this.settings.warpStrength},{key:"kWarp",value:this.settings.kWarp},{key:"softness",value:this.settings.softness},{key:"aaRadius",value:this.settings.aaRadius},{key:"lines",value:this.lines.map(r=>["length: "+r.length.toFixed(3),"bend: "+r.bend.toFixed(3),"radiusScale: "+r.radiusScale.toFixed(3)].join(", "))})}initializeDials(e){this.settings={endpointJitterFraction:U(Y.ENDPOINT_JITTER_FRACTION_RANGE,e),bellBase:U(Y.BELL_BASE_RANGE,e),bellGain:U(Y.BELL_GAIN_RANGE,e),fbmW1:U(Y.FBM2_W1_RANGE,e),fbmW2:U(Y.FBM2_W2_RANGE,e),minCenterDrift:U(Y.CENTER_DRIFT_RANGE,e),ripple:U(Y.RIPPLE_INTENSITY_RANGE,e),centerDrift:U(Y.CENTER_DRIFT_RANGE,e),baseRadius:U(Y.BASE_RADIUS_RANGE,e),warpStrength:U(Y.WARP_STRENGTH_RANGE,e),kWarp:U(Y.WARP_FREQUENCY_RANGE,e),softness:U(Y.SOFTNESS_RANGE,e),aaRadius:U(Y.AA_RADIUS_RANGE,e)}}maskedElevation(e,t,n,a){const s=this.fbm2(e,t,n),i=this.sampleAA(e,t,n),o=this.coastField(i,a);return this.blendElevation(s,o,Math.abs(a))}sample(e,t,n){const a=e+this.settings.warpStrength*(this.fbm2(this.settings.kWarp*e,this.settings.kWarp*t,n)-W.NEUTRAL_CENTER_POINT),s=t+this.settings.warpStrength*(this.fbm2(this.settings.kWarp*t,this.settings.kWarp*e,n)-W.NEUTRAL_CENTER_POINT),i=this.exclusiveSignedDistance(a,s,n);return rn(-this.settings.softness,+this.settings.softness,i)}sampleAA(e,t,n){const a=this.settings.aaRadius;let s=0;for(const[i,o]of ee.AA_CARDINAL_OFFSETS)s+=this.sample(e+i*a,t+o*a,n);return s/ee.AA_CARDINAL_OFFSETS.length}coastField(e,t){return G(1+t,1-t,e)*ee.COAST_FIELD_SCALE}blendElevation(e,t,n){return e+ee.COAST_FIELD_SCALE*n*(t-e)}exclusiveSignedDistance(e,t,n){let a=1/0;for(let s=0;s<this.lines.length;s++){const i=this.lineSignedDistance(this.lines[s],e,t,n);i<a&&(a=i)}return a}lineSignedDistance(e,t,n,a){let s=0,i=1/0;for(let g=0;g<=ee.CURVE_COARSE_STEPS;g++){const f=g/ee.CURVE_COARSE_STEPS,b=this.qbez(e.p0x,e.p1x,e.p2x,f),p=this.qbez(e.p0y,e.p1y,e.p2y,f),y=Math.hypot(b-t,p-n);y<i&&(i=y,s=f)}for(const g of ee.REFINE_STEPS)s=this.refineT(e,t,n,s,g);const o=this.qbez(e.p0x,e.p1x,e.p2x,s),r=this.qbez(e.p0y,e.p1y,e.p2y,s),c=Math.hypot(o-t,r-n),m=this.settings.baseRadius*e.radiusScale,h=1-Math.abs(2*s-1),u=m*(this.settings.bellBase+this.settings.bellGain*h),d=this.settings.ripple*(this.fbm2(this.settings.kWarp*o,this.settings.kWarp*r,a)-W.NEUTRAL_CENTER_POINT);return c-(u+d)}qbez(e,t,n,a){const s=1-a;return s*s*e+2*s*a*t+a*a*n}refineT(e,t,n,a,s){const i=j(a-s),o=j(a),r=j(a+s),c=this.distAt(e,t,n,i),m=this.distAt(e,t,n,o),h=this.distAt(e,t,n,r),u=c-2*m+h;if(Math.abs(u)<W.PARABOLA_EPS)return a;const d=o+s*(c-h)/(2*u);return j(d)}distAt(e,t,n,a){const s=this.qbez(e.p0x,e.p1x,e.p2x,a),i=this.qbez(e.p0y,e.p1y,e.p2y,a);return Math.hypot(s-t,i-n)}fbm2=(e,t,n)=>{const a=this.noise2D(e/n,t/n),s=this.noise2D(2*e/n,2*t/n);return j(W.NEUTRAL_CENTER_POINT+this.settings.fbmW1*a+this.settings.fbmW2*s)}}const cn=2,hn=3,un=1e-12,Fe=6,fe=0,Ue=1;class Be{rng=()=>0;seed;constructor(e){this.seed=e}reSeed(e){this.seed=e}genPoints(e){this.rng=X(`${this.seed}-points`);const{resolution:t,jitter:n}=e,a=this.initPoints(t,n);let s=we.from(a,c=>c.x,c=>c.y);const i=[fe,fe,t,t];for(let c=0;c<cn;c++){const m=s.voronoi(i),h=s.points,u=h.length/2;for(let d=0;d<u;d++){const g=m.cellPolygon(d);if(g&&g.length>=hn){const[f,b]=this.polygonCentroidXY(g);h[2*d]=f,h[2*d+1]=b}else{const[f,b,p]=this.averageNeighborXY(s,d);p>0&&(h[2*d]=f,h[2*d+1]=b)}}s.update()}const o=[],r=s.points;for(let c=0;c<r.length;c+=2)o.push({x:r[c],y:r[c+1]});return{centers:o,delaunay:s}}genPointsForRegion(e,t,n,a,s,i){this.rng=X(`${this.seed}-points-${t}-${n}`);const{jitter:o}=e,r=[],c=Math.floor(t/i)*i,m=Math.floor(n/i)*i,h=t+a,u=n+s;for(let d=c;d<=h;d+=i)for(let g=m;g<=u;g+=i){const f=d+o*i*(this.rng()-this.rng()),b=g+o*i*(this.rng()-this.rng());r.push({x:f,y:b})}return r}initPoints(e,t){const n=[];for(let a=fe;a<e;a+=Ue)for(let s=fe;s<e;s+=Ue){const i=a+t*(this.rng()-this.rng()),o=s+t*(this.rng()-this.rng());n.push({x:i,y:o})}return n}polygonCentroidXY(e){let t=0,n=0,a=0;const s=e.length;for(let o=0,r=s-1;o<s;r=o++){const[c,m]=e[r],[h,u]=e[o],d=c*u-h*m;t+=d,n+=(c+h)*d,a+=(m+u)*d}if(Math.abs(t)<un)return e[0];const i=t/2;return[n/(Fe*i),a/(Fe*i)]}averageNeighborXY(e,t){const n=e.points;let a=0,s=0,i=0;for(const o of e.neighbors(t))a+=n[2*o],s+=n[2*o+1],i++;return i?[a/i,s/i,i]:[n[2*t],n[2*t+1],0]}}const mn=[10,200],dn=[.1,1.3],gn=[.1,1.3],fn=.5,We=4,je=.5,Xe={n1:.35,n2:.15},pn=.45,bn=1,yn=.2,wn=.9;class kn{noise2D;pointGenerator;rng;elevationCalc;seed;constructor(e){this.seed=e,this.rng=X(e),this.noise2D=Ge(X(e)),this.pointGenerator=new Be(e),this.elevationCalc=new Pe(this.rng,this.noise2D)}reSeed(e){this.seed=e,this.rng=X(e),this.noise2D=Ge(X(e)),this.pointGenerator=new Be(e),this.elevationCalc=new Pe(this.rng,this.noise2D)}generateMap(e){const t={...e,resolution:G(...mn,e.resolution),terrainFrequency:G(...dn,1-e.terrainFrequency),weatherFrequency:G(...gn,1-e.weatherFrequency)},{resolution:n}=t,{centers:a}=this.pointGenerator.genPoints(t),s=a,i=we.from(s,m=>m.x,m=>m.y),o={points:s,resolution:n,numRegions:s.length,numTriangles:i.triangles.length/3|0,numEdges:i.halfedges.filter(m=>m>=0).length/2|0,halfedges:i.halfedges,triangles:i.triangles,delaunay:i},r=this.genMoistures(o,t),c=this.genElevations(o,t);return{...o,elevations:c,moistures:r}}genMoistures(e,t){const{points:n,numRegions:a,resolution:s}=e,i=t.weatherFrequency,o=t.moistureContrast??fn,r=X(this.seed+"-moisture"),c=U(Y.RIPPLE_INTENSITY_RANGE,r),m=U(Y.WARP_FREQUENCY_RANGE,r),h=U(Y.WARP_STRENGTH_RANGE,r),u=(g,f)=>{const b=this.noise2D(g/i,f/i),p=this.noise2D(2*g/i,2*f/i);return Math.min(1,Math.max(0,.5+Xe.n1*b+Xe.n2*p))},d=new Float32Array(a);for(let g=0;g<a;g++){const f=n[g].x/s-.5,b=n[g].y/s-.5,p=f+h/We*(u(m*f,m*b)-.5),y=b+h/We*(u(m*b,m*f)-.5),_=u(c/je*p,c/je*y);d[g]=this.applyContrast(_,o)}return ye("MOISTURE SETTINGS",{key:"rippleIntensity",value:c},{key:"warpFrequency",value:m},{key:"weatherFrequency",value:i},{key:"warpStrength",value:h},{key:"moistureContrast",value:o}),d}genElevations(e,t){const{points:n,numRegions:a,resolution:s}=e,{seaLevel:i,terrainFrequency:o,clumpiness:r}=t,c=j(G(0,1,i,yn,wn)),m=c*c*(3-2*c),h=G(pn,bn,m),u=new Float32Array(a);for(let d=0;d<a;d++){const g=G(-.5,.5,n[d].x/s),f=G(-.5,.5,n[d].y/s),b=this.elevationCalc.maskedElevation(g,f,o,r);u[d]=b===10?b:this.applyContrast(b,h)}return u}applyContrast(e,t){const n=j(t,0,1),a=2*e-1,s=n<=.5?G(3,1,n/.5):G(1,.2,(n-.5)/.5),i=Math.sign(a)*Math.pow(Math.abs(a),s);return j((i+1)*.5,0,1)}}class _n{rng;constructor(e){this.rng=X(e)}generate(e={}){const t=e.lang??this.pickLanguage(),a=this.calcName(t).trim().replace(/\s+/g," "),s=this.titleCase(a);return console.log(`
========================================

`),ye("NAME GENERATOR",{key:"name",value:s},{key:"lang",value:t}),this.rng=X(`${Date.now()}`),s}calcName(e){const t=[{val:0,prob:.1},{val:1,prob:.7},{val:2,prob:.2}],n=Q(oe[e].suffixes,this.rng).toLowerCase(),a=8;let s="",i="",o="",r="";for(let c=0;c<a;c++){const m=xe(t,this.rng);if(s=this.tidyStemVsSuffix(this.buildStem(m,e),n),i=s+n,this.isPronounceable(i,e))return i;if(o=this.softenClusters(i,e),this.isPronounceable(o,e))return o;const h=this.softenVowels(i,e);if(this.isPronounceable(h,e))return h}return r||o||i}softenClusters(e,t){const n=oe[t],a=n.clusterLinker,s=new Set((n.onsets||[]).map(r=>r.toLowerCase())),i=new Set((n.codas||[]).map(r=>r.toLowerCase())),o=e.split(/([\s’'ʻ`\-_.]+)/);for(let r=0;r<o.length;r++){const c=o[r];if(/^[\s’'ʻ`\-_.]+$/.test(c))continue;const u=c.replace(/ch|sh|zh|ts|tz|wh|ng|kh|gh|ph|th|dh|qu/gi,p=>p[0].toUpperCase()).replace(/[^a-zA-Z]/g,"").replace(/[A-Z]/g,p=>p.toLowerCase()+"_"),d=u.match(/[^aeiouy_]+/g)||[];let g=-1,f=0,b=0;for(const p of d){const y=p.replace(/_/g,""),_=u.indexOf(p,b),C=_+p.length;if(b=C,y.length<=1)continue;const R=_===0,A=C===u.length;if(R&&s.has(y)||A&&i.has(y))continue;let L=!1;for(let I=1;I<y.length;I++)if(i.has(y.slice(0,I))&&s.has(y.slice(I))){L=!0;break}!L&&y.length>f&&(f=y.length,g=_)}if(g>=0){const p=g+1;o[r]=c.slice(0,p)+a+c.slice(p);break}}return o.join("")}softenVowels(e,t){const n=oe[t],a=n.vowelLinker,s=e.split("");let i=0;for(let o=0;o<s.length;o++)if(this.isVowel(s[o])){if(i++,i>=n.maxVowelRun){s.splice(o,0,a);break}}else i=0;return s.join("")}estimateSyllables(e,t=!0){const n=t?"aeiouy":"aeiou";return(e.toLowerCase().normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[’'ʻ`]/g," ").match(new RegExp(`[${n}]+`,"g"))||[]).length}isPronounceable(e,t){const n=oe[t],a=/ch|sh|zh|ts|tz|wh|ng|kh|gh|ph|th|dh|qu/gi,s=e.toLowerCase().replace(/[’'ʻ`\-_.]/g," ").replace(a,p=>p[0].toUpperCase()),i=s.replace(/[^a-zA-Z]/g,"");if(!i||!/[aeiouy]/i.test(i))return!1;const r=i.replace(/[A-Z]/g,p=>p.toLowerCase()),c=(r.match(/[^aeiouy]+/g)||[]).map(p=>p.length),m=(r.match(/[aeiouy]+/g)||[]).map(p=>p.length),h=Math.max(0,...c),u=Math.max(0,...m),d=(r.match(/[aeiouy]/g)||[]).length/r.length;if(h>n.maxConsRun||u>n.maxVowelRun||d<n.minVowelRatio)return!1;const g=new Set((n.onsets||[]).map(p=>p.toLowerCase())),f=new Set((n.codas||[]).map(p=>p.toLowerCase()));for(const p of s.split(/\s+/).filter(Boolean)){const y=p.replace(/[A-Z]/g,R=>R.toLowerCase()+"_"),_=y.match(/[^aeiouy_]+/g)||[];let C=0;for(const R of _){const A=R.replace(/_/g,"");if(A.length<=1){C+=R.length;continue}const L=y.indexOf(R,C),I=L+R.length;C=I;const w=L===0,v=I===y.length;if(w&&g.has(A)||v&&f.has(A))continue;let E=!1;for(let S=1;S<A.length;S++)if(f.has(A.slice(0,S))&&g.has(A.slice(S))){E=!0;break}if(!E)return!1}}const b=this.estimateSyllables(e,n.treatYAsVowel);return!(n.minSyllables&&b<n.minSyllables||n.maxSyllables&&b>n.maxSyllables)}pickLanguage(){return Q(Je,this.rng)}buildStem(e,t){const n=oe[t],a=[],s=(c,m=0,h=.95)=>Math.min(h,Math.max(m,c)),i=(c,m)=>{const h=n.codaChance,u=s(h*(c?1.2:.6));if(this.rng()>=u)return"";const d=Q(n.codas,this.rng)||"";return!d||!c&&m&&this.endsWithConsonant(d)&&this.startsWithConsonant(m)&&this.rng()<.6?"":d},o=()=>{const c=n.medials,m=n.medialMorphChance;return!c||!c.length||!m?"":this.rng()<m&&Q(c,this.rng)||""};let r=Q(n.onsets,this.rng)||"";for(let c=0;c<e;c++){const m=c===e-1,h=r,u=Q(n.vowels,this.rng)||"";r=m?"":Q(n.onsets,this.rng)||"";const d=i(m,r);if(a.push(h,u,d),!m){const g=o();if(g){const f=a.join(""),b=this.smartJoin(f,g);a.length=0,a.push(b)}}}return a.join("")}smartJoin(e,t){if(!t)return e;if(!e)return t;const n=e.slice(-1),a=t.charAt(0);return this.isVowel(n)&&this.isVowel(a)?e.slice(0,-1)+t:!this.isVowel(n)&&!this.isVowel(a)&&this.rng()<.35?e+"a"+t:e+t}isVowel(e){return/^[aeiou]$/i.test(e)}startsWithConsonant(e){const t=e.charAt(0);return/^[a-z]/i.test(t)?!this.isVowel(t):!0}endsWithConsonant(e){const t=e.slice(-1);return/^[a-z]/i.test(t)?!this.isVowel(t):!0}tidyStemVsSuffix(e,t){return/[aeiou]$/i.test(e)&&/^[aeiou]/i.test(t)?e.slice(0,-1):e}titleCase(e){return e=e.trim(),e.charAt(0).toUpperCase()+e.slice(1)}}function at(l){return An.find(({breakPoint:t})=>l<t)}const En=l=>l<0?"OCEAN":at(l).colorFamily,Rn=[{band:"DRY",breakPoint:.2},{band:"MID",breakPoint:.6},{band:"WET",breakPoint:1}],vn=l=>(l=j(l),Rn.find(({breakPoint:t})=>l<=t)?.band),Ae={default:{OCEAN:"#34699A",DRY_VERY_HIGH:"#bfb9a4",MID_VERY_HIGH:"#c4c2bc",WET_VERY_HIGH:"#E7E8E9",DRY_HIGH:"#8a816d",MID_HIGH:"#85A947",WET_HIGH:"#63a947",DRY_MEDIUM:"#8D8D4E",MID_MEDIUM:"#6c8a4e",WET_MEDIUM:"#528a4e",DRY_LOW:"#d4c9a1",MID_LOW:"#506132",WET_LOW:"#436132"},arid:{OCEAN:"#34699A",DRY_VERY_HIGH:"#bdb49d",MID_VERY_HIGH:"#bfbeb5",WET_VERY_HIGH:"#c9cccc",DRY_HIGH:"#bbae8c",MID_HIGH:"#9ca881",WET_HIGH:"#839d7d",DRY_MEDIUM:"#b59f70",MID_MEDIUM:"#99995f",WET_MEDIUM:"#7b8e61",DRY_LOW:"#d0c293",MID_LOW:"#96854d",WET_LOW:"#637d45"},lush:{OCEAN:"#34699A",DRY_VERY_HIGH:"#bfb9a4",MID_VERY_HIGH:"#c4c2bc",WET_VERY_HIGH:"#E7E8E9",DRY_HIGH:"#7eaa5b",MID_HIGH:"#649a4b",WET_HIGH:"#4d8f45",DRY_MEDIUM:"#557d3f",MID_MEDIUM:"#457339",WET_MEDIUM:"#356a33",DRY_LOW:"#9e8e61",MID_LOW:"#3e6432",WET_LOW:"#27582c"},rainbow:{OCEAN:"#44447a",DRY_VERY_HIGH:"#f9844a",MID_VERY_HIGH:"#f3722c",WET_VERY_HIGH:"#f94144",DRY_HIGH:"#f9c74f",MID_HIGH:"#f9c74f",WET_HIGH:"#f8961e",DRY_MEDIUM:"#4d908e",MID_MEDIUM:"#43aa8b",WET_MEDIUM:"#90be6d",DRY_LOW:"#577590",MID_LOW:"#577590",WET_LOW:"#277da1"},oasis:{OCEAN:"#E3D2A6",DRY_VERY_HIGH:"#E3D2A6",MID_VERY_HIGH:"#E3D2A6",WET_VERY_HIGH:"#04009A",DRY_HIGH:"#E3D2A6",MID_HIGH:"#E3D2A6",WET_HIGH:"#4E8F5B",DRY_MEDIUM:"#E3D2A6",MID_MEDIUM:"#E3D2A6",WET_MEDIUM:"#E3D2A6",DRY_LOW:"#E3D2A6",MID_LOW:"#E3D2A6",WET_LOW:"#E3D2A6"},grayscale:{OCEAN:"#2e2d2d",DRY_VERY_HIGH:"#cccccc",MID_VERY_HIGH:"#cccccc",WET_VERY_HIGH:"#cccccc",DRY_HIGH:"#a6a6a6",MID_HIGH:"#a6a6a6",WET_HIGH:"#a6a6a6",DRY_MEDIUM:"#737373",MID_MEDIUM:"#737373",WET_MEDIUM:"#737373",DRY_LOW:"#454444",MID_LOW:"#454444",WET_LOW:"#454444"},volcano:{OCEAN:"#1E2430",DRY_VERY_HIGH:"#FF3D00",MID_VERY_HIGH:"#FF3D00",WET_VERY_HIGH:"#FF3D00",DRY_HIGH:"#3B2E2B",MID_HIGH:"#5C4038",WET_HIGH:"#78493C",DRY_MEDIUM:"#2A2422",MID_MEDIUM:"#2A2422",WET_MEDIUM:"#2A2422",DRY_LOW:"#1A1A1A",MID_LOW:"#1A1A1A",WET_LOW:"#1A1A1A"}},An=[{breakPoint:-.7,colorFamily:"OCEAN",band:"OCEAN_3"},{breakPoint:-.35,colorFamily:"OCEAN",band:"OCEAN_2"},{breakPoint:0,colorFamily:"OCEAN",band:"OCEAN_1"},{breakPoint:.2,colorFamily:"LOW",band:"LOW_1"},{breakPoint:.22,colorFamily:"LOW",band:"LOW_2"},{breakPoint:.35,colorFamily:"MEDIUM",band:"MEDIUM_1"},{breakPoint:.52,colorFamily:"MEDIUM",band:"MEDIUM_2"},{breakPoint:.62,colorFamily:"HIGH",band:"HIGH_1"},{breakPoint:.75,colorFamily:"HIGH",band:"HIGH_2"},{breakPoint:.87,colorFamily:"VERY_HIGH",band:"VERY_HIGH_1"},{breakPoint:1,colorFamily:"VERY_HIGH",band:"VERY_HIGH_2"}],Cn={OCEAN_3:-.06,OCEAN_2:-.03,OCEAN_1:.01,LOW_1:-.02,LOW_2:0,MEDIUM_1:-.05,MEDIUM_2:0,HIGH_1:-.05,HIGH_2:0,VERY_HIGH_1:-.05,VERY_HIGH_2:0},Sn={default:{saturationScale:1},arid:{saturationScale:.95},lush:{saturationScale:1.07},rainbow:{saturationScale:1.12},oasis:{lightness:{OCEAN_3:0,OCEAN_2:0,OCEAN_1:0,LOW_1:0,LOW_2:0,MEDIUM_1:0,MEDIUM_2:0,HIGH_1:0,HIGH_2:0,VERY_HIGH_1:0,VERY_HIGH_2:0},saturationScale:.85},grayscale:{saturationScale:0,lightness:{OCEAN_3:0,OCEAN_2:0,OCEAN_1:0}},volcano:{saturationScale:1.12,lightness:{OCEAN_3:0,OCEAN_2:0,OCEAN_1:0}}};function xn(l,e,t){const n=En(e);if(n==="OCEAN")return Ae[l].OCEAN;const s=`${vn(t)}_${n}`;return Ae[l][s]??Ae.default[s]}const qe=1e-9,In=4.1,Mn=.01,Ln=25,Nn=.5,Tn=2,Vn=-.9,Dn=.9,$e=.1;function On(l,e){const t=Math.max(0,Math.min(1,l));return(Math.exp(e*t)-1)/(Math.exp(e)-1)}function Yn(l,e,t,n){let a=G(Vn-(n-$e),Dn-(n-$e),l),s=Math.pow(e,t);return a=Math.max(Math.min(a,1-qe),-1),s=Math.max(Math.min(s,1-qe),0),{elevation:a,moisture:s}}function Hn(l,e,t,n,a){if(n<0||n>1||a<0||a>1)throw Error("rainfall & seaLevel must be 0-1");const s=On(1-n,In);n=Math.max(Mn,s*Ln),a=Tn*(a-Nn);const{elevation:i,moisture:o}=Yn(e,t,n,a),r=xn(l,i,o),c=at(i),{h:m,s:h,l:u}=Nt(r),d=zn(l),g=j(h*(d.saturationScale??1)),f=d.lightness[c.band]??0,b=j(u+f);return Tt(m,g,b)}function zn(l){const e=Sn[l]??{},t={...Cn,...e.lightness??{}},n=e.saturationScale??1;return{lightness:t,saturationScale:n}}const Gn=.001,Pn=Math.PI*2,Ze=.1,Fn=.05,Un=1,Bn=3;class Wn{geomCache=new WeakMap;cellColorCache=new WeakMap;colorQuantCache=new Map;buckets=new Map;writeBbox(e,t,n,a,s,i){const o=t*4;e[o]=n,e[o+1]=a,e[o+2]=s,e[o+3]=i}createDegenerateCell(e,t,n){const a=new Path2D;return a.arc(e.x,e.y,Gn,0,Pn),this.writeBbox(n,t,e.x,e.y,e.x,e.y),a}buildCellGeometry(e,t,n,a){const{circumcenters:s}=t,{halfedges:i,triangles:o,inedges:r}=t.delaunay,c=r[e];if(c===-1)return this.createDegenerateCell(n,e,a);const m=new Path2D;let h=c,u=1/0,d=1/0,g=-1/0,f=-1/0,b=!0;do{const p=Math.floor(h/3),y=s[2*p],_=s[2*p+1];if(b?(m.moveTo(y,_),b=!1):m.lineTo(y,_),y<u&&(u=y),y>g&&(g=y),_<d&&(d=_),_>f&&(f=_),h=h%3===2?h-2:h+1,o[h]!==e)break;if(h=i[h],h===-1)return this.buildCellGeometryFallback(e,t,n,a)}while(h!==c&&h!==-1);return m.closePath(),this.writeBbox(a,e,u,d,g,f),m}buildCellGeometryFallback(e,t,n,a){const s=t.cellPolygon(e);if(!s||s.length<Bn)return this.createDegenerateCell(n,e,a);const i=new Path2D;i.moveTo(s[0][0],s[0][1]);let[o,r]=[s[0][0],s[0][0]],[c,m]=[s[0][1],s[0][1]];for(let h=1;h<s.length;h++){const[u,d]=s[h];i.lineTo(u,d),u<o&&(o=u),u>r&&(r=u),d<c&&(c=d),d>m&&(m=d)}return i.closePath(),this.writeBbox(a,e,o,c,r,m),i}getCellColors(e,t){const n=e.meshVersion,a=`${t.theme}:${t.rainfall}:${t.seaLevel}`,s=this.cellColorCache.get(e);if(s&&s.version===n&&s.themeHash===a)return s.colors;const o=new Array(e.points.length);for(let r=0;r<e.points.length;r++){const c=Hn(t.theme,e.elevations[r],e.moistures[r],t.rainfall,t.seaLevel);o[r]=this.quantizeColorCached(c)}return this.cellColorCache.set(e,{version:n,themeHash:a,colors:o}),o}quantizeColorCached(e){const t=this.colorQuantCache.get(e);if(t)return t;const n=Ot(e);return this.colorQuantCache.set(e,n),n}getVoronoiCache(e){const t=e.resolution*Ze,n=[-t,-t,e.resolution+t,e.resolution+t],a=this.geomCache.get(e.delaunay),s=e.meshVersion;if(a&&a.version===s&&a.bounds.length===n.length&&a.bounds.every((u,d)=>u===n[d]))return a;const o=e.delaunay.voronoi(n),r=e.points.length,c=new Array(r),m=new Float32Array(r*4);for(let u=0;u<r;u++)c[u]=this.buildCellGeometry(u,o,e.points[u],m);const h={delaunay:e.delaunay,version:s,bounds:n,cells:c,bboxData:m};return this.geomCache.set(e.delaunay,h),h}bboxIntersects(e,t,n,a,s,i){const o=t*4,r=e[o],c=e[o+1],m=e[o+2],h=e[o+3];return!(m<n||r>s||h<a||c>i)}collectVisibleCells(e,t,n){const{x0:a,y0:s,x1:i,y1:o}=n,r=(a+i)/2,c=(s+o)/2;let m=e.delaunay.find(r,c);(m==null||m<0||m>=e.points.length)&&(m=e.delaunay.find(a,s)??e.delaunay.find(i,s)??e.delaunay.find(a,o)??e.delaunay.find(i,o)??0);const h=t.bboxData,u=[],d=new Uint8Array(e.points.length),g=[m];for(d[m]=1;g.length;){const f=g.pop();if(this.bboxIntersects(h,f,a,s,i,o)){u.push(f);for(const b of e.delaunay.neighbors(f)){if(d[b])continue;d[b]=1;const p=e.points[b],y=e.resolution*Ze,_=p.x>=a-y&&p.x<=i+y,C=p.y>=s-y&&p.y<=o+y;_&&C&&g.push(b)}}}return u}drawCellColors(e,t,n,a=0,s=0,i=1){const o=e.getContext("2d");if(!o)return;const{resolution:r}=t;o.clearRect(0,0,e.width,e.height),o.save();const c=e.width/r*i;o.scale(c,c),o.translate(a/c,s/c);const m=r*Fn,h=Math.max(-r,-a/c-m),u=Math.max(-r,-s/c-m),d=Math.min(2*r,(e.width-a)/c+m),g=Math.min(2*r,(e.height-s)/c+m),f=this.getVoronoiCache(t),b=this.collectVisibleCells(t,f,{x0:h,y0:u,x1:d,y1:g}),p=this.getCellColors(t,n);this.buckets.clear();for(let _=0;_<b.length;_++){const C=b[_],R=p[C];let A=this.buckets.get(R);A||(A=new Path2D,this.buckets.set(R,A)),A.addPath(f.cells[C])}const y=Un/c;for(const[_,C]of this.buckets)o.fillStyle=_,o.fill(C),o.strokeStyle=_,o.lineWidth=y,o.stroke(C);o.restore()}}class jn{canvas;onRedraw;getCachedMap;onZoomChange;momentum;panX=0;panY=0;viewScale=1;zoom=.2;isDragging=!1;dragStartX=0;dragStartY=0;panStartX=0;panStartY=0;velocityX=0;velocityY=0;lastMoveTime=0;lastMoveX=0;lastMoveY=0;momentumAnimationId=null;isTouchPanning=!1;touchStartX=0;touchStartY=0;touchPanStartX=0;touchPanStartY=0;initialPinchDistance=null;initialPinchZoom=null;pinchCenterX=0;pinchCenterY=0;constructor(e){this.canvas=e.canvas,this.onRedraw=e.onRedraw,this.getCachedMap=e.getCachedMap,this.onZoomChange=e.onZoomChange,this.momentum=e.momentum??.3,this.attachEventListeners()}setZoom(e){this.zoom=Math.max(0,Math.min(1,e)),this.viewScale=G(1,5,this.zoom,0,1),this.onZoomChange?.(this.zoom,this.viewScale)}getZoom(){return this.zoom}resetPan(){this.panX=0,this.panY=0,this.stopMomentum()}clampPanToBounds(){const e=this.getCachedMap();if(!e)return!1;const t=this.canvas.width/e.resolution*this.viewScale,n=e.resolution*t,a=e.resolution*t,s=this.panX,i=this.panY;return this.panX=Math.max(Math.min(this.panX,0),this.canvas.width-n),this.panY=Math.max(Math.min(this.panY,0),this.canvas.height-a),s!==this.panX||i!==this.panY}applyMomentum=()=>{const e=G(.8,.97,this.momentum),t=G(.5,.05,this.momentum);if(Math.hypot(this.velocityX,this.velocityY)<t){this.momentumAnimationId=null;return}if(this.panX+=this.velocityX,this.panY+=this.velocityY,this.clampPanToBounds()){this.stopMomentum(),this.onRedraw();return}this.velocityX*=e,this.velocityY*=e,this.onRedraw(),this.momentumAnimationId=requestAnimationFrame(this.applyMomentum)};startMomentum(){this.momentumAnimationId!==null&&cancelAnimationFrame(this.momentumAnimationId),this.momentumAnimationId=requestAnimationFrame(this.applyMomentum)}stopMomentum(){this.momentumAnimationId!==null&&(cancelAnimationFrame(this.momentumAnimationId),this.momentumAnimationId=null),this.velocityX=0,this.velocityY=0}getTouchDistance(e,t){const n=t.clientX-e.clientX,a=t.clientY-e.clientY;return Math.hypot(n,a)}getCanvasScale(){const e=this.canvas.getBoundingClientRect();return{scaleX:this.canvas.width/e.width,scaleY:this.canvas.height/e.height,rect:e}}handlePan(e,t,n,a,s,i){this.panX=s+e*n,this.panY=i+t*a,this.clampPanToBounds(),this.onRedraw()}handleMomentum(e,t,n,a){const s=Date.now(),i=s-this.lastMoveTime;if(i>0){const o=(e-this.lastMoveX)*n,r=(t-this.lastMoveY)*a;this.velocityX=o/i*16,this.velocityY=r/i*16}this.lastMoveTime=s,this.lastMoveX=e,this.lastMoveY=t}handleMomentumStart(){const e=G(5,.5,this.momentum);Math.hypot(this.velocityX,this.velocityY)>e&&this.startMomentum()}attachEventListeners(){this.canvas.addEventListener("mousedown",t=>{this.stopMomentum(),this.isDragging=!0,this.dragStartX=t.clientX,this.dragStartY=t.clientY,this.panStartX=this.panX,this.panStartY=this.panY,this.lastMoveTime=Date.now(),this.lastMoveX=t.clientX,this.lastMoveY=t.clientY,this.canvas.style.cursor="grabbing"}),this.canvas.addEventListener("mousemove",t=>{if(!this.isDragging)return;const{scaleX:n,scaleY:a}=this.getCanvasScale();this.handlePan(t.clientX-this.dragStartX,t.clientY-this.dragStartY,n,a,this.panStartX,this.panStartY),this.handleMomentum(t.clientX,t.clientY,n,a)});const e=()=>{this.isDragging&&(this.isDragging=!1,this.canvas.style.cursor="grab",this.handleMomentumStart())};this.canvas.addEventListener("mouseup",e),this.canvas.addEventListener("mouseleave",e),this.canvas.addEventListener("wheel",t=>{t.preventDefault(),this.stopMomentum();const n=this.getCachedMap();if(!n)return;const{scaleX:a,scaleY:s,rect:i}=this.getCanvasScale(),o=(t.clientX-i.left)*a,r=(t.clientY-i.top)*s,c=this.canvas.width/n.resolution*this.viewScale,m=(o-this.panX)/c,h=(r-this.panY)/c,u=-t.deltaY*.001;this.setZoom(this.zoom+u);const d=this.canvas.width/n.resolution*this.viewScale;this.panX=o-m*d,this.panY=r-h*d,this.clampPanToBounds(),this.onRedraw()}),this.canvas.addEventListener("touchstart",t=>{if(t.touches.length===1){this.stopMomentum(),this.isTouchPanning=!0;const n=t.touches[0];this.touchStartX=n.clientX,this.touchStartY=n.clientY,this.touchPanStartX=this.panX,this.touchPanStartY=this.panY,this.lastMoveTime=Date.now(),this.lastMoveX=n.clientX,this.lastMoveY=n.clientY}else if(t.touches.length===2){t.preventDefault(),this.stopMomentum(),this.isTouchPanning=!1;const[n,a]=[t.touches[0],t.touches[1]];this.initialPinchDistance=this.getTouchDistance(n,a),this.initialPinchZoom=this.zoom;const{scaleX:s,scaleY:i,rect:o}=this.getCanvasScale();this.pinchCenterX=((n.clientX+a.clientX)/2-o.left)*s,this.pinchCenterY=((n.clientY+a.clientY)/2-o.top)*i}}),this.canvas.addEventListener("touchmove",t=>{if(t.touches.length===1&&this.isTouchPanning){t.preventDefault();const n=t.touches[0],{scaleX:a,scaleY:s}=this.getCanvasScale();this.handlePan(n.clientX-this.touchStartX,n.clientY-this.touchStartY,a,s,this.touchPanStartX,this.touchPanStartY),this.handleMomentum(n.clientX,n.clientY,a,s)}else if(t.touches.length===2&&this.initialPinchDistance!==null&&this.initialPinchZoom!==null){t.preventDefault();const n=this.getCachedMap();if(!n)return;const[a,s]=[t.touches[0],t.touches[1]],i=this.getTouchDistance(a,s),o=this.canvas.width/n.resolution*this.viewScale,r=(this.pinchCenterX-this.panX)/o,c=(this.pinchCenterY-this.panY)/o,h=(i/this.initialPinchDistance-1)*.5;this.setZoom(this.initialPinchZoom+h);const u=this.canvas.width/n.resolution*this.viewScale;this.panX=this.pinchCenterX-r*u,this.panY=this.pinchCenterY-c*u,this.clampPanToBounds(),this.onRedraw()}}),this.canvas.addEventListener("touchend",t=>{t.touches.length===0?(this.isTouchPanning&&(this.isTouchPanning=!1,this.handleMomentumStart()),this.initialPinchDistance=null,this.initialPinchZoom=null):t.touches.length<2&&(this.initialPinchDistance=null,this.initialPinchZoom=null)})}}const Ce=l=>{const e=document.getElementById(l);if(!e)throw alert(`UI init failed. Missing #${l}`),new Error(`UI init failed. Missing #${l}`);return e},he=[{key:"resolution",idBase:"resolution",min:0,max:1,step:.01},{key:"seaLevel",idBase:"seaLevel",min:0,max:1,step:.01}];class Xn{elements;boundSliders={};constructor(){this.elements=this.initializeElements(),this.initializeSliders()}initializeElements(){const e=["map","regenBtn","regenBtnImg","resetSlidersBtn","zoomInput","zoomValue","mapTitle","loadTitleBtn","loadTitleBtnImg","downloadBtn","uploadBtn","downloadPNGBtn","downloadSaveBtn","cancelPopupBtn"],t={};return e.forEach(n=>{t[n]=Ce(n)}),t.themeRadios=document.querySelectorAll(".theme-radio"),t.languageCheckboxes=document.querySelectorAll(".language-checkbox"),t.categoryCheckboxes=document.querySelectorAll(".category-checkbox"),t}initializeSliders(){he.forEach(e=>{const t=Ce(e.idBase),n=Ce(`${e.idBase}Value`);t.min=String(e.min),t.max=String(e.max),t.step=String(e.step),this.boundSliders[e.key]={input:t,label:n,decimals:2}})}getAllElements(){return this.elements}getSlider(e){return this.boundSliders[e]}updateSliderValue(e,t){const n=this.boundSliders[e];n.input.value=String(t),n.label.textContent=t.toFixed(n.decimals)}get themeRadios(){return this.elements.themeRadios}get languageCheckboxes(){return this.elements.languageCheckboxes}get categoryCheckboxes(){return this.elements.categoryCheckboxes}}const ce=(l,e)=>{l.classList.remove(e),l.offsetWidth,l.classList.add(e)},qn=l=>{l.classList.add("clicked"),requestAnimationFrame(()=>{l.classList.add("enable-transition"),setTimeout(()=>{l.classList.remove("clicked");const e=t=>{t.propertyName==="background-color"&&(l.classList.remove("enable-transition"),l.removeEventListener("transitionend",e))};l.addEventListener("transitionend",e)},222)})},$n=(l,e,t)=>{const n=l instanceof Blob?l:new Blob([l],{type:t}),a=URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download=e,document.body.appendChild(s),s.click(),setTimeout(()=>{document.body.removeChild(s),URL.revokeObjectURL(a)},100)},se=new Map,Ke=l=>he.map(e=>l[e.key]).join("|");document.addEventListener("DOMContentLoaded",()=>{document.head.appendChild(Object.assign(document.createElement("style"),{textContent:Yt()})),document.querySelectorAll("img.button-img, img.button-img-small").forEach(k=>{const M=k.getAttribute("src");M&&(k.style.maskImage=k.style.webkitMaskImage=`url(${M})`,k.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7")});const l=new yt,e=new Xn,t=new _n(ct()),n=()=>t.generate({lang:l.selectedLanguages.length?l.selectedLanguages[Math.floor(Math.random()*l.selectedLanguages.length)]:void 0});l.mapName||(l.mapName=n());const a=new kn(l.mapName),s=new Wn;let i=X(l.mapName);const{map:o,mapTitle:r,zoomInput:c,zoomValue:m,regenBtn:h,regenBtnImg:u,resetSlidersBtn:d,loadTitleBtn:g,loadTitleBtnImg:f,downloadBtn:b,uploadBtn:p,downloadPNGBtn:y,downloadSaveBtn:_,cancelPopupBtn:C}=e.getAllElements(),R=new jn({canvas:o,onRedraw:A,getCachedMap:()=>se.get(Ke(l.settings))??null,momentum:.3,onZoomChange:(k,M)=>{c.value=String(k),m.textContent=M.toFixed(2)}});function A(){const k=Ke(l.settings);let M=se.get(k);M||(M=a.generateMap(l.settings),se.set(k,M)),s.drawCellColors(o,M,l.settings,R.panX,R.panY,R.viewScale)}const L=Ht(A,G(0,5,l.settings.resolution,0,1)),I=()=>{g.style.transform=`translate(${r.offsetWidth/2+16}px, -50%)`},w=k=>{r.value=k,setTimeout(I,0)};function v(k){k&&(l.mapName=k),i=X(l.mapName),Object.assign(l.settings,{clumpiness:xe([{val:Z(.75,.95,i),prob:.75},{val:Z(-.95,-.75,i),prob:.25}],i),terrainFrequency:Z(.6,.8,i),weatherFrequency:Z(.4,.85,i),rainfall:Z(.45,.8,i)}),ye("MAP SETTINGS",...Object.entries(l.settings).map(([M,O])=>({key:M,value:O}))),w(l.mapName),A()}function E(k){if(!k.trim()){alert("Please enter the name of a map to load in"),l.mapName="",r.value="";return}l.mapName=k,a.reSeed(k),se.clear(),R.resetPan(),v(k)}he.forEach(k=>{const M=e.getSlider(k.key);e.updateSliderValue(k.key,Number(l.settings[k.key])),M.input.addEventListener("input",()=>{let O=Number(M.input.value);Number.isFinite(O)||(O=Number(pe[k.key])),O=Math.max(k.min,Math.min(k.max,O)),l.updateSetting(k.key,O),e.updateSliderValue(k.key,O),L()})}),c.value=String(l.settings.zoom),R.setZoom(l.settings.zoom),m.textContent=R.viewScale.toFixed(2),c.addEventListener("input",()=>{l.updateSetting("zoom",Number(c.value)),R.setZoom(l.settings.zoom),A()}),e.themeRadios.forEach(k=>{k.checked=k.value===l.settings.theme,k.addEventListener("change",()=>{k.checked&&(l.updateSetting("theme",k.value),Ee(k.value),L())})}),Ee(l.settings.theme),h.addEventListener("click",()=>{ce(u,"spin"),l.mapName=n(),a.reSeed(l.mapName),se.clear(),R.resetPan(),v(l.mapName)}),d.addEventListener("click",()=>{qn(d),[...he.map(k=>k.key),"zoom"].forEach(k=>{l.updateSetting(k,pe[k])}),he.forEach(k=>e.updateSliderValue(k.key,Number(l.settings[k.key]))),c.value=String(l.settings.zoom),R.setZoom(l.settings.zoom),R.resetPan(),se.clear(),A()}),g.addEventListener("click",()=>{ce(f,"bounce"),E(r.value.trim())}),r.addEventListener("keydown",k=>{if(k.key==="Enter"){k.preventDefault();const M=r.value.trim();M!==l.mapName&&(E(M),ce(f,"bounce"),setTimeout(()=>r.blur(),400))}}),r.addEventListener("input",I);const S=()=>{const k=r.value||"Untitled Map",M=JSON.stringify({seed:l.mapName,mapSettings:{...l.settings,zoom:void 0}},null,2);$n(M,`${k.replace(/\s+/g,"_")}${Le}`,"application/json")},N=()=>{const k=r.value||"Untitled Map",M=Object.assign(document.createElement("canvas"),{width:o.width,height:o.height+60}),O=M.getContext("2d");if(!O)return;O.fillStyle="#dedede",O.fillRect(0,0,M.width,M.height),O.drawImage(o,0,60),O.font="bold 36px 'Roboto Mono', monospace",O.fillStyle="#000",O.textAlign="center",O.fillText(k,M.width/2,40);const me=M.toDataURL("image/png"),ke=document.createElement("a");ke.download=`${k.replace(/\s+/g,"_")}.png`,ke.href=me,ke.click()},T=k=>{let M;try{M=JSON.parse(k.target?.result)}catch{alert("Failed to load map file.");return}M.mapSettings&&(M.mapSettings.zoom=0),bt(M)&&(l.settings=M.mapSettings,e.themeRadios.forEach(O=>O.checked=O.value===M.mapSettings.theme),Ee(M.mapSettings.theme),E(M.seed))},D=()=>{const k=Object.assign(document.createElement("input"),{type:"file",accept:Le});k.onchange=M=>{const O=M.target.files?.[0];if(!O)return;const me=new FileReader;me.onload=T,me.readAsText(O)},k.click()},x=document.getElementById("popupBackdrop"),V=()=>{x&&x.classList.remove("show"),document.removeEventListener("keydown",P),document.removeEventListener("click",H)},P=k=>{k.key==="Escape"&&V()},H=k=>{k.target===x&&V()};x&&new MutationObserver(k=>k.forEach(M=>M.attributeName==="class"&&x.classList.contains("show")&&(document.addEventListener("keydown",P),x.addEventListener("click",H)))).observe(x,{attributes:!0}),b.addEventListener("click",()=>{ce(b,"bounce"),x&&x.classList.add("show")}),p.addEventListener("click",()=>{ce(p,"bounce"),D()}),y.addEventListener("click",()=>{N(),V()}),_.addEventListener("click",()=>{S(),V()}),C.addEventListener("click",V),v(),setTimeout(I,100)});document.addEventListener("DOMContentLoaded",()=>{const l=document.getElementById("mobileWarning");if(!l)return;(/Mobi|Android|iPhone|iPad/i.test(navigator.userAgent)||window.innerWidth<768)&&(console.log("MOBILE"),l.classList.add("show"))});
