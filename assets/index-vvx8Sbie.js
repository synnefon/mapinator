(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();const Ae={resolution:75,jitter:.5,wavelength:.2,rainfall:.6,seaLevel:.5,shatter:.1,edgeCurve:.8,greyScale:!1},be=Math.sqrt(3),Ee=.5*(be-1),q=(3-be)/6,he=a=>Math.floor(a)|0,ce=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function ue(a=Math.random){const e=Ce(a),t=new Float64Array(e).map(n=>ce[n%12*2]),i=new Float64Array(e).map(n=>ce[n%12*2+1]);return function(s,o){let r=0,l=0,c=0;const f=(s+o)*Ee,h=he(s+f),u=he(o+f),d=(h+u)*q,g=h-d,m=u-d,p=s-g,_=o-m;let b,C;p>_?(b=1,C=0):(b=0,C=1);const I=p-b+q,N=_-C+q,T=p-1+2*q,k=_-1+2*q,S=h&255,y=u&255;let E=.5-p*p-_*_;if(E>=0){const w=S+e[y],R=t[w],M=i[w];E*=E,r=E*E*(R*p+M*_)}let A=.5-I*I-N*N;if(A>=0){const w=S+b+e[y+C],R=t[w],M=i[w];A*=A,l=A*A*(R*I+M*N)}let x=.5-T*T-k*k;if(x>=0){const w=S+1+e[y+1],R=t[w],M=i[w];x*=x,c=x*x*(R*T+M*k)}return 70*(r+l+c)}}function Ce(a){const t=new Uint8Array(512);for(let i=0;i<512/2;i++)t[i]=i;for(let i=0;i<512/2-1;i++){const n=i+~~(a()*(256-i)),s=t[i];t[i]=t[n],t[n]=s}for(let i=256;i<512;i++)t[i]=t[i-256];return t}function Y(a){let e=we(a);return e===0&&(e=1831565813),function(){return e^=e<<13,e^=e>>>17,e^=e<<5,(e>>>0)%1e6/1e6}}function we(a){let e=2166136261;for(let t=0;t<a.length;t++)e^=a.charCodeAt(t),e=Math.imul(e,16777619);return e>>>0}const D={OCEAN:{color:"#44447a",greyscale:"#000000",name:"ocean"},SUBTROPICAL_DESERT:{color:"#d2b98b",greyscale:"#2B2B2B",name:"subtropical desert"},GRASSLAND:{color:"#88aa55",greyscale:"#3F3F3F",name:"grassland"},TROPICAL_SEASONAL_FOREST:{color:"#559944",greyscale:"#4F4F4F",name:"tropical seasonal forest"},TROPICAL_RAIN_FOREST:{color:"#337755",greyscale:"#5F5F5F",name:"tropical rain forest"},TEMPERATE_DESERT:{color:"#c9d29b",greyscale:"#6A6A6A",name:"temperate desert"},DECIDUOUS_FOREST:{color:"#679459",greyscale:"#7A7A7A",name:"deciduous forest"},TEMPERATE_RAIN_FOREST:{color:"#448855",greyscale:"#8A8A8A",name:"rain forest"},SHRUBLAND:{color:"#889977",greyscale:"#AFAFAF",name:"shrubland"},TAIGA:{color:"#99aa77",greyscale:"#BFBFBF",name:"taiga"},BARREN_ROCK:{color:"#888888",greyscale:"#DADADA",name:"barren rock"},TUNDRA:{color:"#bbbbaa",greyscale:"#EAEAEA",name:"tundra"},GLACIER:{color:"#dddde4",greyscale:"#FFFFFF",name:"glacier"}},ie=[.6,1],se=[.4,.6],Q=[.2,.4],Z=[0,.2],ve=[-1,0],ee=[{elevation:ie,moisture:[0,.2],biome:D.BARREN_ROCK},{elevation:ie,moisture:[.2,.5],biome:D.TUNDRA},{elevation:ie,moisture:[.5,1],biome:D.GLACIER},{elevation:se,moisture:[0,.33],biome:D.TEMPERATE_DESERT},{elevation:se,moisture:[.33,.66],biome:D.SHRUBLAND},{elevation:se,moisture:[.66,1],biome:D.TAIGA},{elevation:Q,moisture:[0,.16],biome:D.TEMPERATE_DESERT},{elevation:Q,moisture:[.16,.5],biome:D.GRASSLAND},{elevation:Q,moisture:[.5,.83],biome:D.DECIDUOUS_FOREST},{elevation:Q,moisture:[.83,1],biome:D.TEMPERATE_RAIN_FOREST},{elevation:Z,moisture:[0,.16],biome:D.SUBTROPICAL_DESERT},{elevation:Z,moisture:[.16,.33],biome:D.GRASSLAND},{elevation:Z,moisture:[.33,.66],biome:D.TROPICAL_SEASONAL_FOREST},{elevation:Z,moisture:[.66,1],biome:D.TROPICAL_RAIN_FOREST},{elevation:ve,moisture:[0,1],biome:D.OCEAN}];class Ie{rainfall;seaLevel;constructor(e,t){if(e<0||e>1||t<0||t>1)throw Error("rainfall & seaLevel must be 0-1");e=this.expCurve(1-e,4.1),this.rainfall=Math.max(.01,e*25),this.seaLevel=2*(t-.5)}getBiome(e,t){let i=2*(e-.5)-(this.seaLevel-.1),n=t**this.rainfall;i=Math.max(Math.min(i,1-this.EPS),-1),n=Math.max(Math.min(n,1-this.EPS),-1);const s=this.findMatchingBiomeRule(i,n);if(!s)throw new Error(`unable to find biome for elevation: ${e}, moisture: ${t}`);return s.biome}findMatchingBiomeRule(e,t){const i=this.findLastIndex(ee,(n,s,o)=>this.matchesRule(n,e,t));return ee[i]}isOcean(e){const t=this.findLastIndex(ee,n=>n.biome.name===D.OCEAN.name);return ee[t].elevation[1]>=e}expCurve(e,t){const i=Math.max(0,Math.min(1,e));return(Math.exp(t*i)-1)/(Math.exp(t)-1)}matchesRule(e,t,i){return e.elevation[0]<=t&&e.elevation[1]>t&&e.moisture[0]<=i&&e.moisture[1]>i}EPS=1e-9;findLastIndex(e,t){for(let i=e.length-1;i>=0;i--)if(t(e[i],i,e))return i;return-1}}const j=11102230246251565e-32,P=134217729,Se=(3+8*j)*j;function oe(a,e,t,i,n){let s,o,r,l,c=e[0],f=i[0],h=0,u=0;f>c==f>-c?(s=c,c=e[++h]):(s=f,f=i[++u]);let d=0;if(h<a&&u<t)for(f>c==f>-c?(o=c+s,r=s-(o-c),c=e[++h]):(o=f+s,r=s-(o-f),f=i[++u]),s=o,r!==0&&(n[d++]=r);h<a&&u<t;)f>c==f>-c?(o=s+c,l=o-s,r=s-(o-l)+(c-l),c=e[++h]):(o=s+f,l=o-s,r=s-(o-l)+(f-l),f=i[++u]),s=o,r!==0&&(n[d++]=r);for(;h<a;)o=s+c,l=o-s,r=s-(o-l)+(c-l),c=e[++h],s=o,r!==0&&(n[d++]=r);for(;u<t;)o=s+f,l=o-s,r=s-(o-l)+(f-l),f=i[++u],s=o,r!==0&&(n[d++]=r);return(s!==0||d===0)&&(n[d++]=s),d}function Ne(a,e){let t=e[0];for(let i=1;i<a;i++)t+=e[i];return t}function X(a){return new Float64Array(a)}const Me=(3+16*j)*j,Te=(2+12*j)*j,ke=(9+64*j)*j*j,$=X(4),de=X(8),fe=X(12),me=X(16),B=X(4);function Re(a,e,t,i,n,s,o){let r,l,c,f,h,u,d,g,m,p,_,b,C,I,N,T,k,S;const y=a-n,E=t-n,A=e-s,x=i-s;I=y*x,u=P*y,d=u-(u-y),g=y-d,u=P*x,m=u-(u-x),p=x-m,N=g*p-(I-d*m-g*m-d*p),T=A*E,u=P*A,d=u-(u-A),g=A-d,u=P*E,m=u-(u-E),p=E-m,k=g*p-(T-d*m-g*m-d*p),_=N-k,h=N-_,$[0]=N-(_+h)+(h-k),b=I+_,h=b-I,C=I-(b-h)+(_-h),_=C-T,h=C-_,$[1]=C-(_+h)+(h-T),S=b+_,h=S-b,$[2]=b-(S-h)+(_-h),$[3]=S;let w=Ne(4,$),R=Te*o;if(w>=R||-w>=R||(h=a-y,r=a-(y+h)+(h-n),h=t-E,c=t-(E+h)+(h-n),h=e-A,l=e-(A+h)+(h-s),h=i-x,f=i-(x+h)+(h-s),r===0&&l===0&&c===0&&f===0)||(R=ke*o+Se*Math.abs(w),w+=y*f+x*r-(A*c+E*l),w>=R||-w>=R))return w;I=r*x,u=P*r,d=u-(u-r),g=r-d,u=P*x,m=u-(u-x),p=x-m,N=g*p-(I-d*m-g*m-d*p),T=l*E,u=P*l,d=u-(u-l),g=l-d,u=P*E,m=u-(u-E),p=E-m,k=g*p-(T-d*m-g*m-d*p),_=N-k,h=N-_,B[0]=N-(_+h)+(h-k),b=I+_,h=b-I,C=I-(b-h)+(_-h),_=C-T,h=C-_,B[1]=C-(_+h)+(h-T),S=b+_,h=S-b,B[2]=b-(S-h)+(_-h),B[3]=S;const M=oe(4,$,4,B,de);I=y*f,u=P*y,d=u-(u-y),g=y-d,u=P*f,m=u-(u-f),p=f-m,N=g*p-(I-d*m-g*m-d*p),T=A*c,u=P*A,d=u-(u-A),g=A-d,u=P*c,m=u-(u-c),p=c-m,k=g*p-(T-d*m-g*m-d*p),_=N-k,h=N-_,B[0]=N-(_+h)+(h-k),b=I+_,h=b-I,C=I-(b-h)+(_-h),_=C-T,h=C-_,B[1]=C-(_+h)+(h-T),S=b+_,h=S-b,B[2]=b-(S-h)+(_-h),B[3]=S;const v=oe(M,de,4,B,fe);I=r*f,u=P*r,d=u-(u-r),g=r-d,u=P*f,m=u-(u-f),p=f-m,N=g*p-(I-d*m-g*m-d*p),T=l*c,u=P*l,d=u-(u-l),g=l-d,u=P*c,m=u-(u-c),p=c-m,k=g*p-(T-d*m-g*m-d*p),_=N-k,h=N-_,B[0]=N-(_+h)+(h-k),b=I+_,h=b-I,C=I-(b-h)+(_-h),_=C-T,h=C-_,B[1]=C-(_+h)+(h-T),S=b+_,h=S-b,B[2]=b-(S-h)+(_-h),B[3]=S;const L=oe(v,fe,4,B,me);return me[L-1]}function te(a,e,t,i,n,s){const o=(e-s)*(t-n),r=(a-n)*(i-s),l=o-r,c=Math.abs(o+r);return Math.abs(l)>=Me*c?l:-Re(a,e,t,i,n,s,c)}const ge=Math.pow(2,-52),ne=new Uint32Array(512);class J{static from(e,t=Pe,i=De){const n=e.length,s=new Float64Array(n*2);for(let o=0;o<n;o++){const r=e[o];s[2*o]=t(r),s[2*o+1]=i(r)}return new J(s)}constructor(e){const t=e.length>>1;if(t>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const i=Math.max(2*t-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:i,_hullTri:n,_hullHash:s}=this,o=e.length>>1;let r=1/0,l=1/0,c=-1/0,f=-1/0;for(let y=0;y<o;y++){const E=e[2*y],A=e[2*y+1];E<r&&(r=E),A<l&&(l=A),E>c&&(c=E),A>f&&(f=A),this._ids[y]=y}const h=(r+c)/2,u=(l+f)/2;let d,g,m;for(let y=0,E=1/0;y<o;y++){const A=re(h,u,e[2*y],e[2*y+1]);A<E&&(d=y,E=A)}const p=e[2*d],_=e[2*d+1];for(let y=0,E=1/0;y<o;y++){if(y===d)continue;const A=re(p,_,e[2*y],e[2*y+1]);A<E&&A>0&&(g=y,E=A)}let b=e[2*g],C=e[2*g+1],I=1/0;for(let y=0;y<o;y++){if(y===d||y===g)continue;const E=Fe(p,_,b,C,e[2*y],e[2*y+1]);E<I&&(m=y,I=E)}let N=e[2*m],T=e[2*m+1];if(I===1/0){for(let A=0;A<o;A++)this._dists[A]=e[2*A]-e[0]||e[2*A+1]-e[1];K(this._ids,this._dists,0,o-1);const y=new Uint32Array(o);let E=0;for(let A=0,x=-1/0;A<o;A++){const w=this._ids[A],R=this._dists[w];R>x&&(y[E++]=w,x=R)}this.hull=y.subarray(0,E),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(te(p,_,b,C,N,T)<0){const y=g,E=b,A=C;g=m,b=N,C=T,m=y,N=E,T=A}const k=ze(p,_,b,C,N,T);this._cx=k.x,this._cy=k.y;for(let y=0;y<o;y++)this._dists[y]=re(e[2*y],e[2*y+1],k.x,k.y);K(this._ids,this._dists,0,o-1),this._hullStart=d;let S=3;i[d]=t[m]=g,i[g]=t[d]=m,i[m]=t[g]=d,n[d]=0,n[g]=1,n[m]=2,s.fill(-1),s[this._hashKey(p,_)]=d,s[this._hashKey(b,C)]=g,s[this._hashKey(N,T)]=m,this.trianglesLen=0,this._addTriangle(d,g,m,-1,-1,-1);for(let y=0,E,A;y<this._ids.length;y++){const x=this._ids[y],w=e[2*x],R=e[2*x+1];if(y>0&&Math.abs(w-E)<=ge&&Math.abs(R-A)<=ge||(E=w,A=R,x===d||x===g||x===m))continue;let M=0;for(let H=0,xe=this._hashKey(w,R);H<this._hashSize&&(M=s[(xe+H)%this._hashSize],!(M!==-1&&M!==i[M]));H++);M=t[M];let v=M,L;for(;L=i[v],te(w,R,e[2*v],e[2*v+1],e[2*L],e[2*L+1])>=0;)if(v=L,v===M){v=-1;break}if(v===-1)continue;let G=this._addTriangle(v,x,i[v],-1,-1,n[v]);n[x]=this._legalize(G+2),n[v]=G,S++;let z=i[v];for(;L=i[z],te(w,R,e[2*z],e[2*z+1],e[2*L],e[2*L+1])<0;)G=this._addTriangle(z,x,L,n[x],-1,n[z]),n[x]=this._legalize(G+2),i[z]=z,S--,z=L;if(v===M)for(;L=t[v],te(w,R,e[2*L],e[2*L+1],e[2*v],e[2*v+1])<0;)G=this._addTriangle(L,x,v,-1,n[v],n[L]),this._legalize(G+2),n[L]=G,i[v]=v,S--,v=L;this._hullStart=t[x]=v,i[v]=t[z]=x,i[x]=z,s[this._hashKey(w,R)]=x,s[this._hashKey(e[2*v],e[2*v+1])]=v}this.hull=new Uint32Array(S);for(let y=0,E=this._hullStart;y<S;y++)this.hull[y]=E,E=i[E];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(Le(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:i,coords:n}=this;let s=0,o=0;for(;;){const r=i[e],l=e-e%3;if(o=l+(e+2)%3,r===-1){if(s===0)break;e=ne[--s];continue}const c=r-r%3,f=l+(e+1)%3,h=c+(r+2)%3,u=t[o],d=t[e],g=t[f],m=t[h];if(Oe(n[2*u],n[2*u+1],n[2*d],n[2*d+1],n[2*g],n[2*g+1],n[2*m],n[2*m+1])){t[e]=m,t[r]=u;const _=i[h];if(_===-1){let C=this._hullStart;do{if(this._hullTri[C]===h){this._hullTri[C]=e;break}C=this._hullPrev[C]}while(C!==this._hullStart)}this._link(e,_),this._link(r,i[o]),this._link(o,h);const b=c+(r+1)%3;s<ne.length&&(ne[s++]=b)}else{if(s===0)break;e=ne[--s]}}return o}_link(e,t){this._halfedges[e]=t,t!==-1&&(this._halfedges[t]=e)}_addTriangle(e,t,i,n,s,o){const r=this.trianglesLen;return this._triangles[r]=e,this._triangles[r+1]=t,this._triangles[r+2]=i,this._link(r,n),this._link(r+1,s),this._link(r+2,o),this.trianglesLen+=3,r}}function Le(a,e){const t=a/(Math.abs(a)+Math.abs(e));return(e>0?3-t:1+t)/4}function re(a,e,t,i){const n=a-t,s=e-i;return n*n+s*s}function Oe(a,e,t,i,n,s,o,r){const l=a-o,c=e-r,f=t-o,h=i-r,u=n-o,d=s-r,g=l*l+c*c,m=f*f+h*h,p=u*u+d*d;return l*(h*p-m*d)-c*(f*p-m*u)+g*(f*d-h*u)<0}function Fe(a,e,t,i,n,s){const o=t-a,r=i-e,l=n-a,c=s-e,f=o*o+r*r,h=l*l+c*c,u=.5/(o*c-r*l),d=(c*f-r*h)*u,g=(o*h-l*f)*u;return d*d+g*g}function ze(a,e,t,i,n,s){const o=t-a,r=i-e,l=n-a,c=s-e,f=o*o+r*r,h=l*l+c*c,u=.5/(o*c-r*l),d=a+(c*f-r*h)*u,g=e+(o*h-l*f)*u;return{x:d,y:g}}function K(a,e,t,i){if(i-t<=20)for(let n=t+1;n<=i;n++){const s=a[n],o=e[s];let r=n-1;for(;r>=t&&e[a[r]]>o;)a[r+1]=a[r--];a[r+1]=s}else{const n=t+i>>1;let s=t+1,o=i;W(a,n,s),e[a[t]]>e[a[i]]&&W(a,t,i),e[a[s]]>e[a[i]]&&W(a,s,i),e[a[t]]>e[a[s]]&&W(a,t,s);const r=a[s],l=e[r];for(;;){do s++;while(e[a[s]]<l);do o--;while(e[a[o]]>l);if(o<s)break;W(a,s,o)}a[t+1]=a[o],a[o]=r,i-s+1>=o-t?(K(a,e,s,i),K(a,e,t,o-1)):(K(a,e,t,o-1),K(a,e,s,i))}}function W(a,e,t){const i=a[e];a[e]=a[t],a[t]=i}function Pe(a){return a[0]}function De(a){return a[1]}class _e{rng=()=>0;seed;constructor(e){this.seed=e}reSeed(e){this.seed=e}genPoints(e){this.rng=Y(`${this.seed}-${e.resolution}`);const{resolution:t,jitter:i}=e,n=this.initPoints(t,i),{centers:s,delaunay:o}=this.relaxPoints(n,4);return{centers:s,delaunay:o}}nextHalfedge(e){return e%3===2?e-2:e+1}triOfEdge(e){return Math.floor(e/3)}buildInedges(e,t){const i=new Int32Array(t).fill(-1),{triangles:n}=e;for(let s=0;s<n.length;s++)i[n[s]]=s;return i}halfedgesAroundSite(e,t,i){const{triangles:n,halfedges:s}=e;let o=t[i];if(o===-1)return null;const r=[];let l=o;do{r.push(l);const c=this.nextHalfedge(l),f=s[c];if(f===-1)return null;l=f,n[l]!==i&&(l=this.nextHalfedge(l),n[l]!==i&&(l=this.nextHalfedge(l)))}while(l!==o);return r}circumcenterOfTri(e,t,i){const{triangles:n}=i,s=e[n[3*t+0]],o=e[n[3*t+1]],r=e[n[3*t+2]],l=s.x*s.x+s.y*s.y,c=o.x*o.x+o.y*o.y,f=r.x*r.x+r.y*r.y,h=2*(s.x*(o.y-r.y)+o.x*(r.y-s.y)+r.x*(s.y-o.y));if(Math.abs(h)<1e-12)return{x:(s.x+o.x+r.x)/3,y:(s.y+o.y+r.y)/3};const u=(l*(o.y-r.y)+c*(r.y-s.y)+f*(s.y-o.y))/h,d=(l*(r.x-o.x)+c*(s.x-r.x)+f*(o.x-s.x))/h;return{x:u,y:d}}polygonCentroid(e,t){let i=0,n=0,s=0;const o=e.length;for(let l=0,c=o-1;l<o;c=l++){const f=e[l].x,h=e[l].y,u=e[c].x,d=e[c].y,g=u*h-f*d;i+=g,n+=(u+f)*g,s+=(d+h)*g}if(Math.abs(i)<1e-12)return t;const r=i/2;return{x:n/(6*r),y:s/(6*r)}}relaxOnce(e){const t=J.from(e,s=>s.x,s=>s.y),i=this.buildInedges(t,e.length),n=new Array(e.length);for(let s=0;s<e.length;s++){const o=this.halfedgesAroundSite(t,i,s);if(!o){n[s]=e[s];continue}const r=o.map(l=>this.circumcenterOfTri(e,this.triOfEdge(l),t));n[s]=this.polygonCentroid(r,e[s])}return{centers:n,delaunay:t}}relaxPoints(e,t){let i=e,n;for(let s=0;s<t;s++){const{centers:o,delaunay:r}=this.relaxOnce(i);i=o,n=r}if(!n)throw new Error("iterations wrong");return{centers:i,delaunay:n}}initPoints(e,t){const i=[];for(let n=0;n<e;n++)for(let s=0;s<e;s++){const o=n+t*(this.rng()-this.rng()),r=s+t*(this.rng()-this.rng());i.push({x:o,y:r})}return i}}class Be{noise2D;pointGenerator;constructor(e){this.noise2D=ue(Y(e)),this.pointGenerator=new _e(e)}reSeed(e){this.noise2D=ue(Y(e)),this.pointGenerator=new _e(e)}generateMap(e){e={...e,wavelength:e.wavelength+.2};const{resolution:t}=e,{centers:i,delaunay:n}=this.pointGenerator.genPoints(e),s={points:i,resolution:t,numRegions:i.length,numTriangles:n.halfedges.length/3,numEdges:n.halfedges.length,halfedges:n.halfedges,triangles:n.triangles},o=this.genElevations(s,e),r=this.genMoistures(s,e),l=this.calcBiomes(s,o,r,e);return{...s,elevations:o,moistures:r,biomes:l}}calcBiomes(e,t,i,n){const{numRegions:s}=e,o=new Ie(n.rainfall,n.seaLevel),r=[];for(let l=0;l<s;l++)r.push(o.getBiome(t[l],i[l]));return r}genMoistures(e,t){const i=t.wavelength,{points:n,numRegions:s}=e;let o=[];for(let r=0;r<s;r++){const l=n[r].x/e.resolution-.5,c=n[r].y/e.resolution-1/2,f=(1+this.noise2D(l/i,c/i))/2;o[r]=Math.max(0,Math.min(1,f))}return o}genElevations(e,t){const{wavelength:i,edgeCurve:n}=t,s=1-t.shatter,o=.5,l=o+(3-o)*n,{points:c,numRegions:f,resolution:h}=e,u=new Array(f),d=m=>m<0?0:m>1?1:m,g=(m,p,_)=>m+(p-m)*_;for(let m=0;m<f;m++){const p=c[m].x/h-.5,_=c[m].y/h-.5;let b=1/3+this.noise2D(p/i,_/i)/2+this.noise2D(2*p/i,2*_/i)/3,C=2*Math.max(Math.abs(p),Math.abs(_));C=Math.pow(C,l);const I=(1+b-C)/2;b=g(b,I,d(s)),u[m]=d(b)}return u}}var F=(a=>(a.ROMANCE="ROMANCE",a.GERMANIC="GERMANIC",a.TURKIC="TURKIC",a.SEMITIC="SEMITIC",a.BANTU_LIKE="BANTU_LIKE",a.AFRICAN_WEST="AFRICAN_WEST",a.AFRICAN_HORN="AFRICAN_HORN",a.EAST_ASIAN_CN="EAST_ASIAN_CN",a.EAST_ASIAN_JP="EAST_ASIAN_JP",a.POLYNESIAN="POLYNESIAN",a.MONGOLIC="MONGOLIC",a.GREEKIC="GREEKIC",a.LATINIC="LATINIC",a.CELESTIC="CELESTIC",a.INFERNIC="INFERNIC",a.ARCANE="ARCANE",a.DEEP_SPEECH="DEEP_SPEECH",a.GOBLINIC="GOBLINIC",a.TECHNARCH="TECHNARCH",a.INFERNO="INFERNO",a.SIRENIC="SIRENIC",a))(F||{});const Ge=["a","e","i","o","u"],je=["ai","au","ei","ia","io","oa","ue","ui"],Ue=["a","e","i","o","u","ia","io","ie","ea"],He=["a","i","u","aa","ii","uu","ai","au"],ye={ROMANCE:{onsets:["b","c","d","f","g","l","m","n","p","r","s","t","br","cr","dr","fl","gl","gr","pr","tr","vr"],vowels:[...Ue,"oa","ue","eo"],codas:["n","r","s","l","m"],codaChance:.45,medials:["del","dor","ver","mar","val","lor","ria","lia","mia"],medialMorphChance:.45,suffixes:["ia","aria","esia","orio","io","a","o","es"]},GERMANIC:{onsets:["b","d","f","g","h","k","l","m","n","p","r","s","t","w","th","br","cr","dr","fr","gr","kr","pr","tr","st","sk","sp"],vowels:[...Ge,...je],codas:["nd","rt","rm","rg","lf","rk","lt","st","sk","n","r","m","l","k"],codaChance:.65,medials:["wald","heim","mark","gard","dorf"],medialMorphChance:.3,suffixes:["land","heim","berg"]},SEMITIC:{onsets:["al","ar","as","bal","dar","qal","mal","ram","sam","zar","bar","sar"],vowels:[...He],codas:["n","m","r","l","s","h"],codaChance:.5,medials:["har","sar","ram","bar"],medialMorphChance:.35,suffixes:["ia","aya","iyya"]},AFRICAN_WEST:{onsets:["a","ba","da","ka","fa","ga","la","ma","na","oba","ola","ade","kw","gb","ch","ny","eke","oba","ife","olu"],vowels:["a","e","i","o","u","ai","oa","ie","ua"],codas:["n","m","wa","ra",""],codaChance:.35,medials:["loba","femi","kwe","tunde","chukwu","nwa","kofi","yemi"],medialMorphChance:.5,suffixes:["la","ba","ra","ni","do","ma"]},AFRICAN_HORN:{onsets:["ab","ad","as","ba","da","ha","ka","ma","na","sa","ra","ta","gez","tes","hab","sel","mer","zer","yon","lem"],vowels:["a","e","i","o","u","aa","ee","ei","ia","ua"],codas:["s","m","n","l","t",""],codaChance:.45,medials:["sel","geb","tek","yon","hab","mar","zer","wold"],medialMorphChance:.5,suffixes:["el","es","os","on","u"]},EAST_ASIAN_CN:{onsets:["b","p","m","f","d","t","n","l","g","k","h","zh","ch","sh","r","z","c","s"],vowels:["a","o","e","i","u","ü","ai","ei","ao","ou","ia","ie","iao","iu","ua","uo","ui","üe","er"],codas:["n","ng",""],codaChance:.4,medials:["shan","jiang","he","hu","zhou","dao","lin","yang","qing","jing","guo","cheng"],medialMorphChance:.35,suffixes:["shan","dao","zhou","guo","cheng","men"]},EAST_ASIAN_JP:{onsets:["k","s","t","n","h","m","y","r","w","g","z","d","b","p","ky","sh","ch","ny","hy","my","ry","gy","j","py"],vowels:["a","i","u","e","o"],codas:["","n"],codaChance:.35,medials:["mori","yama","kawa","gawa","shima","jima","saka","hara","tani"],medialMorphChance:.3,suffixes:["to","ken","do","fu","shi","mura"]},POLYNESIAN:{onsets:["","h","k","l","m","n","p","r","t","w","wh","ng"],vowels:["a","e","i","o","u"],codas:["","’","ʻ"],codaChance:.2,medials:["moa","rangi","tonga","tai","wai","puna","tapu","mana","ariki","tiki","honu","pua","mata","ika","koro","hale","fale","nui","loa","roa"],medialMorphChance:.3,suffixes:["nui","roa","loa","rangi","moana","tonga","tai","puna"]},LATINIC:{onsets:["a","e","i","o","u","b","c","d","f","g","l","m","n","p","r","s","t","v","cl","fl","gl","pr","tr","cr","pl","fr","gr","dr","qu"],vowels:["a","e","i","o","u","ae","oe","au","ia","io","ua","uo"],codas:["s","n","r","m","t","l","us","um","a"],codaChance:.55,medials:["dom","val","magn","clar","fort","sanct","imper","aure","vit","cel","luc","reg","mart"],medialMorphChance:.5,suffixes:["us","um","a","or","is","ianus","ensis","atus","itas","arium","arium"]},MONGOLIC:{onsets:["ba","bo","bu","ta","to","tu","ga","go","gu","da","do","du","kha","kh","qar","gur","dar","bor","nar","sar","bat","alt"],vowels:["a","e","i","o","u","ai","oi","ua","uu"],codas:["n","r","g","t","s",""],codaChance:.5,medials:["bator","dorj","suren","erdene","tungal","bayar","bold","gan"],medialMorphChance:.5,suffixes:["bator","gur","tengri","dalai","khun"]},INFERNIC:{onsets:["gr","kr","dr","br","thr","vr","zr","kl","sk","sn","gn","vrog","ulg","zor","rak","gash","morg"],vowels:["a","o","u","e","ia","oa","ua","ai","oi"],codas:["th","k","g","r","z","x","sh","kh","gh","n","m"],codaChance:.75,medials:["gor","zul","rak","thr","khar","vur","drak","mor","gron","vul"],medialMorphChance:.45,suffixes:["oth","ar","rak","gul","zor","eth","uzad","ash","ath"]},ARCANE:{onsets:["a","e","i","o","u","x","z","v","q","k","s","r","th","sh","ch","ph","gh","xa","xi","ze","zy","qu","ka","ly","sy","va","or","ny"],vowels:["a","e","i","o","u","ae","ia","ie","io","ei","ou","ui"],codas:["n","r","s","th","x","z","sh","m","l","t"],codaChance:.6,medials:["ar","en","is","os","ith","al","or","ir","um","ex","ul"],medialMorphChance:.5,suffixes:["ar","en","is","os","ith","or","ul","um","ae","ion"]},CELESTIC:{onsets:["a","ae","e","el","al","il","ol","ul","cel","ser","ver","lir","aur","eir","mir","thal","val"],vowels:["a","e","i","o","u","ae","ea","ai","ia","ie","io","ou","ui"],codas:["l","n","r","s","th","el","iel","ar","is","as"],codaChance:.55,medials:["ael","iel","ion","ora","iel","ir","ara","uri","arion"],medialMorphChance:.6,suffixes:["iel","ael","ion","ora","is","arion","iel","eth"]},DEEP_SPEECH:{onsets:["gh","gr","kr","zr","zh","xh","kl","ql","k’","x’","t’","sh","sk","thl","vr","vx","dl","rk"],vowels:["a","u","o","e","ia","ua","ao","ou",""],codas:["th","x","g","k","z","sh","’th","’x","’g","n"],codaChance:.8,medials:["ul","gur","zha","kth","rax","xul","gath","urh","shul","vrax","qor","thrul","zoth"],medialMorphChance:.45,suffixes:["’thul","’gath","’nax","’ul","’rax","oth","zoth","gath","khul"]},GOBLINIC:{onsets:["g","gr","kr","kl","sn","sk","sm","sp","st","tr","dr","bl","br","pl","gl","zz","gn","ch","sc"],vowels:["a","e","i","o","u","aa","oo","ei","oi"],codas:["k","g","n","m","b","t","z","zz","sh","p","x",""],codaChance:.7,medials:["grub","snag","krat","blit","skrag","drub","gnar","plok","zib","krin","grot","snib"],medialMorphChance:.45,suffixes:["ak","ig","ok","nob","zit","gob","bag","pik","nip","ogg"]},INFERNO:{onsets:["f","ph","b","v","p","t","th","kh","k","r","s","sh","ch","z","br","kr","fr","fl","dr","gr","vr","zar","bal","kal","ash","rav","ign","py","flam"],vowels:["a","e","i","o","u","aa","ae","ai","au","ea","ei","io","oa","ou","ua"],codas:["r","s","th","x","z","n","m","sh","ch","k","t","ar","az","eth","oth"],codaChance:.7,medials:["ash","zar","rak","vyr","thar","gor","ign","az","flar","kesh","rath","vor","pyra"],medialMorphChance:.45,suffixes:["ash","ur","zar","eth","or","oth","ar","rak","ath","zor","ion"]},SIRENIC:{onsets:["a","e","i","o","u","l","n","m","s","v","r","h","w","sh","th","ph","ch","wh","ly","ny","sel","sir","mar","nai","ora","thal","vel","mel","lun","aqu","ond"],vowels:["a","e","i","o","u","ae","ai","ea","ee","ia","ie","io","oa","oe","ou","ua","ue","ui"],codas:["n","r","l","s","th","sh","h","m","el","en","ir","is","a","ia","ine"],codaChance:.45,medials:["ara","ela","ine","ora","ula","iri","oni","ari","una","esi","mar","sel","vai","wen","lua","nys"],medialMorphChance:.4,suffixes:["ine","is","ir","iel","ora","ara","una","elle","en","ys","eth","wen"]}};class $e{rng;constructor(e){this.rng=Y(e)}reSeed(e){this.rng=Y(e)}generate(e={}){const t=e.lang??this.pickLanguage(),[i,n]=e.syllables??[1,2],s=this.randInt(i,n),o=(e.forceSuffix??this.pickSuffix(t)).toLowerCase();let r=this.buildStem(s,t);return r=this.tidyStemVsSuffix(r,o),this.titleCase(r+o)}pickLanguage(){const e=[F.ROMANCE,F.GERMANIC,F.SEMITIC,F.EAST_ASIAN_CN,F.EAST_ASIAN_JP,F.AFRICAN_WEST,F.AFRICAN_HORN,F.POLYNESIAN,F.LATINIC,F.CELESTIC,F.INFERNIC,F.ARCANE,F.DEEP_SPEECH,F.GOBLINIC,F.INFERNO,F.SIRENIC];return e[Math.floor(this.rng()*e.length)]}pickSuffix(e){const t=ye[e].suffixes;return t[Math.floor(this.rng()*t.length)]}buildStem(e,t){const i=ye[t];let n="",s=this.pick(i.onsets);for(let o=0;o<e;o++){const r=o===e-1,l=s,c=this.pick(i.vowels);s=r?"":this.pick(i.onsets);const f=i.codaChance??0,h=Math.min(.95,Math.max(0,f*(r?1.2:.6)));let u="";if(this.rng()<h){const d=this.pick(i.codas)??"";if(d){const g=s&&this.startsWithConsonant(s),m=this.endsWithConsonant(d);!r&&g&&m?this.rng()>=.6&&(u=d):u=d}}n+=l+c+u}return n}isVowel(e){return/^[aeiou]$/i.test(e)}startsWithConsonant(e){const t=e.charAt(0);return/^[a-z]/i.test(t)?!this.isVowel(t):!0}endsWithConsonant(e){const t=e.slice(-1);return/^[a-z]/i.test(t)?!this.isVowel(t):!0}tidyStemVsSuffix(e,t){return/[aeiou]$/i.test(e)&&/^[aeiou]/i.test(t)?e.slice(0,-1):e}titleCase(e){return e.charAt(0).toUpperCase()+e.slice(1)}pick(e){return e[Math.floor(this.rng()*e.length)]}randInt(e,t){return Math.floor(this.rng()*(t-e+1))+e}}const pe=1e-6;class U{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,i){e=+e,t=+t,i=+i;const n=e+i,s=t;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${n},${s}`:(Math.abs(this._x1-n)>pe||Math.abs(this._y1-s)>pe)&&(this._+="L"+n+","+s),i&&(this._+=`A${i},${i},0,1,1,${e-i},${t}A${i},${i},0,1,1,${this._x1=n},${this._y1=s}`)}rect(e,t,i,n){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+i}v${+n}h${-i}Z`}value(){return this._||null}}class le{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class Ve{constructor(e,[t,i,n,s]=[0,0,960,500]){if(!((n=+n)>=(t=+t))||!((s=+s)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(e.points.length*2),this.vectors=new Float64Array(e.points.length*2),this.xmax=n,this.xmin=t,this.ymax=s,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:i},vectors:n}=this;let s,o;const r=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let m=0,p=0,_=i.length,b,C;m<_;m+=3,p+=2){const I=i[m]*2,N=i[m+1]*2,T=i[m+2]*2,k=e[I],S=e[I+1],y=e[N],E=e[N+1],A=e[T],x=e[T+1],w=y-k,R=E-S,M=A-k,v=x-S,L=(w*v-R*M)*2;if(Math.abs(L)<1e-9){if(s===void 0){s=o=0;for(const z of t)s+=e[z*2],o+=e[z*2+1];s/=t.length,o/=t.length}const G=1e9*Math.sign((s-k)*v-(o-S)*M);b=(k+A)/2-G*v,C=(S+x)/2+G*M}else{const G=1/L,z=w*w+R*R,H=M*M+v*v;b=k+(v*z-R*H)*G,C=S+(w*H-M*z)*G}r[p]=b,r[p+1]=C}let l=t[t.length-1],c,f=l*4,h,u=e[2*l],d,g=e[2*l+1];n.fill(0);for(let m=0;m<t.length;++m)l=t[m],c=f,h=u,d=g,f=l*4,u=e[2*l],g=e[2*l+1],n[c+2]=n[f]=d-g,n[c+3]=n[f+1]=u-h}render(e){const t=e==null?e=new U:void 0,{delaunay:{halfedges:i,inedges:n,hull:s},circumcenters:o,vectors:r}=this;if(s.length<=1)return null;for(let f=0,h=i.length;f<h;++f){const u=i[f];if(u<f)continue;const d=Math.floor(f/3)*2,g=Math.floor(u/3)*2,m=o[d],p=o[d+1],_=o[g],b=o[g+1];this._renderSegment(m,p,_,b,e)}let l,c=s[s.length-1];for(let f=0;f<s.length;++f){l=c,c=s[f];const h=Math.floor(n[c]/3)*2,u=o[h],d=o[h+1],g=l*4,m=this._project(u,d,r[g+2],r[g+3]);m&&this._renderSegment(u,d,m[0],m[1],e)}return t&&t.value()}renderBounds(e){const t=e==null?e=new U:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const i=t==null?t=new U:void 0,n=this._clip(e);if(n===null||!n.length)return;t.moveTo(n[0],n[1]);let s=n.length;for(;n[0]===n[s-2]&&n[1]===n[s-1]&&s>1;)s-=2;for(let o=2;o<s;o+=2)(n[o]!==n[o-2]||n[o+1]!==n[o-1])&&t.lineTo(n[o],n[o+1]);return t.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,i=e.length/2;t<i;++t){const n=this.cellPolygon(t);n&&(n.index=t,yield n)}}cellPolygon(e){const t=new le;return this.renderCell(e,t),t.value()}_renderSegment(e,t,i,n,s){let o;const r=this._regioncode(e,t),l=this._regioncode(i,n);r===0&&l===0?(s.moveTo(e,t),s.lineTo(i,n)):(o=this._clipSegment(e,t,i,n,r,l))&&(s.moveTo(o[0],o[1]),s.lineTo(o[2],o[3]))}contains(e,t,i){return t=+t,t!==t||(i=+i,i!==i)?!1:this.delaunay._step(e,t,i)===e}*neighbors(e){const t=this._clip(e);if(t)for(const i of this.delaunay.neighbors(e)){const n=this._clip(i);if(n){e:for(let s=0,o=t.length;s<o;s+=2)for(let r=0,l=n.length;r<l;r+=2)if(t[s]===n[r]&&t[s+1]===n[r+1]&&t[(s+2)%o]===n[(r+l-2)%l]&&t[(s+3)%o]===n[(r+l-1)%l]){yield i;break e}}}}_cell(e){const{circumcenters:t,delaunay:{inedges:i,halfedges:n,triangles:s}}=this,o=i[e];if(o===-1)return null;const r=[];let l=o;do{const c=Math.floor(l/3);if(r.push(t[c*2],t[c*2+1]),l=l%3===2?l-2:l+1,s[l]!==e)break;l=n[l]}while(l!==o&&l!==-1);return r}_clip(e){if(e===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(t===null)return null;const{vectors:i}=this,n=e*4;return this._simplify(i[n]||i[n+1]?this._clipInfinite(e,t,i[n],i[n+1],i[n+2],i[n+3]):this._clipFinite(e,t))}_clipFinite(e,t){const i=t.length;let n=null,s,o,r=t[i-2],l=t[i-1],c,f=this._regioncode(r,l),h,u=0;for(let d=0;d<i;d+=2)if(s=r,o=l,r=t[d],l=t[d+1],c=f,f=this._regioncode(r,l),c===0&&f===0)h=u,u=0,n?n.push(r,l):n=[r,l];else{let g,m,p,_,b;if(c===0){if((g=this._clipSegment(s,o,r,l,c,f))===null)continue;[m,p,_,b]=g}else{if((g=this._clipSegment(r,l,s,o,f,c))===null)continue;[_,b,m,p]=g,h=u,u=this._edgecode(m,p),h&&u&&this._edge(e,h,u,n,n.length),n?n.push(m,p):n=[m,p]}h=u,u=this._edgecode(_,b),h&&u&&this._edge(e,h,u,n,n.length),n?n.push(_,b):n=[_,b]}if(n)h=u,u=this._edgecode(n[0],n[1]),h&&u&&this._edge(e,h,u,n,n.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return n}_clipSegment(e,t,i,n,s,o){const r=s<o;for(r&&([e,t,i,n,s,o]=[i,n,e,t,o,s]);;){if(s===0&&o===0)return r?[i,n,e,t]:[e,t,i,n];if(s&o)return null;let l,c,f=s||o;f&8?(l=e+(i-e)*(this.ymax-t)/(n-t),c=this.ymax):f&4?(l=e+(i-e)*(this.ymin-t)/(n-t),c=this.ymin):f&2?(c=t+(n-t)*(this.xmax-e)/(i-e),l=this.xmax):(c=t+(n-t)*(this.xmin-e)/(i-e),l=this.xmin),s?(e=l,t=c,s=this._regioncode(e,t)):(i=l,n=c,o=this._regioncode(i,n))}}_clipInfinite(e,t,i,n,s,o){let r=Array.from(t),l;if((l=this._project(r[0],r[1],i,n))&&r.unshift(l[0],l[1]),(l=this._project(r[r.length-2],r[r.length-1],s,o))&&r.push(l[0],l[1]),r=this._clipFinite(e,r))for(let c=0,f=r.length,h,u=this._edgecode(r[f-2],r[f-1]);c<f;c+=2)h=u,u=this._edgecode(r[c],r[c+1]),h&&u&&(c=this._edge(e,h,u,r,c),f=r.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(r=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return r}_edge(e,t,i,n,s){for(;t!==i;){let o,r;switch(t){case 5:t=4;continue;case 4:t=6,o=this.xmax,r=this.ymin;break;case 6:t=2;continue;case 2:t=10,o=this.xmax,r=this.ymax;break;case 10:t=8;continue;case 8:t=9,o=this.xmin,r=this.ymax;break;case 9:t=1;continue;case 1:t=5,o=this.xmin,r=this.ymin;break}(n[s]!==o||n[s+1]!==r)&&this.contains(e,o,r)&&(n.splice(s,0,o,r),s+=2)}return s}_project(e,t,i,n){let s=1/0,o,r,l;if(n<0){if(t<=this.ymin)return null;(o=(this.ymin-t)/n)<s&&(l=this.ymin,r=e+(s=o)*i)}else if(n>0){if(t>=this.ymax)return null;(o=(this.ymax-t)/n)<s&&(l=this.ymax,r=e+(s=o)*i)}if(i>0){if(e>=this.xmax)return null;(o=(this.xmax-e)/i)<s&&(r=this.xmax,l=t+(s=o)*n)}else if(i<0){if(e<=this.xmin)return null;(o=(this.xmin-e)/i)<s&&(r=this.xmin,l=t+(s=o)*n)}return[r,l]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}_simplify(e){if(e&&e.length>4){for(let t=0;t<e.length;t+=2){const i=(t+2)%e.length,n=(t+4)%e.length;(e[t]===e[i]&&e[i]===e[n]||e[t+1]===e[i+1]&&e[i+1]===e[n+1])&&(e.splice(i,2),t-=2)}e.length||(e=null)}return e}}const Ke=2*Math.PI,V=Math.pow;function qe(a){return a[0]}function We(a){return a[1]}function Ye(a){const{triangles:e,coords:t}=a;for(let i=0;i<e.length;i+=3){const n=2*e[i],s=2*e[i+1],o=2*e[i+2];if((t[o]-t[n])*(t[s+1]-t[n+1])-(t[s]-t[n])*(t[o+1]-t[n+1])>1e-10)return!1}return!0}function Je(a,e,t){return[a+Math.sin(a+e)*t,e+Math.cos(a-e)*t]}class ae{static from(e,t=qe,i=We,n){return new ae("length"in e?Xe(e,t,i,n):Float64Array.from(Qe(e,t,i,n)))}constructor(e){this._delaunator=new J(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&Ye(e)){this.collinear=Int32Array.from({length:t.length/2},(u,d)=>d).sort((u,d)=>t[2*u]-t[2*d]||t[2*u+1]-t[2*d+1]);const l=this.collinear[0],c=this.collinear[this.collinear.length-1],f=[t[2*l],t[2*l+1],t[2*c],t[2*c+1]],h=1e-8*Math.hypot(f[3]-f[1],f[2]-f[0]);for(let u=0,d=t.length/2;u<d;++u){const g=Je(t[2*u],t[2*u+1],h);t[2*u]=g[0],t[2*u+1]=g[1]}this._delaunator=new J(t)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,n=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),r=this._hullIndex.fill(-1);for(let l=0,c=i.length;l<c;++l){const f=s[l%3===2?l-2:l+1];(i[l]===-1||o[f]===-1)&&(o[f]=l)}for(let l=0,c=n.length;l<c;++l)r[n[l]]=l;n.length<=2&&n.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=n[0],o[n[0]]=1,n.length===2&&(o[n[1]]=0,this.triangles[1]=n[1],this.triangles[2]=n[1]))}voronoi(e){return new Ve(this,e)}*neighbors(e){const{inedges:t,hull:i,_hullIndex:n,halfedges:s,triangles:o,collinear:r}=this;if(r){const h=r.indexOf(e);h>0&&(yield r[h-1]),h<r.length-1&&(yield r[h+1]);return}const l=t[e];if(l===-1)return;let c=l,f=-1;do{if(yield f=o[c],c=c%3===2?c-2:c+1,o[c]!==e)return;if(c=s[c],c===-1){const h=i[(n[e]+1)%i.length];h!==f&&(yield h);return}}while(c!==l)}find(e,t,i=0){if(e=+e,e!==e||(t=+t,t!==t))return-1;const n=i;let s;for(;(s=this._step(i,e,t))>=0&&s!==i&&s!==n;)i=s;return s}_step(e,t,i){const{inedges:n,hull:s,_hullIndex:o,halfedges:r,triangles:l,points:c}=this;if(n[e]===-1||!c.length)return(e+1)%(c.length>>1);let f=e,h=V(t-c[e*2],2)+V(i-c[e*2+1],2);const u=n[e];let d=u;do{let g=l[d];const m=V(t-c[g*2],2)+V(i-c[g*2+1],2);if(m<h&&(h=m,f=g),d=d%3===2?d-2:d+1,l[d]!==e)break;if(d=r[d],d===-1){if(d=s[(o[e]+1)%s.length],d!==g&&V(t-c[d*2],2)+V(i-c[d*2+1],2)<h)return d;break}}while(d!==u);return f}render(e){const t=e==null?e=new U:void 0,{points:i,halfedges:n,triangles:s}=this;for(let o=0,r=n.length;o<r;++o){const l=n[o];if(l<o)continue;const c=s[o]*2,f=s[l]*2;e.moveTo(i[c],i[c+1]),e.lineTo(i[f],i[f+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t){t===void 0&&(!e||typeof e.moveTo!="function")&&(t=e,e=null),t=t==null?2:+t;const i=e==null?e=new U:void 0,{points:n}=this;for(let s=0,o=n.length;s<o;s+=2){const r=n[s],l=n[s+1];e.moveTo(r+t,l),e.arc(r,l,t,0,Ke)}return i&&i.value()}renderHull(e){const t=e==null?e=new U:void 0,{hull:i,points:n}=this,s=i[0]*2,o=i.length;e.moveTo(n[s],n[s+1]);for(let r=1;r<o;++r){const l=2*i[r];e.lineTo(n[l],n[l+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new le;return this.renderHull(e),e.value()}renderTriangle(e,t){const i=t==null?t=new U:void 0,{points:n,triangles:s}=this,o=s[e*=3]*2,r=s[e+1]*2,l=s[e+2]*2;return t.moveTo(n[o],n[o+1]),t.lineTo(n[r],n[r+1]),t.lineTo(n[l],n[l+1]),t.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,i=e.length/3;t<i;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new le;return this.renderTriangle(e,t),t.value()}}function Xe(a,e,t,i){const n=a.length,s=new Float64Array(n*2);for(let o=0;o<n;++o){const r=a[o];s[o*2]=e.call(i,r,o,a),s[o*2+1]=t.call(i,r,o,a)}return s}function*Qe(a,e,t,i){let n=0;for(const s of a)yield e.call(i,s,n,a),yield t.call(i,s,n,a),++n}class Ze{drawCellColors(e,t,i){const n=e.getContext("2d");if(!n)return;const{resolution:s,points:o,biomes:r}=t;n.clearRect(0,0,e.width,e.height),n.save(),n.scale(e.width/s,e.height/s);const c=ae.from(o,f=>f.x,f=>f.y).voronoi([0,0,s,s]);for(let f=0;f<o.length;f++){const h=c.cellPolygon(f);if(!h||h.length<3)continue;n.beginPath(),n.moveTo(h[0][0],h[0][1]);for(let d=1;d<h.length;d++)n.lineTo(h[d][0],h[d][1]);n.closePath();const u=i?r[f].greyscale:r[f].color;n.fillStyle=u,n.fill(),n.strokeStyle=u,n.lineWidth=.05,n.lineJoin="round",n.miterLimit=2,n.stroke()}n.restore()}}const O=a=>{const e=document.getElementById(a);if(!e)throw alert("UI init failed. Check element IDs."),new Error("UI init failed. Check element IDs.");return e};document.addEventListener("DOMContentLoaded",()=>{const a={...Ae},e=new $e(`${Date.now()}`);let t=e.generate();const i=new Be(t),n=new Ze,s=()=>{const x=i.generateMap(a);n.drawCellColors(c,x,a.greyScale)},o=(x=void 0)=>{const w=x??e.generate({});E.textContent=w},r=()=>{o(t),s()},l=x=>{if(!x.trim()){alert("Please enter the name of a map to load in"),t="",S.textContent="";return}t=x,i.reSeed(x),r()},c=O("map"),f=O("regen"),h=O("wavelength"),u=O("wavelengthValue"),d=O("rainfall"),g=O("rainfallValue"),m=O("seaLevel"),p=O("seaLevelValue"),_=O("shatter"),b=O("shatterValue"),C=O("edgeCurve"),I=O("edgeCurveValue"),N=O("resolution"),T=O("resolutionValue"),k=O("grayscale"),S=O("seed-input"),y=O("load-seed-btn"),E=O("map-title");h.value=String(a.wavelength),u.textContent=a.wavelength.toFixed(2),d.value=String(a.rainfall),g.textContent=a.rainfall.toFixed(2),m.value=String(a.seaLevel),p.textContent=a.seaLevel.toFixed(2),_.value=String(a.shatter),b.textContent=a.shatter.toFixed(2),C.value=String(a.edgeCurve),I.textContent=a.edgeCurve.toFixed(2),N.value=String(a.resolution),T.textContent=a.resolution.toFixed(2),k.checked=a.greyScale,h.addEventListener("input",()=>{a.wavelength=Number(h.value),u.textContent=a.wavelength.toFixed(2),s()}),d.addEventListener("input",()=>{a.rainfall=Number(d.value),g.textContent=a.rainfall.toFixed(2),s()}),m.addEventListener("input",()=>{a.seaLevel=Number(m.value),p.textContent=a.seaLevel.toFixed(2),s()}),_.addEventListener("input",()=>{a.shatter=Number(_.value),b.textContent=a.shatter.toFixed(2),s()}),C.addEventListener("input",()=>{a.edgeCurve=Number(C.value),I.textContent=a.edgeCurve.toFixed(2),s()}),N.addEventListener("input",()=>{a.resolution=Number(N.value),T.textContent=a.resolution.toFixed(2),s()}),k.addEventListener("input",()=>{a.greyScale=k.checked,s()}),f.addEventListener("click",()=>{t=e.generate(),i.reSeed(t),e.reSeed(t),r()}),r(),O("download").addEventListener("click",()=>{const x=document.getElementById("map-title")?.innerText||"Untitled Map",w=document.createElement("canvas"),R=60;w.width=c.width,w.height=c.height+R;const M=w.getContext("2d");if(!M)return;M.fillStyle="#dedede",M.fillRect(0,0,w.width,w.height),M.drawImage(c,0,R),M.font="bold 36px 'Roboto Mono', monospace",M.fillStyle="#000",M.textAlign="center",M.fillText(x,w.width/2,40);const v=document.createElement("a");v.download=`MAPINATOR_${x.replace(/\s+/g,"_")}.png`,v.href=w.toDataURL("image/png"),v.click()}),y.addEventListener("click",()=>{t=S.value.trim(),l(t)})});document.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("mobile-warning");if(!a)return;(/Mobi|Android|iPhone|iPad/i.test(navigator.userAgent)||window.innerWidth<768)&&(console.log("MOBILE"),a.classList.add("show"))});
