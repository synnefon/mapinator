(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}})();function Ft(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}function zt(d){if(Object.prototype.hasOwnProperty.call(d,"__esModule"))return d;var t=d.default;if(typeof t=="function"){var e=function i(){var r=!1;try{r=this instanceof i}catch{}return r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(d).forEach(function(i){var r=Object.getOwnPropertyDescriptor(d,i);Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:function(){return d[i]}})}),e}var it={exports:{}},$t=it.exports,pt;function qt(){return pt||(pt=1,(function(d){(function(t,e,i){function r(n){var c=this,u=o();c.next=function(){var l=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=l-(c.c=l|0)},c.c=1,c.s0=u(" "),c.s1=u(" "),c.s2=u(" "),c.s0-=u(n),c.s0<0&&(c.s0+=1),c.s1-=u(n),c.s1<0&&(c.s1+=1),c.s2-=u(n),c.s2<0&&(c.s2+=1),u=null}function s(n,c){return c.c=n.c,c.s0=n.s0,c.s1=n.s1,c.s2=n.s2,c}function a(n,c){var u=new r(n),l=c&&c.state,h=u.next;return h.int32=function(){return u.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,l&&(typeof l=="object"&&s(l,u),h.state=function(){return s(u,{})}),h}function o(){var n=4022871197,c=function(u){u=String(u);for(var l=0;l<u.length;l++){n+=u.charCodeAt(l);var h=.02519603282416938*n;n=h>>>0,h-=n,h*=n,n=h>>>0,h-=n,n+=h*4294967296}return(n>>>0)*23283064365386963e-26};return c}e&&e.exports?e.exports=a:this.alea=a})($t,d)})(it)),it.exports}var rt={exports:{}},Ut=rt.exports,yt;function Gt(){return yt||(yt=1,(function(d){(function(t,e,i){function r(o){var n=this,c="";n.x=0,n.y=0,n.z=0,n.w=0,n.next=function(){var l=n.x^n.x<<11;return n.x=n.y,n.y=n.z,n.z=n.w,n.w^=n.w>>>19^l^l>>>8},o===(o|0)?n.x=o:c+=o;for(var u=0;u<c.length+64;u++)n.x^=c.charCodeAt(u)|0,n.next()}function s(o,n){return n.x=o.x,n.y=o.y,n.z=o.z,n.w=o.w,n}function a(o,n){var c=new r(o),u=n&&n.state,l=function(){return(c.next()>>>0)/4294967296};return l.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,g=(h+f)/(1<<21);while(g===0);return g},l.int32=c.next,l.quick=l,u&&(typeof u=="object"&&s(u,c),l.state=function(){return s(c,{})}),l}e&&e.exports?e.exports=a:this.xor128=a})(Ut,d)})(rt)),rt.exports}var st={exports:{}},Xt=st.exports,_t;function Bt(){return _t||(_t=1,(function(d){(function(t,e,i){function r(o){var n=this,c="";n.next=function(){var l=n.x^n.x>>>2;return n.x=n.y,n.y=n.z,n.z=n.w,n.w=n.v,(n.d=n.d+362437|0)+(n.v=n.v^n.v<<4^(l^l<<1))|0},n.x=0,n.y=0,n.z=0,n.w=0,n.v=0,o===(o|0)?n.x=o:c+=o;for(var u=0;u<c.length+64;u++)n.x^=c.charCodeAt(u)|0,u==c.length&&(n.d=n.x<<10^n.x>>>4),n.next()}function s(o,n){return n.x=o.x,n.y=o.y,n.z=o.z,n.w=o.w,n.v=o.v,n.d=o.d,n}function a(o,n){var c=new r(o),u=n&&n.state,l=function(){return(c.next()>>>0)/4294967296};return l.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,g=(h+f)/(1<<21);while(g===0);return g},l.int32=c.next,l.quick=l,u&&(typeof u=="object"&&s(u,c),l.state=function(){return s(c,{})}),l}e&&e.exports?e.exports=a:this.xorwow=a})(Xt,d)})(st)),st.exports}var ot={exports:{}},Vt=ot.exports,vt;function Ht(){return vt||(vt=1,(function(d){(function(t,e,i){function r(o){var n=this;n.next=function(){var u=n.x,l=n.i,h,f;return h=u[l],h^=h>>>7,f=h^h<<24,h=u[l+1&7],f^=h^h>>>10,h=u[l+3&7],f^=h^h>>>3,h=u[l+4&7],f^=h^h<<7,h=u[l+7&7],h=h^h<<13,f^=h^h<<9,u[l]=f,n.i=l+1&7,f};function c(u,l){var h,f=[];if(l===(l|0))f[0]=l;else for(l=""+l,h=0;h<l.length;++h)f[h&7]=f[h&7]<<15^l.charCodeAt(h)+f[h+1&7]<<13;for(;f.length<8;)f.push(0);for(h=0;h<8&&f[h]===0;++h);for(h==8?f[7]=-1:f[h],u.x=f,u.i=0,h=256;h>0;--h)u.next()}c(n,o)}function s(o,n){return n.x=o.x.slice(),n.i=o.i,n}function a(o,n){o==null&&(o=+new Date);var c=new r(o),u=n&&n.state,l=function(){return(c.next()>>>0)/4294967296};return l.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,g=(h+f)/(1<<21);while(g===0);return g},l.int32=c.next,l.quick=l,u&&(u.x&&s(u,c),l.state=function(){return s(c,{})}),l}e&&e.exports?e.exports=a:this.xorshift7=a})(Vt,d)})(ot)),ot.exports}var at={exports:{}},Kt=at.exports,bt;function Yt(){return bt||(bt=1,(function(d){(function(t,e,i){function r(o){var n=this;n.next=function(){var u=n.w,l=n.X,h=n.i,f,g;return n.w=u=u+1640531527|0,g=l[h+34&127],f=l[h=h+1&127],g^=g<<13,f^=f<<17,g^=g>>>15,f^=f>>>12,g=l[h]=g^f,n.i=h,g+(u^u>>>16)|0};function c(u,l){var h,f,g,m,_,x=[],v=128;for(l===(l|0)?(f=l,l=null):(l=l+"\0",f=0,v=Math.max(v,l.length)),g=0,m=-32;m<v;++m)l&&(f^=l.charCodeAt((m+32)%l.length)),m===0&&(_=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,m>=0&&(_=_+1640531527|0,h=x[m&127]^=f+_,g=h==0?g+1:0);for(g>=128&&(x[(l&&l.length||0)&127]=-1),g=127,m=512;m>0;--m)f=x[g+34&127],h=x[g=g+1&127],f^=f<<13,h^=h<<17,f^=f>>>15,h^=h>>>12,x[g]=f^h;u.w=_,u.X=x,u.i=g}c(n,o)}function s(o,n){return n.i=o.i,n.w=o.w,n.X=o.X.slice(),n}function a(o,n){o==null&&(o=+new Date);var c=new r(o),u=n&&n.state,l=function(){return(c.next()>>>0)/4294967296};return l.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,g=(h+f)/(1<<21);while(g===0);return g},l.int32=c.next,l.quick=l,u&&(u.X&&s(u,c),l.state=function(){return s(c,{})}),l}e&&e.exports?e.exports=a:this.xor4096=a})(Kt,d)})(at)),at.exports}var lt={exports:{}},Wt=lt.exports,wt;function Qt(){return wt||(wt=1,(function(d){(function(t,e,i){function r(o){var n=this,c="";n.next=function(){var l=n.b,h=n.c,f=n.d,g=n.a;return l=l<<25^l>>>7^h,h=h-f|0,f=f<<24^f>>>8^g,g=g-l|0,n.b=l=l<<20^l>>>12^h,n.c=h=h-f|0,n.d=f<<16^h>>>16^g,n.a=g-l|0},n.a=0,n.b=0,n.c=-1640531527,n.d=1367130551,o===Math.floor(o)?(n.a=o/4294967296|0,n.b=o|0):c+=o;for(var u=0;u<c.length+20;u++)n.b^=c.charCodeAt(u)|0,n.next()}function s(o,n){return n.a=o.a,n.b=o.b,n.c=o.c,n.d=o.d,n}function a(o,n){var c=new r(o),u=n&&n.state,l=function(){return(c.next()>>>0)/4294967296};return l.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,g=(h+f)/(1<<21);while(g===0);return g},l.int32=c.next,l.quick=l,u&&(typeof u=="object"&&s(u,c),l.state=function(){return s(c,{})}),l}e&&e.exports?e.exports=a:this.tychei=a})(Wt,d)})(lt)),lt.exports}var ct={exports:{}};const Jt={},Zt=Object.freeze(Object.defineProperty({__proto__:null,default:Jt},Symbol.toStringTag,{value:"Module"})),te=zt(Zt);var ee=ct.exports,At;function ne(){return At||(At=1,(function(d){(function(t,e,i){var r=256,s=6,a=52,o="random",n=i.pow(r,s),c=i.pow(2,a),u=c*2,l=r-1,h;function f(b,w,M){var I=[];w=w==!0?{entropy:!0}:w||{};var E=x(_(w.entropy?[b,y(e)]:b??v(),3),I),p=new g(I),S=function(){for(var A=p.g(s),C=n,T=0;A<c;)A=(A+T)*r,C*=r,T=p.g(1);for(;A>=u;)A/=2,C/=2,T>>>=1;return(A+T)/C};return S.int32=function(){return p.g(4)|0},S.quick=function(){return p.g(4)/4294967296},S.double=S,x(y(p.S),e),(w.pass||M||function(A,C,T,k){return k&&(k.S&&m(k,p),A.state=function(){return m(p,{})}),T?(i[o]=A,C):A})(S,E,"global"in w?w.global:this==i,w.state)}function g(b){var w,M=b.length,I=this,E=0,p=I.i=I.j=0,S=I.S=[];for(M||(b=[M++]);E<r;)S[E]=E++;for(E=0;E<r;E++)S[E]=S[p=l&p+b[E%M]+(w=S[E])],S[p]=w;(I.g=function(A){for(var C,T=0,k=I.i,L=I.j,R=I.S;A--;)C=R[k=l&k+1],T=T*r+R[l&(R[k]=R[L=l&L+C])+(R[L]=C)];return I.i=k,I.j=L,T})(r)}function m(b,w){return w.i=b.i,w.j=b.j,w.S=b.S.slice(),w}function _(b,w){var M=[],I=typeof b,E;if(w&&I=="object")for(E in b)try{M.push(_(b[E],w-1))}catch{}return M.length?M:I=="string"?b:b+"\0"}function x(b,w){for(var M=b+"",I,E=0;E<M.length;)w[l&E]=l&(I^=w[l&E]*19)+M.charCodeAt(E++);return y(w)}function v(){try{var b;return h&&(b=h.randomBytes)?b=b(r):(b=new Uint8Array(r),(t.crypto||t.msCrypto).getRandomValues(b)),y(b)}catch{var w=t.navigator,M=w&&w.plugins;return[+new Date,t,M,t.screen,y(e)]}}function y(b){return String.fromCharCode.apply(0,b)}if(x(i.random(),e),d.exports){d.exports=f;try{h=te}catch{}}else i["seed"+o]=f})(typeof self<"u"?self:ee,[],Math)})(ct)),ct.exports}var ht,St;function ie(){if(St)return ht;St=1;var d=qt(),t=Gt(),e=Bt(),i=Ht(),r=Yt(),s=Qt(),a=ne();return a.alea=d,a.xor128=t,a.xorwow=e,a.xorshift7=i,a.xor4096=r,a.tychei=s,ht=a,ht}var re=ie();const Et=Ft(re),Dt=Math.sqrt(3),se=.5*(Dt-1),H=(3-Dt)/6,Ct=d=>Math.floor(d)|0,Mt=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function It(d=Math.random){const t=oe(d),e=new Float64Array(t).map(r=>Mt[r%12*2]),i=new Float64Array(t).map(r=>Mt[r%12*2+1]);return function(s,a){let o=0,n=0,c=0;const u=(s+a)*se,l=Ct(s+u),h=Ct(a+u),f=(l+h)*H,g=l-f,m=h-f,_=s-g,x=a-m;let v,y;_>x?(v=1,y=0):(v=0,y=1);const b=_-v+H,w=x-y+H,M=_-1+2*H,I=x-1+2*H,E=l&255,p=h&255;let S=.5-_*_-x*x;if(S>=0){const T=E+t[p],k=e[T],L=i[T];S*=S,o=S*S*(k*_+L*x)}let A=.5-b*b-w*w;if(A>=0){const T=E+v+t[p+y],k=e[T],L=i[T];A*=A,n=A*A*(k*b+L*w)}let C=.5-M*M-I*I;if(C>=0){const T=E+1+t[p+1],k=e[T],L=i[T];C*=C,c=C*C*(k*M+L*I)}return 70*(o+n+c)}}function oe(d){const e=new Uint8Array(512);for(let i=0;i<512/2;i++)e[i]=i;for(let i=0;i<512/2-1;i++){const r=i+~~(d()*(256-i)),s=e[i];e[i]=e[r],e[r]=s}for(let i=256;i<512;i++)e[i]=e[i-256];return e}const P={OCEAN:{color:"#44447a",name:"ocean"},BARREN_ROCK:{color:"#888888",name:"barren rock"},TUNDRA:{color:"#bbbbaa",name:"tundra"},GLACIER:{color:"#dddde4",name:"glacier"},TEMPERATE_DESERT:{color:"#c9d29b",name:"temperate desert"},SHRUBLAND:{color:"#889977",name:"shrubland"},TAIGA:{color:"#99aa77",name:"taiga"},GRASSLAND:{color:"#88aa55",name:"grassland"},DECIDUOUS_FOREST:{color:"#679459",name:"deciduous forest"},TEMPERATE_RAIN_FOREST:{color:"#448855",name:"rain forest"},SUBTROPICAL_DESERT:{color:"#d2b98b",name:"subtropical desert"},TROPICAL_SEASONAL_FOREST:{color:"#559944",name:"tropical seasonal forest"},TROPICAL_RAIN_FOREST:{color:"#337755",name:"tropical rain forest"}},ut=[.6,1],ft=[.4,.6],J=[.2,.4],Z=[0,.2],ae=[-1,0],tt=[{elevation:ut,moisture:[0,.2],biome:P.BARREN_ROCK},{elevation:ut,moisture:[.2,.5],biome:P.TUNDRA},{elevation:ut,moisture:[.5,1],biome:P.GLACIER},{elevation:ft,moisture:[0,.33],biome:P.TEMPERATE_DESERT},{elevation:ft,moisture:[.33,.66],biome:P.SHRUBLAND},{elevation:ft,moisture:[.66,1],biome:P.TAIGA},{elevation:J,moisture:[0,.16],biome:P.TEMPERATE_DESERT},{elevation:J,moisture:[.16,.5],biome:P.GRASSLAND},{elevation:J,moisture:[.5,.83],biome:P.DECIDUOUS_FOREST},{elevation:J,moisture:[.83,1],biome:P.TEMPERATE_RAIN_FOREST},{elevation:Z,moisture:[0,.16],biome:P.SUBTROPICAL_DESERT},{elevation:Z,moisture:[.16,.33],biome:P.GRASSLAND},{elevation:Z,moisture:[.33,.66],biome:P.TROPICAL_SEASONAL_FOREST},{elevation:Z,moisture:[.66,1],biome:P.TROPICAL_RAIN_FOREST},{elevation:ae,moisture:[0,1],biome:P.OCEAN}];class le{rainfall;seaLevel;constructor(t,e){if(t<0||t>1||e<0||e>1)throw Error("rainfall & seaLevel must be 0-1");t=this.expCurve(1-t,4.1),this.rainfall=Math.max(.01,t*25),this.seaLevel=2*(e-.5)}getBiome(t,e){let i=2*(t-.5)-(this.seaLevel-.1),r=e**this.rainfall;i=Math.max(Math.min(i,1-this.EPS),-1),r=Math.max(Math.min(r,1-this.EPS),-1);const s=this.findLastIndex(tt,(a,o,n)=>this.matchesRule(a,i,r));return tt[s]?.biome||{color:"#ff008cff",name:"fallback"}}isOcean(t){const e=this.findLastIndex(tt,r=>r.biome.name===P.OCEAN.name);return tt[e].elevation[1]>=t}expCurve(t,e){const i=Math.max(0,Math.min(1,t));return(Math.exp(e*i)-1)/(Math.exp(e)-1)}matchesRule(t,e,i){return t.elevation[0]<=e&&t.elevation[1]>e&&t.moisture[0]<=i&&t.moisture[1]>i}EPS=1e-9;findLastIndex(t,e){for(let i=t.length-1;i>=0;i--)if(e(t[i],i,t))return i;return-1}}const q=11102230246251565e-32,j=134217729,ce=(3+8*q)*q;function dt(d,t,e,i,r){let s,a,o,n,c=t[0],u=i[0],l=0,h=0;u>c==u>-c?(s=c,c=t[++l]):(s=u,u=i[++h]);let f=0;if(l<d&&h<e)for(u>c==u>-c?(a=c+s,o=s-(a-c),c=t[++l]):(a=u+s,o=s-(a-u),u=i[++h]),s=a,o!==0&&(r[f++]=o);l<d&&h<e;)u>c==u>-c?(a=s+c,n=a-s,o=s-(a-n)+(c-n),c=t[++l]):(a=s+u,n=a-s,o=s-(a-n)+(u-n),u=i[++h]),s=a,o!==0&&(r[f++]=o);for(;l<d;)a=s+c,n=a-s,o=s-(a-n)+(c-n),c=t[++l],s=a,o!==0&&(r[f++]=o);for(;h<e;)a=s+u,n=a-s,o=s-(a-n)+(u-n),u=i[++h],s=a,o!==0&&(r[f++]=o);return(s!==0||f===0)&&(r[f++]=s),f}function he(d,t){let e=t[0];for(let i=1;i<d;i++)e+=t[i];return e}function Q(d){return new Float64Array(d)}const ue=(3+16*q)*q,fe=(2+12*q)*q,de=(9+64*q)*q*q,X=Q(4),Tt=Q(8),Rt=Q(12),kt=Q(16),F=Q(4);function ge(d,t,e,i,r,s,a){let o,n,c,u,l,h,f,g,m,_,x,v,y,b,w,M,I,E;const p=d-r,S=e-r,A=t-s,C=i-s;b=p*C,h=j*p,f=h-(h-p),g=p-f,h=j*C,m=h-(h-C),_=C-m,w=g*_-(b-f*m-g*m-f*_),M=A*S,h=j*A,f=h-(h-A),g=A-f,h=j*S,m=h-(h-S),_=S-m,I=g*_-(M-f*m-g*m-f*_),x=w-I,l=w-x,X[0]=w-(x+l)+(l-I),v=b+x,l=v-b,y=b-(v-l)+(x-l),x=y-M,l=y-x,X[1]=y-(x+l)+(l-M),E=v+x,l=E-v,X[2]=v-(E-l)+(x-l),X[3]=E;let T=he(4,X),k=fe*a;if(T>=k||-T>=k||(l=d-p,o=d-(p+l)+(l-r),l=e-S,c=e-(S+l)+(l-r),l=t-A,n=t-(A+l)+(l-s),l=i-C,u=i-(C+l)+(l-s),o===0&&n===0&&c===0&&u===0)||(k=de*a+ce*Math.abs(T),T+=p*u+C*o-(A*c+S*n),T>=k||-T>=k))return T;b=o*C,h=j*o,f=h-(h-o),g=o-f,h=j*C,m=h-(h-C),_=C-m,w=g*_-(b-f*m-g*m-f*_),M=n*S,h=j*n,f=h-(h-n),g=n-f,h=j*S,m=h-(h-S),_=S-m,I=g*_-(M-f*m-g*m-f*_),x=w-I,l=w-x,F[0]=w-(x+l)+(l-I),v=b+x,l=v-b,y=b-(v-l)+(x-l),x=y-M,l=y-x,F[1]=y-(x+l)+(l-M),E=v+x,l=E-v,F[2]=v-(E-l)+(x-l),F[3]=E;const L=dt(4,X,4,F,Tt);b=p*u,h=j*p,f=h-(h-p),g=p-f,h=j*u,m=h-(h-u),_=u-m,w=g*_-(b-f*m-g*m-f*_),M=A*c,h=j*A,f=h-(h-A),g=A-f,h=j*c,m=h-(h-c),_=c-m,I=g*_-(M-f*m-g*m-f*_),x=w-I,l=w-x,F[0]=w-(x+l)+(l-I),v=b+x,l=v-b,y=b-(v-l)+(x-l),x=y-M,l=y-x,F[1]=y-(x+l)+(l-M),E=v+x,l=E-v,F[2]=v-(E-l)+(x-l),F[3]=E;const R=dt(L,Tt,4,F,Rt);b=o*u,h=j*o,f=h-(h-o),g=o-f,h=j*u,m=h-(h-u),_=u-m,w=g*_-(b-f*m-g*m-f*_),M=n*c,h=j*n,f=h-(h-n),g=n-f,h=j*c,m=h-(h-c),_=c-m,I=g*_-(M-f*m-g*m-f*_),x=w-I,l=w-x,F[0]=w-(x+l)+(l-I),v=b+x,l=v-b,y=b-(v-l)+(x-l),x=y-M,l=y-x,F[1]=y-(x+l)+(l-M),E=v+x,l=E-v,F[2]=v-(E-l)+(x-l),F[3]=E;const O=dt(R,Rt,4,F,kt);return kt[O-1]}function et(d,t,e,i,r,s){const a=(t-s)*(e-r),o=(d-r)*(i-s),n=a-o,c=Math.abs(a+o);return Math.abs(n)>=ue*c?n:-ge(d,t,e,i,r,s,c)}const Lt=Math.pow(2,-52),nt=new Uint32Array(512);class W{static from(t,e=_e,i=ve){const r=t.length,s=new Float64Array(r*2);for(let a=0;a<r;a++){const o=t[a];s[2*a]=e(o),s[2*a+1]=i(o)}return new W(s)}constructor(t){const e=t.length>>1;if(e>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const i=Math.max(2*e-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:i,_hullTri:r,_hullHash:s}=this,a=t.length>>1;let o=1/0,n=1/0,c=-1/0,u=-1/0;for(let p=0;p<a;p++){const S=t[2*p],A=t[2*p+1];S<o&&(o=S),A<n&&(n=A),S>c&&(c=S),A>u&&(u=A),this._ids[p]=p}const l=(o+c)/2,h=(n+u)/2;let f,g,m;for(let p=0,S=1/0;p<a;p++){const A=gt(l,h,t[2*p],t[2*p+1]);A<S&&(f=p,S=A)}const _=t[2*f],x=t[2*f+1];for(let p=0,S=1/0;p<a;p++){if(p===f)continue;const A=gt(_,x,t[2*p],t[2*p+1]);A<S&&A>0&&(g=p,S=A)}let v=t[2*g],y=t[2*g+1],b=1/0;for(let p=0;p<a;p++){if(p===f||p===g)continue;const S=pe(_,x,v,y,t[2*p],t[2*p+1]);S<b&&(m=p,b=S)}let w=t[2*m],M=t[2*m+1];if(b===1/0){for(let A=0;A<a;A++)this._dists[A]=t[2*A]-t[0]||t[2*A+1]-t[1];V(this._ids,this._dists,0,a-1);const p=new Uint32Array(a);let S=0;for(let A=0,C=-1/0;A<a;A++){const T=this._ids[A],k=this._dists[T];k>C&&(p[S++]=T,C=k)}this.hull=p.subarray(0,S),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(et(_,x,v,y,w,M)<0){const p=g,S=v,A=y;g=m,v=w,y=M,m=p,w=S,M=A}const I=ye(_,x,v,y,w,M);this._cx=I.x,this._cy=I.y;for(let p=0;p<a;p++)this._dists[p]=gt(t[2*p],t[2*p+1],I.x,I.y);V(this._ids,this._dists,0,a-1),this._hullStart=f;let E=3;i[f]=e[m]=g,i[g]=e[f]=m,i[m]=e[g]=f,r[f]=0,r[g]=1,r[m]=2,s.fill(-1),s[this._hashKey(_,x)]=f,s[this._hashKey(v,y)]=g,s[this._hashKey(w,M)]=m,this.trianglesLen=0,this._addTriangle(f,g,m,-1,-1,-1);for(let p=0,S,A;p<this._ids.length;p++){const C=this._ids[p],T=t[2*C],k=t[2*C+1];if(p>0&&Math.abs(T-S)<=Lt&&Math.abs(k-A)<=Lt||(S=T,A=k,C===f||C===g||C===m))continue;let L=0;for(let G=0,Pt=this._hashKey(T,k);G<this._hashSize&&(L=s[(Pt+G)%this._hashSize],!(L!==-1&&L!==i[L]));G++);L=e[L];let R=L,O;for(;O=i[R],et(T,k,t[2*R],t[2*R+1],t[2*O],t[2*O+1])>=0;)if(R=O,R===L){R=-1;break}if(R===-1)continue;let z=this._addTriangle(R,C,i[R],-1,-1,r[R]);r[C]=this._legalize(z+2),r[R]=z,E++;let N=i[R];for(;O=i[N],et(T,k,t[2*N],t[2*N+1],t[2*O],t[2*O+1])<0;)z=this._addTriangle(N,C,O,r[C],-1,r[N]),r[C]=this._legalize(z+2),i[N]=N,E--,N=O;if(R===L)for(;O=e[R],et(T,k,t[2*O],t[2*O+1],t[2*R],t[2*R+1])<0;)z=this._addTriangle(O,C,R,-1,r[R],r[O]),this._legalize(z+2),r[O]=z,i[R]=R,E--,R=O;this._hullStart=e[C]=R,i[R]=e[N]=C,i[C]=N,s[this._hashKey(T,k)]=C,s[this._hashKey(t[2*R],t[2*R+1])]=R}this.hull=new Uint32Array(E);for(let p=0,S=this._hullStart;p<E;p++)this.hull[p]=S,S=i[S];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(me(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:i,coords:r}=this;let s=0,a=0;for(;;){const o=i[t],n=t-t%3;if(a=n+(t+2)%3,o===-1){if(s===0)break;t=nt[--s];continue}const c=o-o%3,u=n+(t+1)%3,l=c+(o+2)%3,h=e[a],f=e[t],g=e[u],m=e[l];if(xe(r[2*h],r[2*h+1],r[2*f],r[2*f+1],r[2*g],r[2*g+1],r[2*m],r[2*m+1])){e[t]=m,e[o]=h;const x=i[l];if(x===-1){let y=this._hullStart;do{if(this._hullTri[y]===l){this._hullTri[y]=t;break}y=this._hullPrev[y]}while(y!==this._hullStart)}this._link(t,x),this._link(o,i[a]),this._link(a,l);const v=c+(o+1)%3;s<nt.length&&(nt[s++]=v)}else{if(s===0)break;t=nt[--s]}}return a}_link(t,e){this._halfedges[t]=e,e!==-1&&(this._halfedges[e]=t)}_addTriangle(t,e,i,r,s,a){const o=this.trianglesLen;return this._triangles[o]=t,this._triangles[o+1]=e,this._triangles[o+2]=i,this._link(o,r),this._link(o+1,s),this._link(o+2,a),this.trianglesLen+=3,o}}function me(d,t){const e=d/(Math.abs(d)+Math.abs(t));return(t>0?3-e:1+e)/4}function gt(d,t,e,i){const r=d-e,s=t-i;return r*r+s*s}function xe(d,t,e,i,r,s,a,o){const n=d-a,c=t-o,u=e-a,l=i-o,h=r-a,f=s-o,g=n*n+c*c,m=u*u+l*l,_=h*h+f*f;return n*(l*_-m*f)-c*(u*_-m*h)+g*(u*f-l*h)<0}function pe(d,t,e,i,r,s){const a=e-d,o=i-t,n=r-d,c=s-t,u=a*a+o*o,l=n*n+c*c,h=.5/(a*c-o*n),f=(c*u-o*l)*h,g=(a*l-n*u)*h;return f*f+g*g}function ye(d,t,e,i,r,s){const a=e-d,o=i-t,n=r-d,c=s-t,u=a*a+o*o,l=n*n+c*c,h=.5/(a*c-o*n),f=d+(c*u-o*l)*h,g=t+(a*l-n*u)*h;return{x:f,y:g}}function V(d,t,e,i){if(i-e<=20)for(let r=e+1;r<=i;r++){const s=d[r],a=t[s];let o=r-1;for(;o>=e&&t[d[o]]>a;)d[o+1]=d[o--];d[o+1]=s}else{const r=e+i>>1;let s=e+1,a=i;K(d,r,s),t[d[e]]>t[d[i]]&&K(d,e,i),t[d[s]]>t[d[i]]&&K(d,s,i),t[d[e]]>t[d[s]]&&K(d,e,s);const o=d[s],n=t[o];for(;;){do s++;while(t[d[s]]<n);do a--;while(t[d[a]]>n);if(a<s)break;K(d,s,a)}d[e+1]=d[a],d[a]=o,i-s+1>=a-e?(V(d,t,s,i),V(d,t,e,a-1)):(V(d,t,e,a-1),V(d,t,s,i))}}function K(d,t,e){const i=d[t];d[t]=d[e],d[e]=i}function _e(d){return d[0]}function ve(d){return d[1]}class be{nextHalfedge(t){return t%3===2?t-2:t+1}triOfEdge(t){return Math.floor(t/3)}buildInedges(t,e){const i=new Int32Array(e).fill(-1),{triangles:r}=t;for(let s=0;s<r.length;s++)i[r[s]]=s;return i}halfedgesAroundSite(t,e,i){const{triangles:r,halfedges:s}=t;let a=e[i];if(a===-1)return null;const o=[];let n=a;do{o.push(n);const c=this.nextHalfedge(n),u=s[c];if(u===-1)return null;n=u,r[n]!==i&&(n=this.nextHalfedge(n),r[n]!==i&&(n=this.nextHalfedge(n)))}while(n!==a);return o}circumcenterOfTri(t,e,i){const{triangles:r}=i,s=t[r[3*e+0]],a=t[r[3*e+1]],o=t[r[3*e+2]],n=s.x*s.x+s.y*s.y,c=a.x*a.x+a.y*a.y,u=o.x*o.x+o.y*o.y,l=2*(s.x*(a.y-o.y)+a.x*(o.y-s.y)+o.x*(s.y-a.y));if(Math.abs(l)<1e-12)return{x:(s.x+a.x+o.x)/3,y:(s.y+a.y+o.y)/3};const h=(n*(a.y-o.y)+c*(o.y-s.y)+u*(s.y-a.y))/l,f=(n*(o.x-a.x)+c*(s.x-o.x)+u*(a.x-s.x))/l;return{x:h,y:f}}polygonCentroid(t,e){let i=0,r=0,s=0;const a=t.length;for(let n=0,c=a-1;n<a;c=n++){const u=t[n].x,l=t[n].y,h=t[c].x,f=t[c].y,g=h*l-u*f;i+=g,r+=(h+u)*g,s+=(f+l)*g}if(Math.abs(i)<1e-12)return e;const o=i/2;return{x:r/(6*o),y:s/(6*o)}}relaxOnce(t){const e=W.from(t,s=>s.x,s=>s.y),i=this.buildInedges(e,t.length),r=new Array(t.length);for(let s=0;s<t.length;s++){const a=this.halfedgesAroundSite(e,i,s);if(!a){r[s]=t[s];continue}const o=a.map(n=>this.circumcenterOfTri(t,this.triOfEdge(n),e));r[s]=this.polygonCentroid(o,t[s])}return{centers:r,delaunay:e}}relaxPoints(t,e){let i=t,r;for(let s=0;s<e;s++){const{centers:a,delaunay:o}=this.relaxOnce(i);i=a,r=o}if(!r)throw new Error("iterations wrong");return{centers:i,delaunay:r}}initPoints(t,e){const i=[];for(let r=0;r<t;r++)for(let s=0;s<t;s++){const a=r+e*(Math.random()-Math.random()),o=s+e*(Math.random()-Math.random());i.push({x:a,y:o})}return i}genPoints(t){const{resolution:e,jitter:i}=t,r=this.initPoints(e,i),{centers:s,delaunay:a}=this.relaxPoints(r,4);return{centers:s,delaunay:a}}}class we{noise2D;pointGenerator;constructor(){const t=Et("my-seed-"+Date.now());this.noise2D=It(t),this.pointGenerator=new be}reSeed(){const t=Et("my-seed-"+Date.now());this.noise2D=It(t)}generateMap(t){const{resolution:e}=t,{centers:i,delaunay:r}=this.pointGenerator.genPoints(t),s={points:i,resolution:e,numRegions:i.length,numTriangles:r.halfedges.length/3,numEdges:r.halfedges.length,halfedges:r.halfedges,triangles:r.triangles},a=this.genElevations(s,t),o=this.genMoistures(s,t),n=this.calcBiomes(s,a,o,t);return{...s,elevations:a,moistures:o,biomes:n}}calcBiomes(t,e,i,r){const{numRegions:s}=t,a=new le(r.rainfall,r.seaLevel),o=[];for(let n=0;n<s;n++)o.push(a.getBiome(e[n],i[n]));return o}genMoistures(t,e){const{wavelength:i}=e,{points:r,numRegions:s}=t;let a=[];for(let o=0;o<s;o++){const n=r[o].x/t.resolution-.5,c=r[o].y/t.resolution-1/2,u=(1+this.noise2D(n/i,c/i))/2;a[o]=Math.max(0,Math.min(1,u))}return a}genElevations(t,e){const{wavelength:i,edgeCurve:r}=e,s=1-e.shatter,a=.5,n=a+(3-a)*r,{points:c,numRegions:u,resolution:l}=t,h=new Array(u),f=m=>m<0?0:m>1?1:m,g=(m,_,x)=>m+(_-m)*x;for(let m=0;m<u;m++){const _=c[m].x/l-.5,x=c[m].y/l-.5;let v=1/3+this.noise2D(_/i,x/i)/2+this.noise2D(2*_/i,2*x/i)/3,y=2*Math.max(Math.abs(_),Math.abs(x));y=Math.pow(y,n);const b=(1+v-y)/2;v=g(v,b,f(s)),h[m]=f(v)}return h}}const Ot=1e-6;class U{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,e){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,e){this._+=`L${this._x1=+t},${this._y1=+e}`}arc(t,e,i){t=+t,e=+e,i=+i;const r=t+i,s=e;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${r},${s}`:(Math.abs(this._x1-r)>Ot||Math.abs(this._y1-s)>Ot)&&(this._+="L"+r+","+s),i&&(this._+=`A${i},${i},0,1,1,${t-i},${e}A${i},${i},0,1,1,${this._x1=r},${this._y1=s}`)}rect(t,e,i,r){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${+i}v${+r}h${-i}Z`}value(){return this._||null}}class mt{constructor(){this._=[]}moveTo(t,e){this._.push([t,e])}closePath(){this._.push(this._[0].slice())}lineTo(t,e){this._.push([t,e])}value(){return this._.length?this._:null}}class Ae{constructor(t,[e,i,r,s]=[0,0,960,500]){if(!((r=+r)>=(e=+e))||!((s=+s)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=r,this.xmin=e,this.ymax=s,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:e,triangles:i},vectors:r}=this;let s,a;const o=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let m=0,_=0,x=i.length,v,y;m<x;m+=3,_+=2){const b=i[m]*2,w=i[m+1]*2,M=i[m+2]*2,I=t[b],E=t[b+1],p=t[w],S=t[w+1],A=t[M],C=t[M+1],T=p-I,k=S-E,L=A-I,R=C-E,O=(T*R-k*L)*2;if(Math.abs(O)<1e-9){if(s===void 0){s=a=0;for(const N of e)s+=t[N*2],a+=t[N*2+1];s/=e.length,a/=e.length}const z=1e9*Math.sign((s-I)*R-(a-E)*L);v=(I+A)/2-z*R,y=(E+C)/2+z*L}else{const z=1/O,N=T*T+k*k,G=L*L+R*R;v=I+(R*N-k*G)*z,y=E+(T*G-L*N)*z}o[_]=v,o[_+1]=y}let n=e[e.length-1],c,u=n*4,l,h=t[2*n],f,g=t[2*n+1];r.fill(0);for(let m=0;m<e.length;++m)n=e[m],c=u,l=h,f=g,u=n*4,h=t[2*n],g=t[2*n+1],r[c+2]=r[u]=f-g,r[c+3]=r[u+1]=h-l}render(t){const e=t==null?t=new U:void 0,{delaunay:{halfedges:i,inedges:r,hull:s},circumcenters:a,vectors:o}=this;if(s.length<=1)return null;for(let u=0,l=i.length;u<l;++u){const h=i[u];if(h<u)continue;const f=Math.floor(u/3)*2,g=Math.floor(h/3)*2,m=a[f],_=a[f+1],x=a[g],v=a[g+1];this._renderSegment(m,_,x,v,t)}let n,c=s[s.length-1];for(let u=0;u<s.length;++u){n=c,c=s[u];const l=Math.floor(r[c]/3)*2,h=a[l],f=a[l+1],g=n*4,m=this._project(h,f,o[g+2],o[g+3]);m&&this._renderSegment(h,f,m[0],m[1],t)}return e&&e.value()}renderBounds(t){const e=t==null?t=new U:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),e&&e.value()}renderCell(t,e){const i=e==null?e=new U:void 0,r=this._clip(t);if(r===null||!r.length)return;e.moveTo(r[0],r[1]);let s=r.length;for(;r[0]===r[s-2]&&r[1]===r[s-1]&&s>1;)s-=2;for(let a=2;a<s;a+=2)(r[a]!==r[a-2]||r[a+1]!==r[a-1])&&e.lineTo(r[a],r[a+1]);return e.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,i=t.length/2;e<i;++e){const r=this.cellPolygon(e);r&&(r.index=e,yield r)}}cellPolygon(t){const e=new mt;return this.renderCell(t,e),e.value()}_renderSegment(t,e,i,r,s){let a;const o=this._regioncode(t,e),n=this._regioncode(i,r);o===0&&n===0?(s.moveTo(t,e),s.lineTo(i,r)):(a=this._clipSegment(t,e,i,r,o,n))&&(s.moveTo(a[0],a[1]),s.lineTo(a[2],a[3]))}contains(t,e,i){return e=+e,e!==e||(i=+i,i!==i)?!1:this.delaunay._step(t,e,i)===t}*neighbors(t){const e=this._clip(t);if(e)for(const i of this.delaunay.neighbors(t)){const r=this._clip(i);if(r){t:for(let s=0,a=e.length;s<a;s+=2)for(let o=0,n=r.length;o<n;o+=2)if(e[s]===r[o]&&e[s+1]===r[o+1]&&e[(s+2)%a]===r[(o+n-2)%n]&&e[(s+3)%a]===r[(o+n-1)%n]){yield i;break t}}}}_cell(t){const{circumcenters:e,delaunay:{inedges:i,halfedges:r,triangles:s}}=this,a=i[t];if(a===-1)return null;const o=[];let n=a;do{const c=Math.floor(n/3);if(o.push(e[c*2],e[c*2+1]),n=n%3===2?n-2:n+1,s[n]!==t)break;n=r[n]}while(n!==a&&n!==-1);return o}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(t);if(e===null)return null;const{vectors:i}=this,r=t*4;return this._simplify(i[r]||i[r+1]?this._clipInfinite(t,e,i[r],i[r+1],i[r+2],i[r+3]):this._clipFinite(t,e))}_clipFinite(t,e){const i=e.length;let r=null,s,a,o=e[i-2],n=e[i-1],c,u=this._regioncode(o,n),l,h=0;for(let f=0;f<i;f+=2)if(s=o,a=n,o=e[f],n=e[f+1],c=u,u=this._regioncode(o,n),c===0&&u===0)l=h,h=0,r?r.push(o,n):r=[o,n];else{let g,m,_,x,v;if(c===0){if((g=this._clipSegment(s,a,o,n,c,u))===null)continue;[m,_,x,v]=g}else{if((g=this._clipSegment(o,n,s,a,u,c))===null)continue;[x,v,m,_]=g,l=h,h=this._edgecode(m,_),l&&h&&this._edge(t,l,h,r,r.length),r?r.push(m,_):r=[m,_]}l=h,h=this._edgecode(x,v),l&&h&&this._edge(t,l,h,r,r.length),r?r.push(x,v):r=[x,v]}if(r)l=h,h=this._edgecode(r[0],r[1]),l&&h&&this._edge(t,l,h,r,r.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return r}_clipSegment(t,e,i,r,s,a){const o=s<a;for(o&&([t,e,i,r,s,a]=[i,r,t,e,a,s]);;){if(s===0&&a===0)return o?[i,r,t,e]:[t,e,i,r];if(s&a)return null;let n,c,u=s||a;u&8?(n=t+(i-t)*(this.ymax-e)/(r-e),c=this.ymax):u&4?(n=t+(i-t)*(this.ymin-e)/(r-e),c=this.ymin):u&2?(c=e+(r-e)*(this.xmax-t)/(i-t),n=this.xmax):(c=e+(r-e)*(this.xmin-t)/(i-t),n=this.xmin),s?(t=n,e=c,s=this._regioncode(t,e)):(i=n,r=c,a=this._regioncode(i,r))}}_clipInfinite(t,e,i,r,s,a){let o=Array.from(e),n;if((n=this._project(o[0],o[1],i,r))&&o.unshift(n[0],n[1]),(n=this._project(o[o.length-2],o[o.length-1],s,a))&&o.push(n[0],n[1]),o=this._clipFinite(t,o))for(let c=0,u=o.length,l,h=this._edgecode(o[u-2],o[u-1]);c<u;c+=2)l=h,h=this._edgecode(o[c],o[c+1]),l&&h&&(c=this._edge(t,l,h,o,c),u=o.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return o}_edge(t,e,i,r,s){for(;e!==i;){let a,o;switch(e){case 5:e=4;continue;case 4:e=6,a=this.xmax,o=this.ymin;break;case 6:e=2;continue;case 2:e=10,a=this.xmax,o=this.ymax;break;case 10:e=8;continue;case 8:e=9,a=this.xmin,o=this.ymax;break;case 9:e=1;continue;case 1:e=5,a=this.xmin,o=this.ymin;break}(r[s]!==a||r[s+1]!==o)&&this.contains(t,a,o)&&(r.splice(s,0,a,o),s+=2)}return s}_project(t,e,i,r){let s=1/0,a,o,n;if(r<0){if(e<=this.ymin)return null;(a=(this.ymin-e)/r)<s&&(n=this.ymin,o=t+(s=a)*i)}else if(r>0){if(e>=this.ymax)return null;(a=(this.ymax-e)/r)<s&&(n=this.ymax,o=t+(s=a)*i)}if(i>0){if(t>=this.xmax)return null;(a=(this.xmax-t)/i)<s&&(o=this.xmax,n=e+(s=a)*r)}else if(i<0){if(t<=this.xmin)return null;(a=(this.xmin-t)/i)<s&&(o=this.xmin,n=e+(s=a)*r)}return[o,n]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}_simplify(t){if(t&&t.length>4){for(let e=0;e<t.length;e+=2){const i=(e+2)%t.length,r=(e+4)%t.length;(t[e]===t[i]&&t[i]===t[r]||t[e+1]===t[i+1]&&t[i+1]===t[r+1])&&(t.splice(i,2),e-=2)}t.length||(t=null)}return t}}const Se=2*Math.PI,B=Math.pow;function Ee(d){return d[0]}function Ce(d){return d[1]}function Me(d){const{triangles:t,coords:e}=d;for(let i=0;i<t.length;i+=3){const r=2*t[i],s=2*t[i+1],a=2*t[i+2];if((e[a]-e[r])*(e[s+1]-e[r+1])-(e[s]-e[r])*(e[a+1]-e[r+1])>1e-10)return!1}return!0}function Ie(d,t,e){return[d+Math.sin(d+t)*e,t+Math.cos(d-t)*e]}class xt{static from(t,e=Ee,i=Ce,r){return new xt("length"in t?Te(t,e,i,r):Float64Array.from(Re(t,e,i,r)))}constructor(t){this._delaunator=new W(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,e=this.points;if(t.hull&&t.hull.length>2&&Me(t)){this.collinear=Int32Array.from({length:e.length/2},(h,f)=>f).sort((h,f)=>e[2*h]-e[2*f]||e[2*h+1]-e[2*f+1]);const n=this.collinear[0],c=this.collinear[this.collinear.length-1],u=[e[2*n],e[2*n+1],e[2*c],e[2*c+1]],l=1e-8*Math.hypot(u[3]-u[1],u[2]-u[0]);for(let h=0,f=e.length/2;h<f;++h){const g=Ie(e[2*h],e[2*h+1],l);e[2*h]=g[0],e[2*h+1]=g[1]}this._delaunator=new W(e)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let n=0,c=i.length;n<c;++n){const u=s[n%3===2?n-2:n+1];(i[n]===-1||a[u]===-1)&&(a[u]=n)}for(let n=0,c=r.length;n<c;++n)o[r[n]]=n;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],a[r[0]]=1,r.length===2&&(a[r[1]]=0,this.triangles[1]=r[1],this.triangles[2]=r[1]))}voronoi(t){return new Ae(this,t)}*neighbors(t){const{inedges:e,hull:i,_hullIndex:r,halfedges:s,triangles:a,collinear:o}=this;if(o){const l=o.indexOf(t);l>0&&(yield o[l-1]),l<o.length-1&&(yield o[l+1]);return}const n=e[t];if(n===-1)return;let c=n,u=-1;do{if(yield u=a[c],c=c%3===2?c-2:c+1,a[c]!==t)return;if(c=s[c],c===-1){const l=i[(r[t]+1)%i.length];l!==u&&(yield l);return}}while(c!==n)}find(t,e,i=0){if(t=+t,t!==t||(e=+e,e!==e))return-1;const r=i;let s;for(;(s=this._step(i,t,e))>=0&&s!==i&&s!==r;)i=s;return s}_step(t,e,i){const{inedges:r,hull:s,_hullIndex:a,halfedges:o,triangles:n,points:c}=this;if(r[t]===-1||!c.length)return(t+1)%(c.length>>1);let u=t,l=B(e-c[t*2],2)+B(i-c[t*2+1],2);const h=r[t];let f=h;do{let g=n[f];const m=B(e-c[g*2],2)+B(i-c[g*2+1],2);if(m<l&&(l=m,u=g),f=f%3===2?f-2:f+1,n[f]!==t)break;if(f=o[f],f===-1){if(f=s[(a[t]+1)%s.length],f!==g&&B(e-c[f*2],2)+B(i-c[f*2+1],2)<l)return f;break}}while(f!==h);return u}render(t){const e=t==null?t=new U:void 0,{points:i,halfedges:r,triangles:s}=this;for(let a=0,o=r.length;a<o;++a){const n=r[a];if(n<a)continue;const c=s[a]*2,u=s[n]*2;t.moveTo(i[c],i[c+1]),t.lineTo(i[u],i[u+1])}return this.renderHull(t),e&&e.value()}renderPoints(t,e){e===void 0&&(!t||typeof t.moveTo!="function")&&(e=t,t=null),e=e==null?2:+e;const i=t==null?t=new U:void 0,{points:r}=this;for(let s=0,a=r.length;s<a;s+=2){const o=r[s],n=r[s+1];t.moveTo(o+e,n),t.arc(o,n,e,0,Se)}return i&&i.value()}renderHull(t){const e=t==null?t=new U:void 0,{hull:i,points:r}=this,s=i[0]*2,a=i.length;t.moveTo(r[s],r[s+1]);for(let o=1;o<a;++o){const n=2*i[o];t.lineTo(r[n],r[n+1])}return t.closePath(),e&&e.value()}hullPolygon(){const t=new mt;return this.renderHull(t),t.value()}renderTriangle(t,e){const i=e==null?e=new U:void 0,{points:r,triangles:s}=this,a=s[t*=3]*2,o=s[t+1]*2,n=s[t+2]*2;return e.moveTo(r[a],r[a+1]),e.lineTo(r[o],r[o+1]),e.lineTo(r[n],r[n+1]),e.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,i=t.length/3;e<i;++e)yield this.trianglePolygon(e)}trianglePolygon(t){const e=new mt;return this.renderTriangle(t,e),e.value()}}function Te(d,t,e,i){const r=d.length,s=new Float64Array(r*2);for(let a=0;a<r;++a){const o=d[a];s[a*2]=t.call(i,o,a,d),s[a*2+1]=e.call(i,o,a,d)}return s}function*Re(d,t,e,i){let r=0;for(const s of d)yield t.call(i,s,r,d),yield e.call(i,s,r,d),++r}class ke{drawCellColors(t,e){const i=t.getContext("2d");if(!i)return;const{resolution:r,points:s,biomes:a}=e;i.clearRect(0,0,t.width,t.height),i.save(),i.scale(t.width/r,t.height/r);const n=xt.from(s,c=>c.x,c=>c.y).voronoi([0,0,r,r]);for(let c=0;c<s.length;c++){const u=n.cellPolygon(c);if(!u||u.length<3)continue;i.beginPath(),i.moveTo(u[0][0],u[0][1]);for(let h=1;h<u.length;h++)i.lineTo(u[h][0],u[h][1]);i.closePath();const l=a[c].color;i.fillStyle=l,i.fill(),i.strokeStyle=l,i.lineWidth=.05,i.lineJoin="round",i.miterLimit=2,i.stroke()}i.restore()}}var $=(d=>(d.ROMANCE="romance",d.GERMANIC="germanic",d.SLAVIC="slavic",d.TURKIC="turkic",d.SEMITIC="semitic",d.BANTU_LIKE="bantu_like",d.AFRICAN_WEST="african_west",d.AFRICAN_HORN="african_horn",d.EAST_ASIAN_CN="east_asian_cn",d.EAST_ASIAN_JP="east_asian_jp",d.EAST_ASIAN_KR="east_asian_kr",d.POLYNESIAN="polynesian",d))($||{});const Nt=["a","e","i","o","u"],Le=["ai","au","ei","ia","io","oa","ue","ui"],Oe=["a","e","i","o","u","ia","io","ie","ea"],Ne=["a","i","u","aa","ii","uu","ai","au"],jt={romance:{onsets:["b","c","d","f","g","l","m","n","p","r","s","t","br","cr","dr","fl","gl","gr","pr","tr","vr"],vowels:[...Oe,"oa","ue","eo"],codas:["n","r","s","l","m"],codaChance:.45,medials:["del","dor","ver","mar","val","lor","ria","lia","mia"],medialMorphChance:.35,suffixes:["ia","aria","esia"]},germanic:{onsets:["b","d","f","g","h","k","l","m","n","p","r","s","t","w","th","br","cr","dr","fr","gr","kr","pr","tr","st","sk","sp"],vowels:[...Nt,...Le],codas:["nd","rt","rm","rg","lf","rk","lt","st","sk","n","r","m","l","k"],codaChance:.65,medials:["wald","heim","mark","gard","dorf"],medialMorphChance:.3,suffixes:["land","heim","berg"]},slavic:{onsets:["b","v","g","d","z","k","l","m","n","p","r","s","t","br","cr","dr","gr","kr","pr","tr","vl","vr","zv","zl","sk","sp","sl","sm","sn","pl","kl","gl","brn"],vowels:[...Nt,"ya","yo","yu","ia","ie","io"],codas:["v","n","r","nsk","grad","gor","pol","mir","slav","sk"],codaChance:.7,medials:["grad","slav","pol","gor"],medialMorphChance:.4,suffixes:["ia","ovia","grad"]},semitic:{onsets:["al","ar","as","bal","dar","qal","mal","ram","sam","zar","bar","sar"],vowels:[...Ne],codas:["n","m","r","l","s","h"],codaChance:.5,medials:["har","sar","ram","bar"],medialMorphChance:.35,suffixes:["ia","aya","iyya"]},african_west:{onsets:["a","ba","da","ka","fa","ga","la","ma","na","oba","ola","ade","kw","gb","ch","ny","eke","oba","ife","olu"],vowels:["a","e","i","o","u","ai","oa","ie","ua"],codas:["n","m","wa","ra",""],codaChance:.35,medials:["loba","femi","kwe","tunde","chukwu","nwa","kofi","yemi"],medialMorphChance:.4,suffixes:["la","ba","ra","ni","do","ma"]},african_horn:{onsets:["ab","ad","as","ba","da","ha","ka","ma","na","sa","ra","ta","gez","tes","hab","sel","mer","zer","yon","lem"],vowels:["a","e","i","o","u","aa","ee","ei","ia","ua"],codas:["s","m","n","l","t",""],codaChance:.45,medials:["sel","geb","tek","yon","hab","mar","zer","wold"],medialMorphChance:.35,suffixes:["el","es","os","on","u"]},east_asian_cn:{onsets:["b","p","m","f","d","t","n","l","g","k","h","zh","ch","sh","r","z","c","s"],vowels:["a","o","e","i","u","ü","ai","ei","ao","ou","ia","ie","iao","iu","ua","uo","ui","üe","er"],codas:["n","ng",""],codaChance:.4,medials:["shan","jiang","he","hu","zhou","dao","lin","yang","qing","jing","guo","cheng"],medialMorphChance:.3,suffixes:["shan","dao","zhou","guo","cheng","men"]},east_asian_jp:{onsets:["k","s","t","n","h","m","y","r","w","g","z","d","b","p","ky","sh","ch","ny","hy","my","ry","gy","j","py"],vowels:["a","i","u","e","o"],codas:["","n"],codaChance:.35,medials:["mori","yama","kawa","gawa","shima","jima","saka","hara","tani"],medialMorphChance:.3,suffixes:["to","ken","do","fu","shi","mura"]},east_asian_kr:{onsets:["g","n","d","r","m","b","s","j","ch","k","t","p","h"],vowels:["a","eo","o","u","eu","i","ae","e","ya","yeo","yo","yu","wa","we","wi","ui"],codas:["k","n","t","l","m","p","ng",""],codaChance:.45,medials:["san","seong","gang","cheon","buk","nam","jin","dae","won","do"],medialMorphChance:.35,suffixes:["do","si","gun","eup","ri"]},polynesian:{onsets:["","h","k","l","m","n","p","r","t","w","wh","ng"],vowels:["a","e","i","o","u"],codas:["","’","ʻ"],codaChance:.2,medials:["moa","rangi","tonga","tai","wai","puna","tapu","mana","ariki","tiki","honu","pua","mata","ika","koro","hale","fale","nui","loa","roa"],medialMorphChance:.3,suffixes:["nui","roa","loa","rangi","moana","tonga","tai","puna"]}};class Y{rng;constructor(t=Date.now()){this.rng=Y.makeRNG(t)}generate(t={}){const e=this.rng,i=t.lang??this.pickLanguage(),[r,s]=t.syllables??[1,2],a=Y.randInt(e,r,s),o=(t.forceSuffix??this.pickSuffix(i)).toLowerCase();let n=this.buildStem(a,i);return n=this.tidyStemVsSuffix(n,o),this.titleCase(n+o)}pickLanguage(){const t=[$.ROMANCE,$.GERMANIC,$.SLAVIC,$.SEMITIC,$.EAST_ASIAN_CN,$.EAST_ASIAN_JP,$.EAST_ASIAN_KR,$.AFRICAN_WEST,$.AFRICAN_HORN,$.POLYNESIAN];return t[Math.floor(this.rng()*t.length)]}pickSuffix(t){const e=jt[t].suffixes;return e[Math.floor(this.rng()*e.length)]}buildStem(t,e){const i=jt[e];let r="";for(let s=0;s<t;s++)r+=this.pick(i.onsets)+this.pick(i.vowels),this.rng()<i.codaChance&&(r+=this.pick(i.codas));return r}tidyStemVsSuffix(t,e){return/[aeiou]$/i.test(t)&&/^[aeiou]/i.test(e)?t.slice(0,-1):t}titleCase(t){return t.charAt(0).toUpperCase()+t.slice(1)}pick(t){return t[Math.floor(this.rng()*t.length)]}static randInt(t,e,i){return Math.floor(t()*(i-e+1))+e}static makeRNG(t){let e=typeof t=="number"?t|0:Y.hash32(String(t));return e===0&&(e=1831565813),function(){return e^=e<<13,e^=e>>>17,e^=e<<5,(e>>>0)%1e6/1e6}}static hash32(t){let e=2166136261;for(let i=0;i<t.length;i++)e^=t.charCodeAt(i),e=Math.imul(e,16777619);return e>>>0}}const je={resolution:75,jitter:.5,wavelength:.4,rainfall:.6,seaLevel:.5,shatter:.1,edgeCurve:.8},D=d=>{const t=document.getElementById(d);if(!t)throw alert("UI init failed. Check element IDs."),new Error("UI init failed. Check element IDs.");return t};document.addEventListener("DOMContentLoaded",()=>{const d=new we,t=new ke,e=new Y,i=()=>{const w=d.generateMap(y);t.drawCellColors(s,w)},r=()=>{const w=e.generate({}),M=D("map-title");M.textContent=w},s=D("map"),a=D("regen"),o=D("wavelength"),n=D("wavelengthValue"),c=D("rainfall"),u=D("rainfallValue"),l=D("seaLevel"),h=D("seaLevelValue"),f=D("shatter"),g=D("shatterValue"),m=D("edgeCurve"),_=D("edgeCurveValue"),x=D("resolution"),v=D("resolutionValue");r();const y={...je};o.value=String(y.wavelength),n.textContent=y.wavelength.toFixed(2),c.value=String(y.rainfall),u.textContent=y.rainfall.toFixed(2),l.value=String(y.seaLevel),h.textContent=y.seaLevel.toFixed(2),f.value=String(y.shatter),g.textContent=y.shatter.toFixed(2),m.value=String(y.edgeCurve),_.textContent=y.edgeCurve.toFixed(2),x.value=String(y.resolution),v.textContent=y.resolution.toFixed(2),o.addEventListener("input",()=>{y.wavelength=Number(o.value),n.textContent=y.wavelength.toFixed(2),i()}),c.addEventListener("input",()=>{y.rainfall=Number(c.value),u.textContent=y.rainfall.toFixed(2),i()}),l.addEventListener("input",()=>{y.seaLevel=Number(l.value),h.textContent=y.seaLevel.toFixed(2),i()}),f.addEventListener("input",()=>{y.shatter=Number(f.value),g.textContent=y.shatter.toFixed(2),i()}),m.addEventListener("input",()=>{y.edgeCurve=Number(m.value),_.textContent=y.edgeCurve.toFixed(2),i()}),x.addEventListener("input",()=>{y.resolution=Number(x.value),v.textContent=y.resolution.toFixed(2),i()}),a.addEventListener("click",()=>{d.reSeed(),r(),i()}),i(),D("download").addEventListener("click",()=>{const w=document.createElement("a");w.download=`map-${Date.now()}.png`,w.href=s.toDataURL("image/png"),w.click()})});document.addEventListener("DOMContentLoaded",()=>{const d=document.getElementById("mobile-warning");if(!d)return;(/Mobi|Android|iPhone|iPad/i.test(navigator.userAgent)||window.innerWidth<768)&&(console.log("MOBILE"),d.classList.add("show"))});
