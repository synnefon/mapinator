(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();const j=[];for(let f=0;f<256;++f)j.push((f+256).toString(16).slice(1));function Gt(f,t=0){return(j[f[t+0]]+j[f[t+1]]+j[f[t+2]]+j[f[t+3]]+"-"+j[f[t+4]]+j[f[t+5]]+"-"+j[f[t+6]]+j[f[t+7]]+"-"+j[f[t+8]]+j[f[t+9]]+"-"+j[f[t+10]]+j[f[t+11]]+j[f[t+12]]+j[f[t+13]]+j[f[t+14]]+j[f[t+15]]).toLowerCase()}let ht;const qt=new Uint8Array(16);function Bt(){if(!ht){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ht=crypto.getRandomValues.bind(crypto)}return ht(qt)}const Vt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),_t={randomUUID:Vt};function Xt(f,t,e){f=f||{};const r=f.random??f.rng?.()??Bt();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Gt(r)}function Ht(f,t,e){return _t.randomUUID&&!f?_t.randomUUID():Xt(f)}const Kt={resolution:75,jitter:.5,wavelength:.4,rainfall:.6,seaLevel:.5,shatter:.1,edgeCurve:.8};function Yt(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}function Wt(f){if(Object.prototype.hasOwnProperty.call(f,"__esModule"))return f;var t=f.default;if(typeof t=="function"){var e=function r(){var n=!1;try{n=this instanceof r}catch{}return n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(f).forEach(function(r){var n=Object.getOwnPropertyDescriptor(f,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return f[r]}})}),e}var it={exports:{}},Qt=it.exports,vt;function Jt(){return vt||(vt=1,(function(f){(function(t,e,r){function n(i){var c=this,u=o();c.next=function(){var l=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=l-(c.c=l|0)},c.c=1,c.s0=u(" "),c.s1=u(" "),c.s2=u(" "),c.s0-=u(i),c.s0<0&&(c.s0+=1),c.s1-=u(i),c.s1<0&&(c.s1+=1),c.s2-=u(i),c.s2<0&&(c.s2+=1),u=null}function s(i,c){return c.c=i.c,c.s0=i.s0,c.s1=i.s1,c.s2=i.s2,c}function a(i,c){var u=new n(i),l=c&&c.state,h=u.next;return h.int32=function(){return u.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,l&&(typeof l=="object"&&s(l,u),h.state=function(){return s(u,{})}),h}function o(){var i=4022871197,c=function(u){u=String(u);for(var l=0;l<u.length;l++){i+=u.charCodeAt(l);var h=.02519603282416938*i;i=h>>>0,h-=i,h*=i,i=h>>>0,h-=i,i+=h*4294967296}return(i>>>0)*23283064365386963e-26};return c}e&&e.exports?e.exports=a:this.alea=a})(Qt,f)})(it)),it.exports}var rt={exports:{}},Zt=rt.exports,bt;function te(){return bt||(bt=1,(function(f){(function(t,e,r){function n(o){var i=this,c="";i.x=0,i.y=0,i.z=0,i.w=0,i.next=function(){var l=i.x^i.x<<11;return i.x=i.y,i.y=i.z,i.z=i.w,i.w^=i.w>>>19^l^l>>>8},o===(o|0)?i.x=o:c+=o;for(var u=0;u<c.length+64;u++)i.x^=c.charCodeAt(u)|0,i.next()}function s(o,i){return i.x=o.x,i.y=o.y,i.z=o.z,i.w=o.w,i}function a(o,i){var c=new n(o),u=i&&i.state,l=function(){return(c.next()>>>0)/4294967296};return l.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,g=(h+d)/(1<<21);while(g===0);return g},l.int32=c.next,l.quick=l,u&&(typeof u=="object"&&s(u,c),l.state=function(){return s(c,{})}),l}e&&e.exports?e.exports=a:this.xor128=a})(Zt,f)})(rt)),rt.exports}var st={exports:{}},ee=st.exports,wt;function ne(){return wt||(wt=1,(function(f){(function(t,e,r){function n(o){var i=this,c="";i.next=function(){var l=i.x^i.x>>>2;return i.x=i.y,i.y=i.z,i.z=i.w,i.w=i.v,(i.d=i.d+362437|0)+(i.v=i.v^i.v<<4^(l^l<<1))|0},i.x=0,i.y=0,i.z=0,i.w=0,i.v=0,o===(o|0)?i.x=o:c+=o;for(var u=0;u<c.length+64;u++)i.x^=c.charCodeAt(u)|0,u==c.length&&(i.d=i.x<<10^i.x>>>4),i.next()}function s(o,i){return i.x=o.x,i.y=o.y,i.z=o.z,i.w=o.w,i.v=o.v,i.d=o.d,i}function a(o,i){var c=new n(o),u=i&&i.state,l=function(){return(c.next()>>>0)/4294967296};return l.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,g=(h+d)/(1<<21);while(g===0);return g},l.int32=c.next,l.quick=l,u&&(typeof u=="object"&&s(u,c),l.state=function(){return s(c,{})}),l}e&&e.exports?e.exports=a:this.xorwow=a})(ee,f)})(st)),st.exports}var ot={exports:{}},ie=ot.exports,At;function re(){return At||(At=1,(function(f){(function(t,e,r){function n(o){var i=this;i.next=function(){var u=i.x,l=i.i,h,d;return h=u[l],h^=h>>>7,d=h^h<<24,h=u[l+1&7],d^=h^h>>>10,h=u[l+3&7],d^=h^h>>>3,h=u[l+4&7],d^=h^h<<7,h=u[l+7&7],h=h^h<<13,d^=h^h<<9,u[l]=d,i.i=l+1&7,d};function c(u,l){var h,d=[];if(l===(l|0))d[0]=l;else for(l=""+l,h=0;h<l.length;++h)d[h&7]=d[h&7]<<15^l.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8?d[7]=-1:d[h],u.x=d,u.i=0,h=256;h>0;--h)u.next()}c(i,o)}function s(o,i){return i.x=o.x.slice(),i.i=o.i,i}function a(o,i){o==null&&(o=+new Date);var c=new n(o),u=i&&i.state,l=function(){return(c.next()>>>0)/4294967296};return l.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,g=(h+d)/(1<<21);while(g===0);return g},l.int32=c.next,l.quick=l,u&&(u.x&&s(u,c),l.state=function(){return s(c,{})}),l}e&&e.exports?e.exports=a:this.xorshift7=a})(ie,f)})(ot)),ot.exports}var at={exports:{}},se=at.exports,St;function oe(){return St||(St=1,(function(f){(function(t,e,r){function n(o){var i=this;i.next=function(){var u=i.w,l=i.X,h=i.i,d,g;return i.w=u=u+1640531527|0,g=l[h+34&127],d=l[h=h+1&127],g^=g<<13,d^=d<<17,g^=g>>>15,d^=d>>>12,g=l[h]=g^d,i.i=h,g+(u^u>>>16)|0};function c(u,l){var h,d,g,m,_,p=[],b=128;for(l===(l|0)?(d=l,l=null):(l=l+"\0",d=0,b=Math.max(b,l.length)),g=0,m=-32;m<b;++m)l&&(d^=l.charCodeAt((m+32)%l.length)),m===0&&(_=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,m>=0&&(_=_+1640531527|0,h=p[m&127]^=d+_,g=h==0?g+1:0);for(g>=128&&(p[(l&&l.length||0)&127]=-1),g=127,m=512;m>0;--m)d=p[g+34&127],h=p[g=g+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,p[g]=d^h;u.w=_,u.X=p,u.i=g}c(i,o)}function s(o,i){return i.i=o.i,i.w=o.w,i.X=o.X.slice(),i}function a(o,i){o==null&&(o=+new Date);var c=new n(o),u=i&&i.state,l=function(){return(c.next()>>>0)/4294967296};return l.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,g=(h+d)/(1<<21);while(g===0);return g},l.int32=c.next,l.quick=l,u&&(u.X&&s(u,c),l.state=function(){return s(c,{})}),l}e&&e.exports?e.exports=a:this.xor4096=a})(se,f)})(at)),at.exports}var lt={exports:{}},ae=lt.exports,Et;function le(){return Et||(Et=1,(function(f){(function(t,e,r){function n(o){var i=this,c="";i.next=function(){var l=i.b,h=i.c,d=i.d,g=i.a;return l=l<<25^l>>>7^h,h=h-d|0,d=d<<24^d>>>8^g,g=g-l|0,i.b=l=l<<20^l>>>12^h,i.c=h=h-d|0,i.d=d<<16^h>>>16^g,i.a=g-l|0},i.a=0,i.b=0,i.c=-1640531527,i.d=1367130551,o===Math.floor(o)?(i.a=o/4294967296|0,i.b=o|0):c+=o;for(var u=0;u<c.length+20;u++)i.b^=c.charCodeAt(u)|0,i.next()}function s(o,i){return i.a=o.a,i.b=o.b,i.c=o.c,i.d=o.d,i}function a(o,i){var c=new n(o),u=i&&i.state,l=function(){return(c.next()>>>0)/4294967296};return l.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,g=(h+d)/(1<<21);while(g===0);return g},l.int32=c.next,l.quick=l,u&&(typeof u=="object"&&s(u,c),l.state=function(){return s(c,{})}),l}e&&e.exports?e.exports=a:this.tychei=a})(ae,f)})(lt)),lt.exports}var ct={exports:{}};const ce={},he=Object.freeze(Object.defineProperty({__proto__:null,default:ce},Symbol.toStringTag,{value:"Module"})),ue=Wt(he);var fe=ct.exports,Ct;function de(){return Ct||(Ct=1,(function(f){(function(t,e,r){var n=256,s=6,a=52,o="random",i=r.pow(n,s),c=r.pow(2,a),u=c*2,l=n-1,h;function d(v,w,M){var I=[];w=w==!0?{entropy:!0}:w||{};var S=p(_(w.entropy?[v,E(e)]:v??b(),3),I),x=new g(I),A=function(){for(var y=x.g(s),C=i,T=0;y<c;)y=(y+T)*n,C*=n,T=x.g(1);for(;y>=u;)y/=2,C/=2,T>>>=1;return(y+T)/C};return A.int32=function(){return x.g(4)|0},A.quick=function(){return x.g(4)/4294967296},A.double=A,p(E(x.S),e),(w.pass||M||function(y,C,T,k){return k&&(k.S&&m(k,x),y.state=function(){return m(x,{})}),T?(r[o]=y,C):y})(A,S,"global"in w?w.global:this==r,w.state)}function g(v){var w,M=v.length,I=this,S=0,x=I.i=I.j=0,A=I.S=[];for(M||(v=[M++]);S<n;)A[S]=S++;for(S=0;S<n;S++)A[S]=A[x=l&x+v[S%M]+(w=A[S])],A[x]=w;(I.g=function(y){for(var C,T=0,k=I.i,L=I.j,R=I.S;y--;)C=R[k=l&k+1],T=T*n+R[l&(R[k]=R[L=l&L+C])+(R[L]=C)];return I.i=k,I.j=L,T})(n)}function m(v,w){return w.i=v.i,w.j=v.j,w.S=v.S.slice(),w}function _(v,w){var M=[],I=typeof v,S;if(w&&I=="object")for(S in v)try{M.push(_(v[S],w-1))}catch{}return M.length?M:I=="string"?v:v+"\0"}function p(v,w){for(var M=v+"",I,S=0;S<M.length;)w[l&S]=l&(I^=w[l&S]*19)+M.charCodeAt(S++);return E(w)}function b(){try{var v;return h&&(v=h.randomBytes)?v=v(n):(v=new Uint8Array(n),(t.crypto||t.msCrypto).getRandomValues(v)),E(v)}catch{var w=t.navigator,M=w&&w.plugins;return[+new Date,t,M,t.screen,E(e)]}}function E(v){return String.fromCharCode.apply(0,v)}if(p(r.random(),e),f.exports){f.exports=d;try{h=ue}catch{}}else r["seed"+o]=d})(typeof self<"u"?self:fe,[],Math)})(ct)),ct.exports}var ut,It;function ge(){if(It)return ut;It=1;var f=Jt(),t=te(),e=ne(),r=re(),n=oe(),s=le(),a=de();return a.alea=f,a.xor128=t,a.xorwow=e,a.xorshift7=r,a.xor4096=n,a.tychei=s,ut=a,ut}var me=ge();const xt=Yt(me),zt=Math.sqrt(3),xe=.5*(zt-1),K=(3-zt)/6,Mt=f=>Math.floor(f)|0,Tt=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function Rt(f=Math.random){const t=pe(f),e=new Float64Array(t).map(n=>Tt[n%12*2]),r=new Float64Array(t).map(n=>Tt[n%12*2+1]);return function(s,a){let o=0,i=0,c=0;const u=(s+a)*xe,l=Mt(s+u),h=Mt(a+u),d=(l+h)*K,g=l-d,m=h-d,_=s-g,p=a-m;let b,E;_>p?(b=1,E=0):(b=0,E=1);const v=_-b+K,w=p-E+K,M=_-1+2*K,I=p-1+2*K,S=l&255,x=h&255;let A=.5-_*_-p*p;if(A>=0){const T=S+t[x],k=e[T],L=r[T];A*=A,o=A*A*(k*_+L*p)}let y=.5-v*v-w*w;if(y>=0){const T=S+b+t[x+E],k=e[T],L=r[T];y*=y,i=y*y*(k*v+L*w)}let C=.5-M*M-I*I;if(C>=0){const T=S+1+t[x+1],k=e[T],L=r[T];C*=C,c=C*C*(k*M+L*I)}return 70*(o+i+c)}}function pe(f){const e=new Uint8Array(512);for(let r=0;r<512/2;r++)e[r]=r;for(let r=0;r<512/2-1;r++){const n=r+~~(f()*(256-r)),s=e[r];e[r]=e[n],e[n]=s}for(let r=256;r<512;r++)e[r]=e[r-256];return e}const F={OCEAN:{color:"#44447a",name:"ocean"},BARREN_ROCK:{color:"#888888",name:"barren rock"},TUNDRA:{color:"#bbbbaa",name:"tundra"},GLACIER:{color:"#dddde4",name:"glacier"},TEMPERATE_DESERT:{color:"#c9d29b",name:"temperate desert"},SHRUBLAND:{color:"#889977",name:"shrubland"},TAIGA:{color:"#99aa77",name:"taiga"},GRASSLAND:{color:"#88aa55",name:"grassland"},DECIDUOUS_FOREST:{color:"#679459",name:"deciduous forest"},TEMPERATE_RAIN_FOREST:{color:"#448855",name:"rain forest"},SUBTROPICAL_DESERT:{color:"#d2b98b",name:"subtropical desert"},TROPICAL_SEASONAL_FOREST:{color:"#559944",name:"tropical seasonal forest"},TROPICAL_RAIN_FOREST:{color:"#337755",name:"tropical rain forest"}},ft=[.6,1],dt=[.4,.6],J=[.2,.4],Z=[0,.2],ye=[-1,0],tt=[{elevation:ft,moisture:[0,.2],biome:F.BARREN_ROCK},{elevation:ft,moisture:[.2,.5],biome:F.TUNDRA},{elevation:ft,moisture:[.5,1],biome:F.GLACIER},{elevation:dt,moisture:[0,.33],biome:F.TEMPERATE_DESERT},{elevation:dt,moisture:[.33,.66],biome:F.SHRUBLAND},{elevation:dt,moisture:[.66,1],biome:F.TAIGA},{elevation:J,moisture:[0,.16],biome:F.TEMPERATE_DESERT},{elevation:J,moisture:[.16,.5],biome:F.GRASSLAND},{elevation:J,moisture:[.5,.83],biome:F.DECIDUOUS_FOREST},{elevation:J,moisture:[.83,1],biome:F.TEMPERATE_RAIN_FOREST},{elevation:Z,moisture:[0,.16],biome:F.SUBTROPICAL_DESERT},{elevation:Z,moisture:[.16,.33],biome:F.GRASSLAND},{elevation:Z,moisture:[.33,.66],biome:F.TROPICAL_SEASONAL_FOREST},{elevation:Z,moisture:[.66,1],biome:F.TROPICAL_RAIN_FOREST},{elevation:ye,moisture:[0,1],biome:F.OCEAN}];class _e{rainfall;seaLevel;constructor(t,e){if(t<0||t>1||e<0||e>1)throw Error("rainfall & seaLevel must be 0-1");t=this.expCurve(1-t,4.1),this.rainfall=Math.max(.01,t*25),this.seaLevel=2*(e-.5)}getBiome(t,e){let r=2*(t-.5)-(this.seaLevel-.1),n=e**this.rainfall;r=Math.max(Math.min(r,1-this.EPS),-1),n=Math.max(Math.min(n,1-this.EPS),-1);const s=this.findLastIndex(tt,(a,o,i)=>this.matchesRule(a,r,n));return tt[s]?.biome||{color:"#ff008cff",name:"fallback"}}isOcean(t){const e=this.findLastIndex(tt,n=>n.biome.name===F.OCEAN.name);return tt[e].elevation[1]>=t}expCurve(t,e){const r=Math.max(0,Math.min(1,t));return(Math.exp(e*r)-1)/(Math.exp(e)-1)}matchesRule(t,e,r){return t.elevation[0]<=e&&t.elevation[1]>e&&t.moisture[0]<=r&&t.moisture[1]>r}EPS=1e-9;findLastIndex(t,e){for(let r=t.length-1;r>=0;r--)if(e(t[r],r,t))return r;return-1}}const G=11102230246251565e-32,P=134217729,ve=(3+8*G)*G;function gt(f,t,e,r,n){let s,a,o,i,c=t[0],u=r[0],l=0,h=0;u>c==u>-c?(s=c,c=t[++l]):(s=u,u=r[++h]);let d=0;if(l<f&&h<e)for(u>c==u>-c?(a=c+s,o=s-(a-c),c=t[++l]):(a=u+s,o=s-(a-u),u=r[++h]),s=a,o!==0&&(n[d++]=o);l<f&&h<e;)u>c==u>-c?(a=s+c,i=a-s,o=s-(a-i)+(c-i),c=t[++l]):(a=s+u,i=a-s,o=s-(a-i)+(u-i),u=r[++h]),s=a,o!==0&&(n[d++]=o);for(;l<f;)a=s+c,i=a-s,o=s-(a-i)+(c-i),c=t[++l],s=a,o!==0&&(n[d++]=o);for(;h<e;)a=s+u,i=a-s,o=s-(a-i)+(u-i),u=r[++h],s=a,o!==0&&(n[d++]=o);return(s!==0||d===0)&&(n[d++]=s),d}function be(f,t){let e=t[0];for(let r=1;r<f;r++)e+=t[r];return e}function Q(f){return new Float64Array(f)}const we=(3+16*G)*G,Ae=(2+12*G)*G,Se=(9+64*G)*G*G,V=Q(4),kt=Q(8),Lt=Q(12),Nt=Q(16),U=Q(4);function Ee(f,t,e,r,n,s,a){let o,i,c,u,l,h,d,g,m,_,p,b,E,v,w,M,I,S;const x=f-n,A=e-n,y=t-s,C=r-s;v=x*C,h=P*x,d=h-(h-x),g=x-d,h=P*C,m=h-(h-C),_=C-m,w=g*_-(v-d*m-g*m-d*_),M=y*A,h=P*y,d=h-(h-y),g=y-d,h=P*A,m=h-(h-A),_=A-m,I=g*_-(M-d*m-g*m-d*_),p=w-I,l=w-p,V[0]=w-(p+l)+(l-I),b=v+p,l=b-v,E=v-(b-l)+(p-l),p=E-M,l=E-p,V[1]=E-(p+l)+(l-M),S=b+p,l=S-b,V[2]=b-(S-l)+(p-l),V[3]=S;let T=be(4,V),k=Ae*a;if(T>=k||-T>=k||(l=f-x,o=f-(x+l)+(l-n),l=e-A,c=e-(A+l)+(l-n),l=t-y,i=t-(y+l)+(l-s),l=r-C,u=r-(C+l)+(l-s),o===0&&i===0&&c===0&&u===0)||(k=Se*a+ve*Math.abs(T),T+=x*u+C*o-(y*c+A*i),T>=k||-T>=k))return T;v=o*C,h=P*o,d=h-(h-o),g=o-d,h=P*C,m=h-(h-C),_=C-m,w=g*_-(v-d*m-g*m-d*_),M=i*A,h=P*i,d=h-(h-i),g=i-d,h=P*A,m=h-(h-A),_=A-m,I=g*_-(M-d*m-g*m-d*_),p=w-I,l=w-p,U[0]=w-(p+l)+(l-I),b=v+p,l=b-v,E=v-(b-l)+(p-l),p=E-M,l=E-p,U[1]=E-(p+l)+(l-M),S=b+p,l=S-b,U[2]=b-(S-l)+(p-l),U[3]=S;const L=gt(4,V,4,U,kt);v=x*u,h=P*x,d=h-(h-x),g=x-d,h=P*u,m=h-(h-u),_=u-m,w=g*_-(v-d*m-g*m-d*_),M=y*c,h=P*y,d=h-(h-y),g=y-d,h=P*c,m=h-(h-c),_=c-m,I=g*_-(M-d*m-g*m-d*_),p=w-I,l=w-p,U[0]=w-(p+l)+(l-I),b=v+p,l=b-v,E=v-(b-l)+(p-l),p=E-M,l=E-p,U[1]=E-(p+l)+(l-M),S=b+p,l=S-b,U[2]=b-(S-l)+(p-l),U[3]=S;const R=gt(L,kt,4,U,Lt);v=o*u,h=P*o,d=h-(h-o),g=o-d,h=P*u,m=h-(h-u),_=u-m,w=g*_-(v-d*m-g*m-d*_),M=i*c,h=P*i,d=h-(h-i),g=i-d,h=P*c,m=h-(h-c),_=c-m,I=g*_-(M-d*m-g*m-d*_),p=w-I,l=w-p,U[0]=w-(p+l)+(l-I),b=v+p,l=b-v,E=v-(b-l)+(p-l),p=E-M,l=E-p,U[1]=E-(p+l)+(l-M),S=b+p,l=S-b,U[2]=b-(S-l)+(p-l),U[3]=S;const N=gt(R,Lt,4,U,Nt);return Nt[N-1]}function et(f,t,e,r,n,s){const a=(t-s)*(e-n),o=(f-n)*(r-s),i=a-o,c=Math.abs(a+o);return Math.abs(i)>=we*c?i:-Ee(f,t,e,r,n,s,c)}const Ot=Math.pow(2,-52),nt=new Uint32Array(512);class W{static from(t,e=Re,r=ke){const n=t.length,s=new Float64Array(n*2);for(let a=0;a<n;a++){const o=t[a];s[2*a]=e(o),s[2*a+1]=r(o)}return new W(s)}constructor(t){const e=t.length>>1;if(e>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const r=Math.max(2*e-5,0);this._triangles=new Uint32Array(r*3),this._halfedges=new Int32Array(r*3),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:r,_hullTri:n,_hullHash:s}=this,a=t.length>>1;let o=1/0,i=1/0,c=-1/0,u=-1/0;for(let x=0;x<a;x++){const A=t[2*x],y=t[2*x+1];A<o&&(o=A),y<i&&(i=y),A>c&&(c=A),y>u&&(u=y),this._ids[x]=x}const l=(o+c)/2,h=(i+u)/2;let d,g,m;for(let x=0,A=1/0;x<a;x++){const y=mt(l,h,t[2*x],t[2*x+1]);y<A&&(d=x,A=y)}const _=t[2*d],p=t[2*d+1];for(let x=0,A=1/0;x<a;x++){if(x===d)continue;const y=mt(_,p,t[2*x],t[2*x+1]);y<A&&y>0&&(g=x,A=y)}let b=t[2*g],E=t[2*g+1],v=1/0;for(let x=0;x<a;x++){if(x===d||x===g)continue;const A=Me(_,p,b,E,t[2*x],t[2*x+1]);A<v&&(m=x,v=A)}let w=t[2*m],M=t[2*m+1];if(v===1/0){for(let y=0;y<a;y++)this._dists[y]=t[2*y]-t[0]||t[2*y+1]-t[1];H(this._ids,this._dists,0,a-1);const x=new Uint32Array(a);let A=0;for(let y=0,C=-1/0;y<a;y++){const T=this._ids[y],k=this._dists[T];k>C&&(x[A++]=T,C=k)}this.hull=x.subarray(0,A),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(et(_,p,b,E,w,M)<0){const x=g,A=b,y=E;g=m,b=w,E=M,m=x,w=A,M=y}const I=Te(_,p,b,E,w,M);this._cx=I.x,this._cy=I.y;for(let x=0;x<a;x++)this._dists[x]=mt(t[2*x],t[2*x+1],I.x,I.y);H(this._ids,this._dists,0,a-1),this._hullStart=d;let S=3;r[d]=e[m]=g,r[g]=e[d]=m,r[m]=e[g]=d,n[d]=0,n[g]=1,n[m]=2,s.fill(-1),s[this._hashKey(_,p)]=d,s[this._hashKey(b,E)]=g,s[this._hashKey(w,M)]=m,this.trianglesLen=0,this._addTriangle(d,g,m,-1,-1,-1);for(let x=0,A,y;x<this._ids.length;x++){const C=this._ids[x],T=t[2*C],k=t[2*C+1];if(x>0&&Math.abs(T-A)<=Ot&&Math.abs(k-y)<=Ot||(A=T,y=k,C===d||C===g||C===m))continue;let L=0;for(let B=0,$t=this._hashKey(T,k);B<this._hashSize&&(L=s[($t+B)%this._hashSize],!(L!==-1&&L!==r[L]));B++);L=e[L];let R=L,N;for(;N=r[R],et(T,k,t[2*R],t[2*R+1],t[2*N],t[2*N+1])>=0;)if(R=N,R===L){R=-1;break}if(R===-1)continue;let z=this._addTriangle(R,C,r[R],-1,-1,n[R]);n[C]=this._legalize(z+2),n[R]=z,S++;let D=r[R];for(;N=r[D],et(T,k,t[2*D],t[2*D+1],t[2*N],t[2*N+1])<0;)z=this._addTriangle(D,C,N,n[C],-1,n[D]),n[C]=this._legalize(z+2),r[D]=D,S--,D=N;if(R===L)for(;N=e[R],et(T,k,t[2*N],t[2*N+1],t[2*R],t[2*R+1])<0;)z=this._addTriangle(N,C,R,-1,n[R],n[N]),this._legalize(z+2),n[N]=z,r[R]=R,S--,R=N;this._hullStart=e[C]=R,r[R]=e[D]=C,r[C]=D,s[this._hashKey(T,k)]=C,s[this._hashKey(t[2*R],t[2*R+1])]=R}this.hull=new Uint32Array(S);for(let x=0,A=this._hullStart;x<S;x++)this.hull[x]=A,A=r[A];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(Ce(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:r,coords:n}=this;let s=0,a=0;for(;;){const o=r[t],i=t-t%3;if(a=i+(t+2)%3,o===-1){if(s===0)break;t=nt[--s];continue}const c=o-o%3,u=i+(t+1)%3,l=c+(o+2)%3,h=e[a],d=e[t],g=e[u],m=e[l];if(Ie(n[2*h],n[2*h+1],n[2*d],n[2*d+1],n[2*g],n[2*g+1],n[2*m],n[2*m+1])){e[t]=m,e[o]=h;const p=r[l];if(p===-1){let E=this._hullStart;do{if(this._hullTri[E]===l){this._hullTri[E]=t;break}E=this._hullPrev[E]}while(E!==this._hullStart)}this._link(t,p),this._link(o,r[a]),this._link(a,l);const b=c+(o+1)%3;s<nt.length&&(nt[s++]=b)}else{if(s===0)break;t=nt[--s]}}return a}_link(t,e){this._halfedges[t]=e,e!==-1&&(this._halfedges[e]=t)}_addTriangle(t,e,r,n,s,a){const o=this.trianglesLen;return this._triangles[o]=t,this._triangles[o+1]=e,this._triangles[o+2]=r,this._link(o,n),this._link(o+1,s),this._link(o+2,a),this.trianglesLen+=3,o}}function Ce(f,t){const e=f/(Math.abs(f)+Math.abs(t));return(t>0?3-e:1+e)/4}function mt(f,t,e,r){const n=f-e,s=t-r;return n*n+s*s}function Ie(f,t,e,r,n,s,a,o){const i=f-a,c=t-o,u=e-a,l=r-o,h=n-a,d=s-o,g=i*i+c*c,m=u*u+l*l,_=h*h+d*d;return i*(l*_-m*d)-c*(u*_-m*h)+g*(u*d-l*h)<0}function Me(f,t,e,r,n,s){const a=e-f,o=r-t,i=n-f,c=s-t,u=a*a+o*o,l=i*i+c*c,h=.5/(a*c-o*i),d=(c*u-o*l)*h,g=(a*l-i*u)*h;return d*d+g*g}function Te(f,t,e,r,n,s){const a=e-f,o=r-t,i=n-f,c=s-t,u=a*a+o*o,l=i*i+c*c,h=.5/(a*c-o*i),d=f+(c*u-o*l)*h,g=t+(a*l-i*u)*h;return{x:d,y:g}}function H(f,t,e,r){if(r-e<=20)for(let n=e+1;n<=r;n++){const s=f[n],a=t[s];let o=n-1;for(;o>=e&&t[f[o]]>a;)f[o+1]=f[o--];f[o+1]=s}else{const n=e+r>>1;let s=e+1,a=r;Y(f,n,s),t[f[e]]>t[f[r]]&&Y(f,e,r),t[f[s]]>t[f[r]]&&Y(f,s,r),t[f[e]]>t[f[s]]&&Y(f,e,s);const o=f[s],i=t[o];for(;;){do s++;while(t[f[s]]<i);do a--;while(t[f[a]]>i);if(a<s)break;Y(f,s,a)}f[e+1]=f[a],f[a]=o,r-s+1>=a-e?(H(f,t,s,r),H(f,t,e,a-1)):(H(f,t,e,a-1),H(f,t,s,r))}}function Y(f,t,e){const r=f[t];f[t]=f[e],f[e]=r}function Re(f){return f[0]}function ke(f){return f[1]}class jt{rng;constructor(t){this.rng=xt(t)}nextHalfedge(t){return t%3===2?t-2:t+1}triOfEdge(t){return Math.floor(t/3)}buildInedges(t,e){const r=new Int32Array(e).fill(-1),{triangles:n}=t;for(let s=0;s<n.length;s++)r[n[s]]=s;return r}halfedgesAroundSite(t,e,r){const{triangles:n,halfedges:s}=t;let a=e[r];if(a===-1)return null;const o=[];let i=a;do{o.push(i);const c=this.nextHalfedge(i),u=s[c];if(u===-1)return null;i=u,n[i]!==r&&(i=this.nextHalfedge(i),n[i]!==r&&(i=this.nextHalfedge(i)))}while(i!==a);return o}circumcenterOfTri(t,e,r){const{triangles:n}=r,s=t[n[3*e+0]],a=t[n[3*e+1]],o=t[n[3*e+2]],i=s.x*s.x+s.y*s.y,c=a.x*a.x+a.y*a.y,u=o.x*o.x+o.y*o.y,l=2*(s.x*(a.y-o.y)+a.x*(o.y-s.y)+o.x*(s.y-a.y));if(Math.abs(l)<1e-12)return{x:(s.x+a.x+o.x)/3,y:(s.y+a.y+o.y)/3};const h=(i*(a.y-o.y)+c*(o.y-s.y)+u*(s.y-a.y))/l,d=(i*(o.x-a.x)+c*(s.x-o.x)+u*(a.x-s.x))/l;return{x:h,y:d}}polygonCentroid(t,e){let r=0,n=0,s=0;const a=t.length;for(let i=0,c=a-1;i<a;c=i++){const u=t[i].x,l=t[i].y,h=t[c].x,d=t[c].y,g=h*l-u*d;r+=g,n+=(h+u)*g,s+=(d+l)*g}if(Math.abs(r)<1e-12)return e;const o=r/2;return{x:n/(6*o),y:s/(6*o)}}relaxOnce(t){const e=W.from(t,s=>s.x,s=>s.y),r=this.buildInedges(e,t.length),n=new Array(t.length);for(let s=0;s<t.length;s++){const a=this.halfedgesAroundSite(e,r,s);if(!a){n[s]=t[s];continue}const o=a.map(i=>this.circumcenterOfTri(t,this.triOfEdge(i),e));n[s]=this.polygonCentroid(o,t[s])}return{centers:n,delaunay:e}}relaxPoints(t,e){let r=t,n;for(let s=0;s<e;s++){const{centers:a,delaunay:o}=this.relaxOnce(r);r=a,n=o}if(!n)throw new Error("iterations wrong");return{centers:r,delaunay:n}}initPoints(t,e){const r=[];for(let n=0;n<t;n++)for(let s=0;s<t;s++){const a=n+e*(this.rng()-this.rng()),o=s+e*(this.rng()-this.rng());r.push({x:a,y:o})}return r}genPoints(t){const{resolution:e,jitter:r}=t,n=this.initPoints(e,r),{centers:s,delaunay:a}=this.relaxPoints(n,4);return{centers:s,delaunay:a}}}class Le{noise2D;pointGenerator;constructor(t){this.noise2D=Rt(xt(t)),this.pointGenerator=new jt(t)}reSeed(t){this.noise2D=Rt(xt(t)),this.pointGenerator=new jt(t)}generateMap(t){const{resolution:e}=t,{centers:r,delaunay:n}=this.pointGenerator.genPoints(t),s={points:r,resolution:e,numRegions:r.length,numTriangles:n.halfedges.length/3,numEdges:n.halfedges.length,halfedges:n.halfedges,triangles:n.triangles},a=this.genElevations(s,t),o=this.genMoistures(s,t),i=this.calcBiomes(s,a,o,t);return{...s,elevations:a,moistures:o,biomes:i}}calcBiomes(t,e,r,n){const{numRegions:s}=t,a=new _e(n.rainfall,n.seaLevel),o=[];for(let i=0;i<s;i++)o.push(a.getBiome(e[i],r[i]));return o}genMoistures(t,e){const{wavelength:r}=e,{points:n,numRegions:s}=t;let a=[];for(let o=0;o<s;o++){const i=n[o].x/t.resolution-.5,c=n[o].y/t.resolution-1/2,u=(1+this.noise2D(i/r,c/r))/2;a[o]=Math.max(0,Math.min(1,u))}return a}genElevations(t,e){const{wavelength:r,edgeCurve:n}=e,s=1-e.shatter,a=.5,i=a+(3-a)*n,{points:c,numRegions:u,resolution:l}=t,h=new Array(u),d=m=>m<0?0:m>1?1:m,g=(m,_,p)=>m+(_-m)*p;for(let m=0;m<u;m++){const _=c[m].x/l-.5,p=c[m].y/l-.5;let b=1/3+this.noise2D(_/r,p/r)/2+this.noise2D(2*_/r,2*p/r)/3,E=2*Math.max(Math.abs(_),Math.abs(p));E=Math.pow(E,i);const v=(1+b-E)/2;b=g(b,v,d(s)),h[m]=d(b)}return h}}var $=(f=>(f.ROMANCE="romance",f.GERMANIC="germanic",f.SLAVIC="slavic",f.TURKIC="turkic",f.SEMITIC="semitic",f.BANTU_LIKE="bantu_like",f.AFRICAN_WEST="african_west",f.AFRICAN_HORN="african_horn",f.EAST_ASIAN_CN="east_asian_cn",f.EAST_ASIAN_JP="east_asian_jp",f.EAST_ASIAN_KR="east_asian_kr",f.POLYNESIAN="polynesian",f))($||{});const Dt=["a","e","i","o","u"],Ne=["ai","au","ei","ia","io","oa","ue","ui"],Oe=["a","e","i","o","u","ia","io","ie","ea"],je=["a","i","u","aa","ii","uu","ai","au"],Pt={romance:{onsets:["b","c","d","f","g","l","m","n","p","r","s","t","br","cr","dr","fl","gl","gr","pr","tr","vr"],vowels:[...Oe,"oa","ue","eo"],codas:["n","r","s","l","m"],codaChance:.45,medials:["del","dor","ver","mar","val","lor","ria","lia","mia"],medialMorphChance:.35,suffixes:["ia","aria","esia"]},germanic:{onsets:["b","d","f","g","h","k","l","m","n","p","r","s","t","w","th","br","cr","dr","fr","gr","kr","pr","tr","st","sk","sp"],vowels:[...Dt,...Ne],codas:["nd","rt","rm","rg","lf","rk","lt","st","sk","n","r","m","l","k"],codaChance:.65,medials:["wald","heim","mark","gard","dorf"],medialMorphChance:.3,suffixes:["land","heim","berg"]},slavic:{onsets:["b","v","g","d","z","k","l","m","n","p","r","s","t","br","cr","dr","gr","kr","pr","tr","vl","vr","zv","zl","sk","sp","sl","sm","sn","pl","kl","gl","brn"],vowels:[...Dt,"ya","yo","yu","ia","ie","io"],codas:["v","n","r","nsk","grad","gor","pol","mir","slav","sk"],codaChance:.7,medials:["grad","slav","pol","gor"],medialMorphChance:.4,suffixes:["ia","ovia","grad"]},semitic:{onsets:["al","ar","as","bal","dar","qal","mal","ram","sam","zar","bar","sar"],vowels:[...je],codas:["n","m","r","l","s","h"],codaChance:.5,medials:["har","sar","ram","bar"],medialMorphChance:.35,suffixes:["ia","aya","iyya"]},african_west:{onsets:["a","ba","da","ka","fa","ga","la","ma","na","oba","ola","ade","kw","gb","ch","ny","eke","oba","ife","olu"],vowels:["a","e","i","o","u","ai","oa","ie","ua"],codas:["n","m","wa","ra",""],codaChance:.35,medials:["loba","femi","kwe","tunde","chukwu","nwa","kofi","yemi"],medialMorphChance:.4,suffixes:["la","ba","ra","ni","do","ma"]},african_horn:{onsets:["ab","ad","as","ba","da","ha","ka","ma","na","sa","ra","ta","gez","tes","hab","sel","mer","zer","yon","lem"],vowels:["a","e","i","o","u","aa","ee","ei","ia","ua"],codas:["s","m","n","l","t",""],codaChance:.45,medials:["sel","geb","tek","yon","hab","mar","zer","wold"],medialMorphChance:.35,suffixes:["el","es","os","on","u"]},east_asian_cn:{onsets:["b","p","m","f","d","t","n","l","g","k","h","zh","ch","sh","r","z","c","s"],vowels:["a","o","e","i","u","ü","ai","ei","ao","ou","ia","ie","iao","iu","ua","uo","ui","üe","er"],codas:["n","ng",""],codaChance:.4,medials:["shan","jiang","he","hu","zhou","dao","lin","yang","qing","jing","guo","cheng"],medialMorphChance:.3,suffixes:["shan","dao","zhou","guo","cheng","men"]},east_asian_jp:{onsets:["k","s","t","n","h","m","y","r","w","g","z","d","b","p","ky","sh","ch","ny","hy","my","ry","gy","j","py"],vowels:["a","i","u","e","o"],codas:["","n"],codaChance:.35,medials:["mori","yama","kawa","gawa","shima","jima","saka","hara","tani"],medialMorphChance:.3,suffixes:["to","ken","do","fu","shi","mura"]},east_asian_kr:{onsets:["g","n","d","r","m","b","s","j","ch","k","t","p","h"],vowels:["a","eo","o","u","eu","i","ae","e","ya","yeo","yo","yu","wa","we","wi","ui"],codas:["k","n","t","l","m","p","ng",""],codaChance:.45,medials:["san","seong","gang","cheon","buk","nam","jin","dae","won","do"],medialMorphChance:.35,suffixes:["do","si","gun","eup","ri"]},polynesian:{onsets:["","h","k","l","m","n","p","r","t","w","wh","ng"],vowels:["a","e","i","o","u"],codas:["","’","ʻ"],codaChance:.2,medials:["moa","rangi","tonga","tai","wai","puna","tapu","mana","ariki","tiki","honu","pua","mata","ika","koro","hale","fale","nui","loa","roa"],medialMorphChance:.3,suffixes:["nui","roa","loa","rangi","moana","tonga","tai","puna"]}};class De{rng;constructor(t){this.rng=this.makeRNG(t)}reSeed(t){this.rng=this.makeRNG(t)}generate(t={}){const e=t.lang??this.pickLanguage(),[r,n]=t.syllables??[1,2],s=this.randInt(r,n),a=(t.forceSuffix??this.pickSuffix(e)).toLowerCase();let o=this.buildStem(s,e);return o=this.tidyStemVsSuffix(o,a),this.titleCase(o+a)}pickLanguage(){const t=[$.ROMANCE,$.GERMANIC,$.SLAVIC,$.SEMITIC,$.EAST_ASIAN_CN,$.EAST_ASIAN_JP,$.EAST_ASIAN_KR,$.AFRICAN_WEST,$.AFRICAN_HORN,$.POLYNESIAN];return t[Math.floor(this.rng()*t.length)]}pickSuffix(t){const e=Pt[t].suffixes;return e[Math.floor(this.rng()*e.length)]}buildStem(t,e){const r=Pt[e];let n="";for(let s=0;s<t;s++)n+=this.pick(r.onsets)+this.pick(r.vowels),this.rng()<r.codaChance&&(n+=this.pick(r.codas));return n}tidyStemVsSuffix(t,e){return/[aeiou]$/i.test(t)&&/^[aeiou]/i.test(e)?t.slice(0,-1):t}titleCase(t){return t.charAt(0).toUpperCase()+t.slice(1)}pick(t){return t[Math.floor(this.rng()*t.length)]}randInt(t,e){return Math.floor(this.rng()*(e-t+1))+t}makeRNG(t){let e=typeof t=="number"?t|0:this.hash32(String(t));return e===0&&(e=1831565813),function(){return e^=e<<13,e^=e>>>17,e^=e<<5,(e>>>0)%1e6/1e6}}hash32(t){let e=2166136261;for(let r=0;r<t.length;r++)e^=t.charCodeAt(r),e=Math.imul(e,16777619);return e>>>0}}const Ft=1e-6;class q{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,e){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,e){this._+=`L${this._x1=+t},${this._y1=+e}`}arc(t,e,r){t=+t,e=+e,r=+r;const n=t+r,s=e;if(r<0)throw new Error("negative radius");this._x1===null?this._+=`M${n},${s}`:(Math.abs(this._x1-n)>Ft||Math.abs(this._y1-s)>Ft)&&(this._+="L"+n+","+s),r&&(this._+=`A${r},${r},0,1,1,${t-r},${e}A${r},${r},0,1,1,${this._x1=n},${this._y1=s}`)}rect(t,e,r,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${+r}v${+n}h${-r}Z`}value(){return this._||null}}class pt{constructor(){this._=[]}moveTo(t,e){this._.push([t,e])}closePath(){this._.push(this._[0].slice())}lineTo(t,e){this._.push([t,e])}value(){return this._.length?this._:null}}class Pe{constructor(t,[e,r,n,s]=[0,0,960,500]){if(!((n=+n)>=(e=+e))||!((s=+s)>=(r=+r)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=n,this.xmin=e,this.ymax=s,this.ymin=r,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:e,triangles:r},vectors:n}=this;let s,a;const o=this.circumcenters=this._circumcenters.subarray(0,r.length/3*2);for(let m=0,_=0,p=r.length,b,E;m<p;m+=3,_+=2){const v=r[m]*2,w=r[m+1]*2,M=r[m+2]*2,I=t[v],S=t[v+1],x=t[w],A=t[w+1],y=t[M],C=t[M+1],T=x-I,k=A-S,L=y-I,R=C-S,N=(T*R-k*L)*2;if(Math.abs(N)<1e-9){if(s===void 0){s=a=0;for(const D of e)s+=t[D*2],a+=t[D*2+1];s/=e.length,a/=e.length}const z=1e9*Math.sign((s-I)*R-(a-S)*L);b=(I+y)/2-z*R,E=(S+C)/2+z*L}else{const z=1/N,D=T*T+k*k,B=L*L+R*R;b=I+(R*D-k*B)*z,E=S+(T*B-L*D)*z}o[_]=b,o[_+1]=E}let i=e[e.length-1],c,u=i*4,l,h=t[2*i],d,g=t[2*i+1];n.fill(0);for(let m=0;m<e.length;++m)i=e[m],c=u,l=h,d=g,u=i*4,h=t[2*i],g=t[2*i+1],n[c+2]=n[u]=d-g,n[c+3]=n[u+1]=h-l}render(t){const e=t==null?t=new q:void 0,{delaunay:{halfedges:r,inedges:n,hull:s},circumcenters:a,vectors:o}=this;if(s.length<=1)return null;for(let u=0,l=r.length;u<l;++u){const h=r[u];if(h<u)continue;const d=Math.floor(u/3)*2,g=Math.floor(h/3)*2,m=a[d],_=a[d+1],p=a[g],b=a[g+1];this._renderSegment(m,_,p,b,t)}let i,c=s[s.length-1];for(let u=0;u<s.length;++u){i=c,c=s[u];const l=Math.floor(n[c]/3)*2,h=a[l],d=a[l+1],g=i*4,m=this._project(h,d,o[g+2],o[g+3]);m&&this._renderSegment(h,d,m[0],m[1],t)}return e&&e.value()}renderBounds(t){const e=t==null?t=new q:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),e&&e.value()}renderCell(t,e){const r=e==null?e=new q:void 0,n=this._clip(t);if(n===null||!n.length)return;e.moveTo(n[0],n[1]);let s=n.length;for(;n[0]===n[s-2]&&n[1]===n[s-1]&&s>1;)s-=2;for(let a=2;a<s;a+=2)(n[a]!==n[a-2]||n[a+1]!==n[a-1])&&e.lineTo(n[a],n[a+1]);return e.closePath(),r&&r.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,r=t.length/2;e<r;++e){const n=this.cellPolygon(e);n&&(n.index=e,yield n)}}cellPolygon(t){const e=new pt;return this.renderCell(t,e),e.value()}_renderSegment(t,e,r,n,s){let a;const o=this._regioncode(t,e),i=this._regioncode(r,n);o===0&&i===0?(s.moveTo(t,e),s.lineTo(r,n)):(a=this._clipSegment(t,e,r,n,o,i))&&(s.moveTo(a[0],a[1]),s.lineTo(a[2],a[3]))}contains(t,e,r){return e=+e,e!==e||(r=+r,r!==r)?!1:this.delaunay._step(t,e,r)===t}*neighbors(t){const e=this._clip(t);if(e)for(const r of this.delaunay.neighbors(t)){const n=this._clip(r);if(n){t:for(let s=0,a=e.length;s<a;s+=2)for(let o=0,i=n.length;o<i;o+=2)if(e[s]===n[o]&&e[s+1]===n[o+1]&&e[(s+2)%a]===n[(o+i-2)%i]&&e[(s+3)%a]===n[(o+i-1)%i]){yield r;break t}}}}_cell(t){const{circumcenters:e,delaunay:{inedges:r,halfedges:n,triangles:s}}=this,a=r[t];if(a===-1)return null;const o=[];let i=a;do{const c=Math.floor(i/3);if(o.push(e[c*2],e[c*2+1]),i=i%3===2?i-2:i+1,s[i]!==t)break;i=n[i]}while(i!==a&&i!==-1);return o}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(t);if(e===null)return null;const{vectors:r}=this,n=t*4;return this._simplify(r[n]||r[n+1]?this._clipInfinite(t,e,r[n],r[n+1],r[n+2],r[n+3]):this._clipFinite(t,e))}_clipFinite(t,e){const r=e.length;let n=null,s,a,o=e[r-2],i=e[r-1],c,u=this._regioncode(o,i),l,h=0;for(let d=0;d<r;d+=2)if(s=o,a=i,o=e[d],i=e[d+1],c=u,u=this._regioncode(o,i),c===0&&u===0)l=h,h=0,n?n.push(o,i):n=[o,i];else{let g,m,_,p,b;if(c===0){if((g=this._clipSegment(s,a,o,i,c,u))===null)continue;[m,_,p,b]=g}else{if((g=this._clipSegment(o,i,s,a,u,c))===null)continue;[p,b,m,_]=g,l=h,h=this._edgecode(m,_),l&&h&&this._edge(t,l,h,n,n.length),n?n.push(m,_):n=[m,_]}l=h,h=this._edgecode(p,b),l&&h&&this._edge(t,l,h,n,n.length),n?n.push(p,b):n=[p,b]}if(n)l=h,h=this._edgecode(n[0],n[1]),l&&h&&this._edge(t,l,h,n,n.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return n}_clipSegment(t,e,r,n,s,a){const o=s<a;for(o&&([t,e,r,n,s,a]=[r,n,t,e,a,s]);;){if(s===0&&a===0)return o?[r,n,t,e]:[t,e,r,n];if(s&a)return null;let i,c,u=s||a;u&8?(i=t+(r-t)*(this.ymax-e)/(n-e),c=this.ymax):u&4?(i=t+(r-t)*(this.ymin-e)/(n-e),c=this.ymin):u&2?(c=e+(n-e)*(this.xmax-t)/(r-t),i=this.xmax):(c=e+(n-e)*(this.xmin-t)/(r-t),i=this.xmin),s?(t=i,e=c,s=this._regioncode(t,e)):(r=i,n=c,a=this._regioncode(r,n))}}_clipInfinite(t,e,r,n,s,a){let o=Array.from(e),i;if((i=this._project(o[0],o[1],r,n))&&o.unshift(i[0],i[1]),(i=this._project(o[o.length-2],o[o.length-1],s,a))&&o.push(i[0],i[1]),o=this._clipFinite(t,o))for(let c=0,u=o.length,l,h=this._edgecode(o[u-2],o[u-1]);c<u;c+=2)l=h,h=this._edgecode(o[c],o[c+1]),l&&h&&(c=this._edge(t,l,h,o,c),u=o.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return o}_edge(t,e,r,n,s){for(;e!==r;){let a,o;switch(e){case 5:e=4;continue;case 4:e=6,a=this.xmax,o=this.ymin;break;case 6:e=2;continue;case 2:e=10,a=this.xmax,o=this.ymax;break;case 10:e=8;continue;case 8:e=9,a=this.xmin,o=this.ymax;break;case 9:e=1;continue;case 1:e=5,a=this.xmin,o=this.ymin;break}(n[s]!==a||n[s+1]!==o)&&this.contains(t,a,o)&&(n.splice(s,0,a,o),s+=2)}return s}_project(t,e,r,n){let s=1/0,a,o,i;if(n<0){if(e<=this.ymin)return null;(a=(this.ymin-e)/n)<s&&(i=this.ymin,o=t+(s=a)*r)}else if(n>0){if(e>=this.ymax)return null;(a=(this.ymax-e)/n)<s&&(i=this.ymax,o=t+(s=a)*r)}if(r>0){if(t>=this.xmax)return null;(a=(this.xmax-t)/r)<s&&(o=this.xmax,i=e+(s=a)*n)}else if(r<0){if(t<=this.xmin)return null;(a=(this.xmin-t)/r)<s&&(o=this.xmin,i=e+(s=a)*n)}return[o,i]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}_simplify(t){if(t&&t.length>4){for(let e=0;e<t.length;e+=2){const r=(e+2)%t.length,n=(e+4)%t.length;(t[e]===t[r]&&t[r]===t[n]||t[e+1]===t[r+1]&&t[r+1]===t[n+1])&&(t.splice(r,2),e-=2)}t.length||(t=null)}return t}}const Fe=2*Math.PI,X=Math.pow;function Ue(f){return f[0]}function ze(f){return f[1]}function $e(f){const{triangles:t,coords:e}=f;for(let r=0;r<t.length;r+=3){const n=2*t[r],s=2*t[r+1],a=2*t[r+2];if((e[a]-e[n])*(e[s+1]-e[n+1])-(e[s]-e[n])*(e[a+1]-e[n+1])>1e-10)return!1}return!0}function Ge(f,t,e){return[f+Math.sin(f+t)*e,t+Math.cos(f-t)*e]}class yt{static from(t,e=Ue,r=ze,n){return new yt("length"in t?qe(t,e,r,n):Float64Array.from(Be(t,e,r,n)))}constructor(t){this._delaunator=new W(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,e=this.points;if(t.hull&&t.hull.length>2&&$e(t)){this.collinear=Int32Array.from({length:e.length/2},(h,d)=>d).sort((h,d)=>e[2*h]-e[2*d]||e[2*h+1]-e[2*d+1]);const i=this.collinear[0],c=this.collinear[this.collinear.length-1],u=[e[2*i],e[2*i+1],e[2*c],e[2*c+1]],l=1e-8*Math.hypot(u[3]-u[1],u[2]-u[0]);for(let h=0,d=e.length/2;h<d;++h){const g=Ge(e[2*h],e[2*h+1],l);e[2*h]=g[0],e[2*h+1]=g[1]}this._delaunator=new W(e)}else delete this.collinear;const r=this.halfedges=this._delaunator.halfedges,n=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let i=0,c=r.length;i<c;++i){const u=s[i%3===2?i-2:i+1];(r[i]===-1||a[u]===-1)&&(a[u]=i)}for(let i=0,c=n.length;i<c;++i)o[n[i]]=i;n.length<=2&&n.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=n[0],a[n[0]]=1,n.length===2&&(a[n[1]]=0,this.triangles[1]=n[1],this.triangles[2]=n[1]))}voronoi(t){return new Pe(this,t)}*neighbors(t){const{inedges:e,hull:r,_hullIndex:n,halfedges:s,triangles:a,collinear:o}=this;if(o){const l=o.indexOf(t);l>0&&(yield o[l-1]),l<o.length-1&&(yield o[l+1]);return}const i=e[t];if(i===-1)return;let c=i,u=-1;do{if(yield u=a[c],c=c%3===2?c-2:c+1,a[c]!==t)return;if(c=s[c],c===-1){const l=r[(n[t]+1)%r.length];l!==u&&(yield l);return}}while(c!==i)}find(t,e,r=0){if(t=+t,t!==t||(e=+e,e!==e))return-1;const n=r;let s;for(;(s=this._step(r,t,e))>=0&&s!==r&&s!==n;)r=s;return s}_step(t,e,r){const{inedges:n,hull:s,_hullIndex:a,halfedges:o,triangles:i,points:c}=this;if(n[t]===-1||!c.length)return(t+1)%(c.length>>1);let u=t,l=X(e-c[t*2],2)+X(r-c[t*2+1],2);const h=n[t];let d=h;do{let g=i[d];const m=X(e-c[g*2],2)+X(r-c[g*2+1],2);if(m<l&&(l=m,u=g),d=d%3===2?d-2:d+1,i[d]!==t)break;if(d=o[d],d===-1){if(d=s[(a[t]+1)%s.length],d!==g&&X(e-c[d*2],2)+X(r-c[d*2+1],2)<l)return d;break}}while(d!==h);return u}render(t){const e=t==null?t=new q:void 0,{points:r,halfedges:n,triangles:s}=this;for(let a=0,o=n.length;a<o;++a){const i=n[a];if(i<a)continue;const c=s[a]*2,u=s[i]*2;t.moveTo(r[c],r[c+1]),t.lineTo(r[u],r[u+1])}return this.renderHull(t),e&&e.value()}renderPoints(t,e){e===void 0&&(!t||typeof t.moveTo!="function")&&(e=t,t=null),e=e==null?2:+e;const r=t==null?t=new q:void 0,{points:n}=this;for(let s=0,a=n.length;s<a;s+=2){const o=n[s],i=n[s+1];t.moveTo(o+e,i),t.arc(o,i,e,0,Fe)}return r&&r.value()}renderHull(t){const e=t==null?t=new q:void 0,{hull:r,points:n}=this,s=r[0]*2,a=r.length;t.moveTo(n[s],n[s+1]);for(let o=1;o<a;++o){const i=2*r[o];t.lineTo(n[i],n[i+1])}return t.closePath(),e&&e.value()}hullPolygon(){const t=new pt;return this.renderHull(t),t.value()}renderTriangle(t,e){const r=e==null?e=new q:void 0,{points:n,triangles:s}=this,a=s[t*=3]*2,o=s[t+1]*2,i=s[t+2]*2;return e.moveTo(n[a],n[a+1]),e.lineTo(n[o],n[o+1]),e.lineTo(n[i],n[i+1]),e.closePath(),r&&r.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,r=t.length/3;e<r;++e)yield this.trianglePolygon(e)}trianglePolygon(t){const e=new pt;return this.renderTriangle(t,e),e.value()}}function qe(f,t,e,r){const n=f.length,s=new Float64Array(n*2);for(let a=0;a<n;++a){const o=f[a];s[a*2]=t.call(r,o,a,f),s[a*2+1]=e.call(r,o,a,f)}return s}function*Be(f,t,e,r){let n=0;for(const s of f)yield t.call(r,s,n,f),yield e.call(r,s,n,f),++n}class Ve{drawCellColors(t,e){const r=t.getContext("2d");if(!r)return;const{resolution:n,points:s,biomes:a}=e;r.clearRect(0,0,t.width,t.height),r.save(),r.scale(t.width/n,t.height/n);const i=yt.from(s,c=>c.x,c=>c.y).voronoi([0,0,n,n]);for(let c=0;c<s.length;c++){const u=i.cellPolygon(c);if(!u||u.length<3)continue;r.beginPath(),r.moveTo(u[0][0],u[0][1]);for(let h=1;h<u.length;h++)r.lineTo(u[h][0],u[h][1]);r.closePath();const l=a[c].color;r.fillStyle=l,r.fill(),r.strokeStyle=l,r.lineWidth=.05,r.lineJoin="round",r.miterLimit=2,r.stroke()}r.restore()}}const O=f=>{const t=document.getElementById(f);if(!t)throw alert("UI init failed. Check element IDs."),new Error("UI init failed. Check element IDs.");return t},Ut=()=>Ht().substring(0,18).replaceAll("-","");document.addEventListener("DOMContentLoaded",()=>{let f=Ut();const t=new Le(f),e=new De(f),r=new Ve,n=()=>{const y=t.generateMap(x);r.drawCellColors(c,y)},s=()=>{const y=e.generate({}),C=O("map-title");C.textContent=y},a=()=>{const y=O("seed-input");y.value=f},o=()=>{s(),n(),a()},i=y=>{f=y,t.reSeed(f),e.reSeed(f),o()},c=O("map"),u=O("regen"),l=O("wavelength"),h=O("wavelengthValue"),d=O("rainfall"),g=O("rainfallValue"),m=O("seaLevel"),_=O("seaLevelValue"),p=O("shatter"),b=O("shatterValue"),E=O("edgeCurve"),v=O("edgeCurveValue"),w=O("resolution"),M=O("resolutionValue"),I=O("seed-input"),S=O("load-seed-btn"),x={...Kt};l.value=String(x.wavelength),h.textContent=x.wavelength.toFixed(2),d.value=String(x.rainfall),g.textContent=x.rainfall.toFixed(2),m.value=String(x.seaLevel),_.textContent=x.seaLevel.toFixed(2),p.value=String(x.shatter),b.textContent=x.shatter.toFixed(2),E.value=String(x.edgeCurve),v.textContent=x.edgeCurve.toFixed(2),w.value=String(x.resolution),M.textContent=x.resolution.toFixed(2),l.addEventListener("input",()=>{x.wavelength=Number(l.value),h.textContent=x.wavelength.toFixed(2),n()}),d.addEventListener("input",()=>{x.rainfall=Number(d.value),g.textContent=x.rainfall.toFixed(2),n()}),m.addEventListener("input",()=>{x.seaLevel=Number(m.value),_.textContent=x.seaLevel.toFixed(2),n()}),p.addEventListener("input",()=>{x.shatter=Number(p.value),b.textContent=x.shatter.toFixed(2),n()}),E.addEventListener("input",()=>{x.edgeCurve=Number(E.value),v.textContent=x.edgeCurve.toFixed(2),n()}),w.addEventListener("input",()=>{x.resolution=Number(w.value),M.textContent=x.resolution.toFixed(2),n()}),u.addEventListener("click",()=>{f=Ut(),t.reSeed(f),e.reSeed(f),o()}),o(),O("download").addEventListener("click",()=>{const y=document.createElement("a");y.download=`map-${Date.now()}.png`,y.href=c.toDataURL("image/png"),y.click()}),S.addEventListener("click",()=>{const y=I.value.trim();i(y)})});document.addEventListener("DOMContentLoaded",()=>{const f=document.getElementById("mobile-warning");if(!f)return;(/Mobi|Android|iPhone|iPad/i.test(navigator.userAgent)||window.innerWidth<768)&&(console.log("MOBILE"),f.classList.add("show"))});
